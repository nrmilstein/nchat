{"version":3,"sources":["assets/LoadingIcon.module.css","chatApp/contentView/ConversationCreatorViewBanner.module.css","chatApp/contentView/ContentView.module.css","chatApp/sidebar/ConversationRow.module.css","accounts/AccountsView.module.css","chatApp/sidebar/Sidebar.module.css","chatApp/sidebar/SidebarBanner.module.css","chatApp/contentView/MessageView.module.css","accounts/LoginForm.module.css","accounts/SignUpForm.module.css","chatApp/contentView/ConversationViewBanner.module.css","chatApp/ChatAppLoader.module.css","accounts/TryNowForm.module.css","chatApp/contentView/MessagesView.module.css","chatApp/contentView/MessageInput.module.css","chatApp/contentView/ConversationCreatorView.module.css","chatApp/sidebar/ConversationList.module.css","chatApp/contentView/ConversationView.module.css","chatApp/ChatApp.module.css","utils/NchatApi.tsx","chatApp/ChatAppContext.tsx","chatApp/sidebar/logout.svg","chatApp/sidebar/plus.svg","chatApp/sidebar/SidebarBanner.tsx","chatApp/sidebar/ConversationRow.tsx","chatApp/sidebar/ConversationList.tsx","chatApp/sidebar/Sidebar.tsx","assets/logoCompact.svg","assets/logo.svg","chatApp/contentView/ConversationViewBanner.tsx","chatApp/contentView/MessageView.tsx","chatApp/contentView/MessagesView.tsx","chatApp/contentView/MessageInput.tsx","chatApp/contentView/ConversationView.tsx","chatApp/contentView/greenCheck.svg","chatApp/contentView/redX.svg","chatApp/contentView/ConversationCreatorViewBanner.tsx","chatApp/contentView/ConversationCreatorView.tsx","chatApp/contentView/ContentView.tsx","chatApp/ChatApp.tsx","utils/NchatWebSocket.tsx","accounts/LoginForm.tsx","chatApp/ChatAppLoader.tsx","accounts/TryNowForm.tsx","accounts/SignUpForm.tsx","accounts/AccountsView.tsx","App.tsx","index.tsx"],"names":["module","exports","NchatApi","path","authKey","init","customHeaders","headers","this","appendHeaders","fetch","apiUrl","response","responseClone","clone","json","jsonResponse","ok","status","NchatApiError","message","FetchError","body","postInit","JSON","stringify","putInit","deleteInit","additionalHeaders","headerKey","hasOwnProperty","Headers","append","Array","isArray","push","Error","captureStackTrace","ChatAppContext","React","createContext","user","id","name","username","_extends","Object","assign","target","i","arguments","length","source","key","prototype","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_ref2","createElement","stroke","strokeLinejoin","d","fill","strokeLinecap","strokeWidth","_ref","svgRef","title","props","width","height","viewBox","ref","ForwardRef","forwardRef","SidebarBanner","Consumer","context","className","styles","main","userName","button","onClick","logoutHandler","icon","handleLaunchConversationCreator","ConversationRow","messageTimeStr","lastMessageBody","conversation","messages","lastMessage","daysDifference","differenceInCalendarDays","Date","sent","formatDate","conversationPartnerName","conversationPartner","selected","main_selected","handleConversationRowClick","bubble","split","slice","map","e","charAt","toUpperCase","full","header","time","ConversationList","conversationRows","conversations","uuid","selectedConversationUuid","Sidebar","control","transform","fillRule","ConversationViewBanner","selectedConversation","logoCompact","logo","MessageView","senderId","fromUs_unsynced","fromUs_synced","fromThem","messageBody","MessagesView","SCROLL_TOLERANCE","conversationViewDiv","createRef","scrollToBottom","bind","prevProps","prevState","isScrolledToBottom","snapshot","prevMessages","node","current","scrollTop","scrollHeight","clientHeight","scrollTo","isLoading","loading","loadingIcon","loadingIconStyles","Component","contextType","MessageInput","state","handleChange","handleClickSend","handleKeyDown","event","setState","value","trim","handleSendMessage","input","type","onKeyDown","onChange","autoFocus","placeholder","autoComplete","disabled","ConversationView","window","matchMedia","matches","cx","cy","rx","ry","style","paintOrder","ConversationCreatorViewBannerStatus","r","ConversationCreatorViewBanner","Empty","to","Loading","error","Ok","success","htmlFor","label","conversationCreatorUsername","onBlur","handleBlur","ConversationCreatorView","usernameInputStatus","handleUsernameChange","handleUsernameInputBlur","handleCreateConversation","getConversationPartner","get","userJson","data","spacer","ContentView","content","isConversationCreatorOpen","actionPhrase","noConversationContainer","noConversation","logoFull","hint","newChatIcon","ChatApp","handleMessageReceived","webSocket","addNotificationListener","isHistoryLoaded","conversationIndex","findIndex","c","loadingConversations","update","$set","retrievedMessages","uuidv4","parseISO","updatedConversations","notification","messageJson","conversationJson","newMessage","addMessageToConversation","newConversation","sendMessage","navigate","index","updatedConversation","$push","withRemovedConversation","$splice","conversationUuid","findConversationIndex","a","findConversation","request","method","sendRequest","messageIndex","m","toSearch","find","contextValue","Provider","close","NchatWebSocket","isAuthMessageSent","requestId","requestPromiseCallbacks","notificationListeners","addEventListener","location","url","protocol","host","WebSocket","websocketUrl","Promise","resolve","reject","nchatWebSocket","parse","callbacks","listeners","listener","getNextId","send","registerPromise","getWebsocketUrl","LoginFormStatus","ChatAppLoader","errorMessage","setTimeout","userPromise","initUser","conversationsPromise","initConversations","webSocketPromise","createWebSocket","then","sendAuth","all","TryNowFormStatus","LoginForm","password","handleSubmit","preventDefault","authenticateUser","code","onSubmit","required","signUpMessage","SignUpFormStatus","TryNowForm","handleClick","post","setAuthenticatedUser","SignUpForm","requestBody","loginMessage","AccountsView","logoContainer","intro","selector","tryNow","divider","authenticate","App","logout","Cookies","set","sameSite","maxAge","remove","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.3a720764.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"LoadingIcon_main__34XFe\",\"rotateLoadingIcon\":\"LoadingIcon_rotateLoadingIcon__7vz7G\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationCreatorViewBanner_main__2RuqB\",\"status\":\"ConversationCreatorViewBanner_status__33eIj\",\"label\":\"ConversationCreatorViewBanner_label__1GUTo\",\"to\":\"ConversationCreatorViewBanner_to__2CFmT\",\"loading\":\"ConversationCreatorViewBanner_loading__1Bazp\",\"success\":\"ConversationCreatorViewBanner_success__4uYs9\",\"error\":\"ConversationCreatorViewBanner_error__3xyF-\",\"input\":\"ConversationCreatorViewBanner_input__1n_BT\",\"logoCompact\":\"ConversationCreatorViewBanner_logoCompact__xXF5g\",\"logo\":\"ConversationCreatorViewBanner_logo__3JRhd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ContentView_main__1wKd8\",\"noConversationContainer\":\"ContentView_noConversationContainer__cNJRp\",\"noConversation\":\"ContentView_noConversation__2Aa6q\",\"logo\":\"ContentView_logo__145Qh\",\"logoFull\":\"ContentView_logoFull__1bV84\",\"hint\":\"ContentView_hint__2LgK_\",\"newChatIcon\":\"ContentView_newChatIcon__3nwJn\",\"logoCompact\":\"ContentView_logoCompact__2wA-P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationRow_main__15UeD\",\"main_selected\":\"ConversationRow_main_selected__1NOlm\",\"bubble\":\"ConversationRow_bubble__3Ao4F\",\"full\":\"ConversationRow_full__Jdv7t\",\"header\":\"ConversationRow_header__1ZnpL\",\"name\":\"ConversationRow_name__23KPO\",\"time\":\"ConversationRow_time__OgSgH\",\"message\":\"ConversationRow_message__foiam\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"AccountsView_main__3bB6D\",\"logoContainer\":\"AccountsView_logoContainer__WpB20\",\"logo\":\"AccountsView_logo__3C1wl\",\"intro\":\"AccountsView_intro__TLRBm\",\"divider\":\"AccountsView_divider__OB39W\",\"selector\":\"AccountsView_selector__2zNAb\",\"tryNow\":\"AccountsView_tryNow__2DSPt\",\"authenticate\":\"AccountsView_authenticate__3Ry6X\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"Sidebar_main__4NAoH\",\"control\":\"Sidebar_control__zeglL\",\"button\":\"Sidebar_button___Uwje\",\"icon\":\"Sidebar_icon__2be8Y\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"SidebarBanner_main__aKmsQ\",\"userName\":\"SidebarBanner_userName__2-u0O\",\"button\":\"SidebarBanner_button__2yvjF\",\"icon\":\"SidebarBanner_icon__3ED6o\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"MessageView_main__iUNFr\",\"messageBody\":\"MessageView_messageBody__2HVi_\",\"fromUs_synced\":\"MessageView_fromUs_synced__xva42\",\"fromUs_unsynced\":\"MessageView_fromUs_unsynced__3hq1Q\",\"fromThem\":\"MessageView_fromThem__2rvmg\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"signUpMessage\":\"LoginForm_signUpMessage__1r2se\",\"status\":\"LoginForm_status__19Y73\",\"loading\":\"LoginForm_loading__25Wew\",\"header\":\"LoginForm_header__2JLXQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loginMessage\":\"SignUpForm_loginMessage__37JjP\",\"status\":\"SignUpForm_status__1IEWG\",\"loading\":\"SignUpForm_loading__1JIgt\",\"header\":\"SignUpForm_header__21dfs\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationViewBanner_main__1QcAL\",\"name\":\"ConversationViewBanner_name__6kOJg\",\"logoCompact\":\"ConversationViewBanner_logoCompact__1ZKm8\",\"logo\":\"ConversationViewBanner_logo__-7pzv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ChatAppLoader_main__3MLko\",\"loading\":\"ChatAppLoader_loading__10PNe\",\"loadingIcon\":\"ChatAppLoader_loadingIcon__1FXvN\",\"errorMessage\":\"ChatAppLoader_errorMessage__3ZIkB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"TryNowForm_main__3uKR4\",\"loading\":\"TryNowForm_loading__2llzz\",\"header\":\"TryNowForm_header__zTYsS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"MessagesView_main__42rqi\",\"loading\":\"MessagesView_loading__1CrH0\",\"loadingIcon\":\"MessagesView_loadingIcon__6ERDa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"MessageInput_main__2csiL\",\"input\":\"MessageInput_input__2yt7Q\",\"button\":\"MessageInput_button__1IFqk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationCreatorView_main__2pC5Z\",\"spacer\":\"ConversationCreatorView_spacer__3HChQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationList_main__6a_YG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationView_main__N3c4M\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ChatApp_main__1mAeE\"};","class NchatApi {\n  static apiUrl = \"/api/v1/\";\n\n  static async fetch<T>(path: string, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n\n    let customHeaders: { [index: string]: string } = {\n      \"Accept\": \"application/json\",\n    }\n    if (authKey) {\n      customHeaders[\"X-API-KEY\"] = authKey;\n    }\n\n    if (init) {\n      if (init.headers) {\n        this.appendHeaders(init.headers, customHeaders);\n      } else {\n        init.headers = customHeaders;\n      }\n    } else {\n      init = {\n        \"headers\": customHeaders,\n      }\n    }\n\n    const response = await fetch(this.apiUrl + path, init)\n\n    // If we want to pass the response in an error later, we must clone it, because\n    // response.body can only be consumed once.\n    const responseClone = response.clone();\n\n    const jsonResponse = await response.json();\n\n    if (!response.ok || (\"status\" in jsonResponse && jsonResponse.status !== \"success\")) {\n      if (\"status\" in jsonResponse && \"message\" in jsonResponse) {\n        throw new NchatApiError(\"Nchat server error: \" + jsonResponse.message,\n          responseClone, jsonResponse);\n      } else {\n        throw new FetchError(\"Nchat server error.\", responseClone);\n      }\n    }\n\n    if (!(\"status\" in jsonResponse)) {\n      throw new FetchError(\"Missing 'status' field in nchat response.\", responseClone);\n    }\n\n    return jsonResponse as NchatApiSuccessResponse<T>;\n  }\n\n  static async get<T>(path: string, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n    return this.fetch(path, authKey, init);\n  }\n\n  static async post<T>(path: string, body: any, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n    const postInit = {\n      ...init,\n      \"method\": \"POST\",\n      \"body\": JSON.stringify(body),\n    };\n    return this.fetch<T>(path, authKey, postInit);\n  }\n\n  static async put<T>(path: string, body: any, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n    const putInit = {\n      ...init,\n      \"method\": \"PUT\",\n      \"body\": JSON.stringify(body),\n    };\n    return this.fetch<T>(path, authKey, putInit);\n  }\n\n  static async delete<T>(path: string, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n    const deleteInit = {\n      ...init,\n      \"method\": \"DELETE\",\n    };\n    return this.fetch<T>(path, authKey, deleteInit);\n  }\n\n  private static appendHeaders(\n    headers: HeadersInit,\n    additionalHeaders: { [index: string]: string }) {\n    for (const headerKey in additionalHeaders) {\n      if (additionalHeaders.hasOwnProperty(headerKey)) {\n        if (headers instanceof Headers) {\n          headers.append(headerKey, additionalHeaders[headerKey]);\n        } else if (Array.isArray(headers)) {\n          headers.push([headerKey, additionalHeaders[headerKey]]);\n        } else if (typeof headers === 'object') {\n          headers[headerKey] = additionalHeaders[headerKey];\n        }\n      }\n    }\n  }\n}\n\nexport interface NchatApiSuccessResponse<T> {\n  status: string,\n  data: T,\n}\n\nexport interface NchatApiErrorResponse {\n  status: string,\n  message: string,\n  code: number,\n}\n\nexport class FetchError extends Error {\n  response: Response;\n  constructor(message: string, response: Response) {\n    super(message);\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, FetchError)\n    }\n    this.response = response;\n  }\n}\n\nexport class NchatApiError extends FetchError {\n  body: NchatApiErrorResponse;\n\n  constructor(message: string, response: Response, body: NchatApiErrorResponse) {\n    super(message, response);\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, NchatApiError)\n    }\n    this.body = body;\n  }\n}\n\nexport default NchatApi;\n","import React from \"react\";\nimport { User } from \"../models/User\";\n\ninterface ChatAppContextType {\n  authKey: string,\n  user: User,\n}\n\nexport const ChatAppContext = React.createContext<ChatAppContextType>({\n  authKey: \"\",\n  user: {\n    id: -1,\n    name: \"\",\n    username: \"\"\n  },\n});\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"g\", {\n  stroke: \"#bababa\",\n  strokeLinejoin: \"round\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m23.66 10.666v-5.6004h-19.33v29.869h19.33v-5.6004\",\n  fill: \"none\",\n  strokeLinecap: \"round\",\n  strokeWidth: 5.9988\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m16.192 17.434h13.998v-5.1316l8.932 7.6974-8.932 7.6974v-5.1316h-13.998z\",\n  fill: \"#bababa\",\n  strokeWidth: 0.9998\n}));\n\nvar SvgLogout = function SvgLogout(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 40,\n    height: 40,\n    viewBox: \"0 0 40 40\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgLogout, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/logout.e43442ba.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m3 19.737h34m-17-16.737-0.012014 34\",\n  fill: \"none\",\n  stroke: \"#bababa\",\n  strokeLinecap: \"round\",\n  strokeWidth: 6\n});\n\nvar SvgPlus = function SvgPlus(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 40,\n    height: 40,\n    viewBox: \"0 0 40 40\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgPlus, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/plus.8461f02d.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { ChatAppContext } from '../ChatAppContext';\n\nimport { ReactComponent as LogoutIcon } from './logout.svg';\nimport { ReactComponent as PlusIcon } from './plus.svg';\n\nimport styles from \"./SidebarBanner.module.css\"\n\ninterface SidebarBannerProps extends RouteComponentProps {\n  handleLaunchConversationCreator: () => void,\n  logoutHandler: () => void,\n}\n\nfunction SidebarBanner(props: SidebarBannerProps) {\n  return (\n    <ChatAppContext.Consumer>\n      {\n        context => {\n          return (\n            <header className={styles.main}>\n              <div className={styles.userName}>\n                {context.user.name ?? context.user.username}\n              </div>\n              <button className={styles.button}\n                onClick={props.logoutHandler}>\n                <LogoutIcon className={styles.icon} title=\"Logout\" />\n              </button>\n              <button className={styles.button}\n                onClick={props.handleLaunchConversationCreator}>\n                <PlusIcon className={styles.icon} title=\"New conversation\" />\n              </button>\n            </header>\n          )\n        }\n      }\n    </ChatAppContext.Consumer >\n  );\n}\n\nexport default SidebarBanner;","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\nimport { format as formatDate, differenceInCalendarDays } from 'date-fns';\n\nimport { Conversation } from '../../models/Conversation';\n\nimport styles from \"./ConversationRow.module.css\"\n\ninterface ConversationRowProps extends RouteComponentProps {\n  selected: boolean,\n  conversation: Conversation,\n  handleConversationRowClick: (conversation: Conversation) => void,\n}\n\nfunction ConversationRow(props: ConversationRowProps) {\n  let messageTimeStr = \"\";\n  let lastMessageBody = \"\";\n  if (props.conversation.messages.length > 0) {\n    const lastMessage = props.conversation.messages[props.conversation.messages.length - 1];\n    lastMessageBody = lastMessage.body;\n\n    const daysDifference = differenceInCalendarDays(new Date(), lastMessage.sent);\n\n    if (daysDifference === 0) {\n      messageTimeStr = formatDate(lastMessage.sent, 'p');\n    } else if (daysDifference === 1) {\n      messageTimeStr = \"yesterday\"\n    } else if (daysDifference < 7) {\n      messageTimeStr = formatDate(lastMessage.sent, 'cccc');\n    } else {\n      messageTimeStr = formatDate(lastMessage.sent, 'P');\n    }\n  }\n\n  const conversationPartnerName = props.conversation.conversationPartner.name\n    ?? props.conversation.conversationPartner.username\n\n  return (\n    <div\n      className={styles.main + (props.selected ? \" \" + styles.main_selected : \"\")\n      }\n      onClick={() => props.handleConversationRowClick(props.conversation)}>\n      <div className={styles.bubble}>\n        {conversationPartnerName.split(\" \").slice(0, 2).map(e => e.charAt(0).toUpperCase())}\n      </div>\n      <div className={styles.full}>\n        <div className={styles.header}>\n          <div className={styles.name}>\n            {conversationPartnerName}\n          </div>\n          <div className={styles.time}>{messageTimeStr}</div>\n        </div>\n        <div className={styles.message}>\n          {lastMessageBody}\n        </div>\n      </div>\n    </div >\n  );\n}\n\nexport default ConversationRow;\n","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport ConversationRow from './ConversationRow';\nimport { Conversation } from '../../models/Conversation';\n\nimport styles from \"./ConversationList.module.css\"\n\ninterface ConversationListProps extends RouteComponentProps {\n  conversations: Conversation[],\n  selectedConversationUuid: string | null,\n  handleConversationRowClick: (conversation: Conversation) => void,\n}\n\nfunction ConversationList(props: ConversationListProps) {\n  const conversationRows = props.conversations.map(conversation => {\n    return (\n      <ConversationRow\n        key={conversation.uuid}\n        selected={conversation.uuid === props.selectedConversationUuid}\n        conversation={conversation}\n        handleConversationRowClick={props.handleConversationRowClick} />\n    );\n  });\n  return (\n    <div className={styles.main}>\n      {conversationRows}\n    </div>\n  );\n}\n\nexport default ConversationList;\n","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport SidebarBanner from './SidebarBanner';\nimport ConversationList from './ConversationList';\nimport { Conversation } from '../../models/Conversation';\n\nimport { ReactComponent as LogoutIcon } from './logout.svg';\nimport { ReactComponent as PlusIcon } from './plus.svg';\n\nimport styles from './Sidebar.module.css'\n\ninterface SidebarProps extends RouteComponentProps {\n  conversations: Conversation[],\n  selectedConversationUuid: string | null,\n  handleLaunchConversationCreator: () => void,\n  handleConversationRowClick: (conversation: Conversation) => void,\n  logoutHandler: () => void,\n}\n\nfunction Sidebar(props: SidebarProps) {\n  return (\n    <nav className={styles.main}>\n      <div className={styles.control}>\n        <button className={styles.button}\n          onClick={props.handleLaunchConversationCreator}>\n          <PlusIcon className={styles.icon} title=\"New Conversation\" />\n        </button>\n      </div>\n      <SidebarBanner\n        handleLaunchConversationCreator={props.handleLaunchConversationCreator}\n        logoutHandler={props.logoutHandler} />\n      <ConversationList\n        conversations={props.conversations}\n        selectedConversationUuid={props.selectedConversationUuid}\n        handleConversationRowClick={props.handleConversationRowClick} />\n      <div className={styles.control}>\n        <button className={styles.button}\n          onClick={props.logoutHandler}>\n          <LogoutIcon className={styles.icon} title=\"Logout\" />\n        </button>\n      </div>\n    </nav>\n  );\n}\n\nexport default Sidebar;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"translate(-9.6323e-7 -10.288)\"\n}, /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"matrix(1.0981 0 0 1.0981 -11.363 -2.7657)\",\n  strokeWidth: 0.91067\n}, /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"matrix(.70143 0 0 .70143 3.8237 -10.6)\",\n  fill: \"#66c072\",\n  fillRule: \"evenodd\",\n  strokeWidth: 1.2983\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m22.115 44.874v46.131h-12.814l-2e-7 -58.946h38.443v12.814\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m47.744 44.874h12.814v46.131h-12.814z\"\n}))));\n\nvar SvgLogoCompact = function SvgLogoCompact(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 39.48,\n    height: 45.402,\n    viewBox: \"0 0 39.48 45.402\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgLogoCompact, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/logoCompact.70d85da3.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"matrix(1.0981 0 0 1.0981 -11.363 -2.7657)\"\n}, /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"matrix(.70143 0 0 .70143 3.8237 -10.6)\",\n  fill: \"#66c072\",\n  fillRule: \"evenodd\",\n  strokeWidth: 1.2983\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m22.115 44.874v46.131h-12.814l-2e-7 -58.946h38.443v12.814\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m47.744 44.874h12.814v46.131h-12.814z\"\n})), /*#__PURE__*/React.createElement(\"g\", {\n  strokeWidth: 0.24095,\n  \"aria-label\": \"chat\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m82.203 29.191h6.4659q-0.36738-3.3799-1.7634-5.8047-1.3961-2.4982-3.6004-4.1147-2.1308-1.6165-4.9964-2.3513-2.7921-0.80824-6.0251-0.80824-4.4821 0-7.862 1.6165-3.3799 1.543-5.6577 4.3351-2.2043 2.7186-3.3064 6.4659-1.1021 3.6738-1.1021 7.9355t1.1021 7.862q1.1756 3.5269 3.3799 6.0986 2.2778 2.5717 5.5842 3.9677 3.3799 1.3961 7.715 1.3961 7.2742 0 11.462-3.8208 4.2616-3.8208 5.2903-10.875h-6.3925q-0.58781 4.4086-3.233 6.8333-2.5717 2.4247-7.2007 2.4247-2.9391 0-5.0699-1.1756-2.1308-1.1756-3.4534-3.086-1.3226-1.9839-1.9839-4.4821-0.58781-2.4982-0.58781-5.1434 0-2.8656 0.58781-5.5107 0.58781-2.7186 1.9104-4.776 1.3961-2.0573 3.6738-3.3064 2.2778-1.2491 5.6577-1.2491 3.9677 0 6.319 1.9839 2.3513 1.9839 3.086 5.5842z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m95.878 2.5186v52.462h6.2455v-21.455q0-2.5717 0.66129-4.7025 0.73477-2.2043 2.1308-3.8208 1.3961-1.6165 3.4534-2.4982 2.1308-0.88172 4.9964-0.88172 3.6004 0 5.6577 2.0573 2.0573 2.0573 2.0573 5.5842v25.717h6.2455v-24.982q0-3.086-0.66129-5.5842-0.58781-2.5717-2.1308-4.4086t-4.0412-2.8656q-2.4982-1.0287-6.2455-1.0287-1.69 0-3.5269 0.36738-1.7634 0.36738-3.4534 1.1756-1.6165 0.73477-2.9391 1.9839-1.3226 1.1756-2.0574 2.9391h-0.14695v-20.059z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m170.43 54.834q-1.6165 0.9552-4.4821 0.9552-2.4247 0-3.8943-1.3226-1.3961-1.3961-1.3961-4.4821-2.5717 3.086-6.0251 4.4821-3.3799 1.3226-7.3477 1.3226-2.5717 0-4.9229-0.58781-2.2778-0.58781-3.9677-1.8369t-2.7186-3.233q-0.9552-2.0573-0.9552-4.9229 0-3.233 1.1022-5.2903t2.8656-3.3064q1.8369-1.3226 4.1147-1.9839 2.3512-0.66129 4.776-1.1021 2.5717-0.51434 4.8494-0.73477 2.3512-0.29391 4.1147-0.73477 1.7634-0.51434 2.7921-1.3961 1.0287-0.9552 1.0287-2.7186 0-2.0573-0.80824-3.3064-0.73476-1.2491-1.9839-1.9104-1.1756-0.66129-2.7186-0.88172-1.4695-0.22043-2.9391-0.22043-3.9677 0-6.6129 1.543-2.6452 1.4695-2.8656 5.6577h-6.2455q0.14696-3.5269 1.4695-5.9516 1.3226-2.4247 3.5269-3.8943 2.2043-1.543 4.9964-2.2043 2.8656-0.66129 6.0986-0.66129 2.5717 0 5.0699 0.36738 2.5717 0.36738 4.629 1.543 2.0573 1.1021 3.3064 3.1595 1.2491 2.0573 1.2491 5.3638v19.545q0 2.2043 0.22043 3.233 0.2939 1.0287 1.7634 1.0287 0.80824 0 1.9104-0.36738zm-10.14-19.471q-1.1756 0.88172-3.086 1.3226-1.9104 0.36738-4.0412 0.66129-2.0574 0.22043-4.1882 0.58781-2.1308 0.29391-3.8208 1.0287t-2.7921 2.1308q-1.0287 1.3226-1.0287 3.6738 0 1.543 0.58782 2.6452 0.66129 1.0287 1.6165 1.69 1.0287 0.66129 2.3512 0.9552 1.3226 0.29391 2.7921 0.29391 3.086 0 5.2903-0.80824 2.2043-0.88172 3.6004-2.1308 1.3961-1.3226 2.0574-2.7921 0.66129-1.543 0.66129-2.8656z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m184.91 16.993v-11.389h-6.2455v11.389h-6.4659v5.5107h6.4659v24.174q0 2.6452 0.51434 4.2616 0.51433 1.6165 1.543 2.4982 1.1022 0.88172 2.7921 1.2491 1.7634 0.29391 4.1882 0.29391h4.776v-5.5107h-2.8656q-1.4695 0-2.4247-0.07348-0.88171-0.14695-1.396-0.51434t-0.73477-1.0287q-0.14695-0.66129-0.14695-1.7634v-23.586h7.5681v-5.5107z\"\n})));\n\nvar SvgLogo = function SvgLogo(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 200,\n    height: 58.496,\n    viewBox: \"0 0 200 58.496\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgLogo, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/logo.09a69678.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react'\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { Conversation } from '../../models/Conversation';\n\nimport { ReactComponent as NchatLogoCompact } from '../../assets/logoCompact.svg';\nimport { ReactComponent as NchatLogo } from '../../assets/logo.svg';\n\nimport styles from './ConversationViewBanner.module.css'\n\ninterface ConversationViewBannerProps extends RouteComponentProps {\n  selectedConversation: Conversation,\n}\n\ninterface ConversationViewBannerState {\n}\n\nfunction ConversationViewBanner(props: ConversationViewBannerProps) {\n  return (\n    <header className={styles.main}>\n      <div className={styles.name}>\n        {props.selectedConversation.conversationPartner.name\n          ?? props.selectedConversation.conversationPartner.username}\n      </div>\n      <NchatLogoCompact className={styles.logoCompact} title=\"nchat logo\" />\n      <NchatLogo className={styles.logo} title=\"nchat logo\" />\n    </header>\n  );\n}\n\nexport default ConversationViewBanner;","import React from \"react\"\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { ChatAppContext } from \"../ChatAppContext\";\nimport { Message } from \"../../models/Message\";\n\nimport styles from './MessageView.module.css'\n\ninterface MessageViewProps extends RouteComponentProps {\n  message: Message,\n}\n\nfunction MessageView(props: MessageViewProps) {\n  return (\n    <ChatAppContext.Consumer>\n      {context =>\n        <div\n          className={\n            styles.main\n            + (context.user?.id === props.message.senderId\n              ? (props.message.id === null\n                ? \" \" + styles.fromUs_unsynced\n                : \" \" + styles.fromUs_synced\n              )\n              : \" \" + styles.fromThem)\n          }>\n          <div className={styles.messageBody}>\n            {props.message.body}\n          </div>\n        </div >\n      }\n    </ChatAppContext.Consumer >\n  );\n}\n\nexport default MessageView;\n","import React from 'react'\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport MessageView from './MessageView';\nimport { Message } from '../../models/Message';\nimport { ChatAppContext } from '../ChatAppContext';\n\nimport styles from './MessagesView.module.css'\nimport loadingIconStyles from '../../assets/LoadingIcon.module.css';\n\ninterface MessagesViewProps extends RouteComponentProps {\n  isLoading: boolean,\n  messages: Message[],\n}\n\ninterface MessagesViewState {\n}\n\ninterface MessagesViewSnapshot {\n  isScrolledToBottom: boolean,\n}\n\nclass MessagesView extends React.Component<MessagesViewProps, MessagesViewState> {\n  // Number of pixels chat div can be scrolled above bottom to still be considered at bottom\n  SCROLL_TOLERANCE = 40;\n\n  conversationViewDiv = React.createRef<HTMLDivElement>();\n\n  static contextType = ChatAppContext;\n  context!: React.ContextType<typeof ChatAppContext>\n\n  constructor(props: MessagesViewProps) {\n    super(props);\n    this.scrollToBottom = this.scrollToBottom.bind(this);\n  }\n\n  componentDidMount() {\n    this.scrollToBottom();\n  }\n\n  getSnapshotBeforeUpdate(prevProps: MessagesViewProps, prevState: MessagesViewState):\n    MessagesViewSnapshot {\n    return {\n      isScrolledToBottom: this.isScrolledToBottom()\n    };\n  }\n\n  componentDidUpdate(\n    prevProps: MessagesViewProps,\n    prevState: MessagesViewState,\n    snapshot: MessagesViewSnapshot,\n  ) {\n    const prevMessages = prevProps.messages;\n    const messages = this.props.messages;\n\n    // If there's a new message added\n    if (prevMessages[prevMessages.length - 1]?.uuid !== messages[messages.length - 1]?.uuid) {\n      // Keep us scrolled to the bottom if we're already there, or if the last message\n      // added is from us (i.e. we just sent a message).\n      if (snapshot.isScrolledToBottom\n        || messages[messages.length - 1].senderId === this.context.user.id) {\n        this.scrollToBottom();\n      }\n    }\n  }\n\n  private isScrolledToBottom(): boolean {\n    const node = this.conversationViewDiv.current;\n    if (node === null) {\n      return true;\n    }\n    return node.scrollTop >= (node.scrollHeight - node.clientHeight) - this.SCROLL_TOLERANCE;\n  }\n\n  private scrollToBottom() {\n    const node = this.conversationViewDiv.current;\n    if (node === null) {\n      return;\n    }\n    node.scrollTo(0, node.scrollHeight - node.clientHeight);\n  }\n\n  render() {\n    let messages: JSX.Element[] = this.props.messages.map(message => {\n      return <MessageView key={message.uuid} message={message} />\n    });\n    return (\n      <div className={styles.main} ref={this.conversationViewDiv}>\n        {this.props.isLoading &&\n          <div className={styles.loading}>\n            <div className={styles.loadingIcon + \" \" + loadingIconStyles.main}></div>\n          </div>}\n        {messages}\n      </div>\n    );\n  }\n}\n\nexport default MessagesView;\n","import React, { ChangeEvent, KeyboardEvent } from 'react'\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport styles from './MessageInput.module.css'\n\ninterface MessageInputProps extends RouteComponentProps {\n  autoFocus?: boolean,\n  disabled?: boolean,\n  handleSendMessage: (messageBody: string) => boolean,\n}\n\ninterface MessageInputState {\n  messageBody: string,\n}\n\nclass MessageInput extends React.Component<MessageInputProps, MessageInputState> {\n  state: MessageInputState = {\n    messageBody: \"\",\n  };\n\n  constructor(props: MessageInputProps) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleClickSend = this.handleClickSend.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  handleChange(event: ChangeEvent<HTMLInputElement>) {\n    this.setState({\n      messageBody: event.target.value,\n    });\n  }\n\n  async handleClickSend() {\n    if (this.state.messageBody.trim() === \"\") {\n      return;\n    }\n    const success = this.props.handleSendMessage(this.state.messageBody);\n    if (success) {\n      this.setState({\n        messageBody: \"\",\n      });\n    }\n  }\n\n  handleKeyDown(event: KeyboardEvent<HTMLInputElement>) {\n    if (event.key === \"Enter\") {\n      this.handleClickSend();\n    }\n  }\n\n  render() {\n    return (\n      <div className={styles.main}>\n        <input\n          name=\"messageBody\"\n          className={styles.input}\n          type=\"text\"\n          value={this.state.messageBody}\n          onKeyDown={this.handleKeyDown}\n          onChange={this.handleChange}\n          autoFocus={this.props.autoFocus}\n          placeholder=\"Type a message\"\n          autoComplete=\"off\" />\n        <button\n          className={styles.button + \" button\"}\n          onClick={this.handleClickSend}\n          disabled={this.props.disabled}>\n          Send\n          </button>\n      </div>\n    );\n  }\n}\n\nexport default MessageInput;\n","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { Conversation } from '../../models/Conversation';\nimport ConversationViewBanner from './ConversationViewBanner';\nimport MessagesView from './MessagesView';\nimport MessageInput from './MessageInput';\n\nimport styles from './ConversationView.module.css'\n\ninterface ConversationViewProps extends RouteComponentProps {\n  selectedConversation: Conversation,\n  handleSendMessage: (messageBody: string) => void,\n}\n\nfunction ConversationView(props: ConversationViewProps) {\n  const autoFocus = window.matchMedia(\"(min-width: 700px)\").matches;\n\n  return (\n    <div className={styles.main} >\n      <ConversationViewBanner\n        selectedConversation={props.selectedConversation} />\n      <MessagesView\n        isLoading={props.selectedConversation.isLoading}\n        messages={props.selectedConversation.messages} />\n      <MessageInput\n        autoFocus={autoFocus}\n        handleSendMessage={\n          (messageBody) => {\n            props.handleSendMessage(messageBody);\n            return true;\n          }\n        } />\n    </div>\n  );\n}\n\nexport default ConversationView","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"ellipse\", {\n  cx: 20,\n  cy: 20,\n  rx: 18,\n  ry: 18,\n  strokeWidth: 4\n});\n\nvar SvgGreenCheck = function SvgGreenCheck(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 40,\n    height: 40,\n    viewBox: \"0 0 40 40\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, /*#__PURE__*/React.createElement(\"g\", {\n    fill: \"none\",\n    stroke: \"#66c072\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"m10.9 21.485 5.2674 5.2314 12.252-12.169\",\n    strokeWidth: 4,\n    style: {\n      paintOrder: \"normal\"\n    }\n  }), _ref2));\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgGreenCheck, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/greenCheck.9955ebcf.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"g\", {\n  fill: \"none\"\n}, /*#__PURE__*/React.createElement(\"circle\", {\n  cx: 100,\n  cy: 100,\n  r: 0,\n  stroke: \"#ab2121\",\n  strokeWidth: 19.413\n}), /*#__PURE__*/React.createElement(\"g\", {\n  stroke: \"#bc2020\",\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m13 13 14 14\",\n  strokeWidth: 4\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m27 13-14 14\",\n  strokeWidth: 4\n}), /*#__PURE__*/React.createElement(\"ellipse\", {\n  cx: 20,\n  cy: 20,\n  rx: 18,\n  ry: 18,\n  strokeWidth: 4\n})));\n\nvar SvgRedX = function SvgRedX(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 40,\n    height: 40,\n    viewBox: \"0 0 40 40\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgRedX, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/redX.9d8ae0c2.svg\";\nexport { ForwardRef as ReactComponent };","import React, { ChangeEvent, FocusEvent } from 'react';\n\nimport { ReactComponent as GreenCheck } from './greenCheck.svg';\nimport { ReactComponent as RedX } from './redX.svg';\n\nimport { ReactComponent as NchatLogoCompact } from '../../assets/logoCompact.svg';\nimport { ReactComponent as NchatLogo } from '../../assets/logo.svg';\n\nimport styles from './ConversationCreatorViewBanner.module.css'\nimport loadingIconStyles from '../../assets/LoadingIcon.module.css';\n\nexport enum ConversationCreatorViewBannerStatus {\n  Empty,\n  Loading,\n  Ok,\n  Error,\n}\n\ninterface ConversationCreatorViewBannerProps {\n  conversationCreatorUsername: string,\n  status: ConversationCreatorViewBannerStatus,\n  handleChange: (event: ChangeEvent<HTMLInputElement>) => void,\n  handleBlur: (event: FocusEvent<HTMLInputElement>) => void,\n}\n\ninterface ConversationCreatorViewBannerState {\n}\n\nclass ConversationCreatorViewBanner extends\n  React.Component<ConversationCreatorViewBannerProps, ConversationCreatorViewBannerState> {\n  render() {\n    let status: JSX.Element;\n    switch (this.props.status) {\n      case ConversationCreatorViewBannerStatus.Empty:\n        status = <span className={styles.to}>To:</span>;\n        break;\n      case ConversationCreatorViewBannerStatus.Loading:\n        status = <div className={styles.loading + \" \" + loadingIconStyles.main}\n          title=\"Checking username...\" ></div >;\n        break;\n      case ConversationCreatorViewBannerStatus.Error:\n        status = <RedX className={styles.error}\n          title=\"Username doesn't exist\" />\n        break;\n      case ConversationCreatorViewBannerStatus.Ok:\n        status = <GreenCheck className={styles.success}\n          title=\"Username OK\" />\n        break;\n    }\n    return (\n      <header className={styles.main} >\n        <div className={styles.status}>\n          <label\n            htmlFor=\"ConversationCreatorViewBannerInput\"\n            className={styles.label}>\n            {status}\n          </label>\n        </div>\n        <input\n          id=\"ConversationCreatorViewBannerInput\"\n          className={styles.input}\n          type=\"text\"\n          value={this.props.conversationCreatorUsername}\n          autoFocus={true}\n          onChange={this.props.handleChange}\n          onBlur={this.props.handleBlur}\n          placeholder=\"Username\"\n          autoComplete=\"off\" />\n        <NchatLogoCompact className={styles.logoCompact} title=\"nchat logo\" />\n        <NchatLogo className={styles.logo} title=\"nchat logo\" />\n      </header>\n    );\n  }\n}\n\nexport default ConversationCreatorViewBanner;","import React, { ChangeEvent, FocusEvent } from 'react';\n\nimport ConversationCreatorViewBanner, { ConversationCreatorViewBannerStatus }\n  from './ConversationCreatorViewBanner';\nimport MessageInput from './MessageInput';\nimport { User } from '../../models/User';\nimport NchatApi from '../../utils/NchatApi';\nimport { ChatAppContext } from '../ChatAppContext';\nimport { UserJson } from '../../utils/json/UserJson';\n\nimport styles from './ConversationCreatorView.module.css';\n\ninterface GetUserResponse {\n  user: UserJson,\n}\n\ninterface ConversationCreatorViewProps {\n  handleCreateConversation: (messageBody: string, conversationPartner: User) => void,\n}\n\ninterface ConversationCreatorViewState {\n  username: string,\n  conversationPartner: User | null,\n  usernameInputStatus: ConversationCreatorViewBannerStatus,\n}\n\nclass ConversationCreatorView\n  extends React.Component<ConversationCreatorViewProps, ConversationCreatorViewState> {\n\n  static contextType = ChatAppContext;\n  context!: React.ContextType<typeof ChatAppContext>\n\n  state: ConversationCreatorViewState = {\n    username: \"\",\n    conversationPartner: null,\n    usernameInputStatus: ConversationCreatorViewBannerStatus.Empty,\n  }\n\n  constructor(props: ConversationCreatorViewProps) {\n    super(props);\n    this.handleUsernameChange = this.handleUsernameChange.bind(this);\n    this.handleSendMessage = this.handleSendMessage.bind(this);\n    this.handleUsernameInputBlur = this.handleUsernameInputBlur.bind(this);\n  }\n\n  handleUsernameChange(event: ChangeEvent<HTMLInputElement>) {\n    const username = event.target.value;\n    this.setState({\n      usernameInputStatus: ConversationCreatorViewBannerStatus.Empty,\n      username: username,\n    });\n  }\n\n  handleSendMessage(messageBody: string): boolean {\n    if (this.state.conversationPartner === null) {\n      return false;\n    }\n    this.props.handleCreateConversation(messageBody, this.state.conversationPartner);\n    return true;\n  }\n\n  async handleUsernameInputBlur(event: FocusEvent<HTMLInputElement>) {\n    this.setState({\n      usernameInputStatus: ConversationCreatorViewBannerStatus.Loading,\n    });\n\n    const username = this.state.username.trim();\n\n    if (username === \"\") {\n      this.setState({\n        usernameInputStatus: ConversationCreatorViewBannerStatus.Empty,\n      });\n      return;\n    }\n\n    try {\n      const conversationPartner = await this.getConversationPartner(username);\n      this.setState({\n        conversationPartner: conversationPartner,\n        usernameInputStatus: ConversationCreatorViewBannerStatus.Ok,\n      });\n    } catch (err) {\n      this.setState({\n        conversationPartner: null,\n        usernameInputStatus: ConversationCreatorViewBannerStatus.Error,\n      });\n    }\n  }\n\n  async getConversationPartner(username: string): Promise<User> {\n    const response =\n      await NchatApi.get<GetUserResponse>(\"users/\" + username, this.context.authKey);\n    const userJson = response.data.user;\n\n    return {\n      id: userJson.id,\n      username: userJson.username,\n      name: userJson.name,\n    }\n  }\n\n  render() {\n    return (\n      <div className={styles.main}>\n        <ConversationCreatorViewBanner\n          conversationCreatorUsername={this.state.username}\n          status={this.state.usernameInputStatus}\n          handleChange={this.handleUsernameChange}\n          handleBlur={this.handleUsernameInputBlur} />\n        <div className={styles.spacer} />\n        <MessageInput\n          autoFocus={false}\n          handleSendMessage={this.handleSendMessage}\n          disabled={this.state.usernameInputStatus !== ConversationCreatorViewBannerStatus.Ok} />\n      </div>\n    )\n  }\n}\n\nexport default ConversationCreatorView;","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { Conversation } from '../../models/Conversation';\nimport ConversationView from './ConversationView';\nimport ConversationCreatorView from './ConversationCreatorView';\nimport { User } from '../../models/User';\n\nimport { ReactComponent as NchatLogoCompact } from '../../assets/logoCompact.svg';\nimport { ReactComponent as NchatLogo } from '../../assets/logo.svg';\nimport { ReactComponent as PlusIcon } from '../sidebar/plus.svg';\n\nimport styles from \"./ContentView.module.css\";\n\ninterface ContentViewProps extends RouteComponentProps {\n  isConversationCreatorOpen: boolean,\n  selectedConversation: Conversation | null,\n  handleCreateConversation: (messageBody: string, conversationPartner: User) => void,\n  handleSendMessage: (messageBody: string) => void,\n}\n\nfunction ContentView(props: ContentViewProps) {\n  let content: JSX.Element;\n  if (props.isConversationCreatorOpen) {\n    content =\n      <ConversationCreatorView\n        handleCreateConversation={props.handleCreateConversation} />\n  } else if (props.selectedConversation !== null) {\n    content =\n      <ConversationView\n        selectedConversation={props.selectedConversation}\n        handleSendMessage={props.handleSendMessage}\n        key={props.selectedConversation?.uuid} />\n  } else {\n    const actionPhrase = window.matchMedia(\"(hover: hover)\").matches ? \"Click\" : \"Tap\";\n    content =\n      <div className={styles.noConversationContainer}>\n        <div className={styles.noConversation}>\n          <NchatLogoCompact className={styles.logo + \" \" + styles.logoCompact} title=\"nchat logo\" />\n          <NchatLogo className={styles.logo + \" \" + styles.logoFull} title=\"nchat logo\" />\n          <div className={styles.hint}>\n            {actionPhrase}\n            &nbsp;\n          <PlusIcon className={styles.newChatIcon} title=\"New conversation\" />\n          &nbsp;\n          to start a new conversation.\n        </div>\n        </div>\n      </div >\n  }\n  return (\n    <main className={styles.main}>\n      {content}\n    </main>\n  );\n}\n\nexport default ContentView;\n","import React from 'react';\nimport { navigate, RouteComponentProps } from '@reach/router';\nimport { v4 as uuidv4 } from 'uuid';\nimport update from 'immutability-helper';\nimport parseISO from 'date-fns/parseISO'\n\nimport NchatApi from '../utils/NchatApi';\nimport Sidebar from './sidebar/Sidebar'\nimport ContentView from './contentView/ContentView'\nimport { User } from '../models/User';\nimport { Conversation } from '../models/Conversation';\nimport { Message } from '../models/Message';\nimport { ConversationJson } from '../utils/json/ConversationJson';\nimport { MessageJson } from '../utils/json/MessageJson';\nimport { ChatAppContext } from './ChatAppContext';\nimport NchatWebSocket, { WSNotification, WSRequest }\n  from '../utils/NchatWebSocket';\n\nimport styles from './ChatApp.module.css';\n\ninterface GetConversationResponse {\n  conversation: ConversationJson,\n}\n\ninterface WSMessageNotificationData {\n  message: MessageJson,\n  conversation: ConversationJson,\n}\n\ninterface WSMessageRequestData {\n  username: string,\n  body: string,\n}\n\ninterface WSMessageSuccessResponseData {\n  message: MessageJson,\n  conversation: ConversationJson,\n}\n\ninterface WSMessageErrorResponseData {\n}\n\ninterface ChatAppProps extends RouteComponentProps {\n  authKey: string,\n  user: User,\n  conversations: Conversation[],\n  webSocket: NchatWebSocket,\n  logoutHandler: () => void,\n}\n\ninterface ChatAppState {\n  conversations: Conversation[],\n  selectedConversationUuid: string | null,\n  isConversationCreatorOpen: boolean,\n}\n\nclass ChatApp extends React.Component<ChatAppProps, ChatAppState> {\n  state: ChatAppState = {\n    conversations: this.props.conversations,\n    selectedConversationUuid: null,\n    isConversationCreatorOpen: false,\n  }\n\n  constructor(props: ChatAppProps) {\n    super(props);\n    this.handleMessageReceived = this.handleMessageReceived.bind(this);\n    this.handleLaunchConversationCreator = this.handleLaunchConversationCreator.bind(this);\n    this.handleConversationRowClick = this.handleConversationRowClick.bind(this);\n    this.handleCreateConversation = this.handleCreateConversation.bind(this)\n    this.handleSendMessage = this.handleSendMessage.bind(this);\n    this.logoutHandler = this.logoutHandler.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.webSocket.addNotificationListener(\"newMessage\", this.handleMessageReceived);\n  }\n\n  handleLaunchConversationCreator() {\n    this.setState({\n      selectedConversationUuid: null,\n      isConversationCreatorOpen: true,\n    });\n  }\n\n  async handleConversationRowClick(conversation: Conversation) {\n    if (conversation.uuid === this.state.selectedConversationUuid) {\n      return;\n    }\n\n    this.setState({\n      isConversationCreatorOpen: false,\n      selectedConversationUuid: conversation.uuid,\n    });\n\n    if (!conversation.isHistoryLoaded && !conversation.isLoading) {\n      let conversationIndex = this.state.conversations.findIndex(c => c.uuid === conversation.uuid);\n      const loadingConversations = update(this.state.conversations,\n        {\n          [conversationIndex]: {\n            isLoading: {\n              $set: true,\n            },\n          },\n        },\n      );\n\n      this.setState({\n        conversations: loadingConversations,\n      });\n\n      const response = await NchatApi.get<GetConversationResponse>(\n        \"conversations/\" + conversation.id, this.props.authKey);\n\n      const retrievedMessages: Message[] = response.data.conversation.messages.map(message => {\n        return {\n          uuid: uuidv4(),\n          id: message.id,\n          senderId: message.senderId,\n          body: message.body,\n          sent: parseISO(message.sent),\n        }\n      });\n\n      conversationIndex = this.state.conversations.findIndex(c => c.uuid === conversation.uuid);\n      const updatedConversations = update(this.state.conversations,\n        {\n          [conversationIndex]: {\n            messages: {\n              $set: retrievedMessages,\n            },\n            isLoading: {\n              $set: false,\n            },\n            isHistoryLoaded: {\n              $set: true,\n            }\n          }\n        },\n      );\n\n      this.setState({\n        conversations: updatedConversations,\n      });\n    }\n  }\n\n  handleMessageReceived(notification: WSNotification<WSMessageNotificationData>) {\n    const messageJson = notification.data.message;\n    const conversationJson = notification.data.conversation;\n\n    const newMessage: Message = {\n      uuid: uuidv4(),\n      id: messageJson.id,\n      body: messageJson.body,\n      senderId: messageJson.senderId,\n      sent: parseISO(messageJson.sent),\n    };\n\n    const conversationIndex = this.state.conversations.findIndex(c => c.id === conversationJson.id);\n    if (conversationIndex === -1) {\n      const newConversation: Conversation = {\n        uuid: uuidv4(),\n        id: conversationJson.id,\n        conversationPartner: {\n          id: conversationJson.conversationPartner.id,\n          username: conversationJson.conversationPartner.username,\n          name: conversationJson.conversationPartner.name,\n        },\n        messages: [newMessage],\n        isHistoryLoaded: true,\n        isLoading: false,\n      };\n      const updatedConversations = [\n        newConversation,\n        ...this.state.conversations,\n      ];\n      this.setState({\n        conversations: updatedConversations,\n      });\n    } else {\n      const updatedConversations =\n        this.addMessageToConversation(this.state.conversations, conversationIndex, newMessage);\n      this.setState({\n        conversations: updatedConversations,\n      });\n    }\n  }\n\n  async handleCreateConversation(messageBody: string, conversationPartner: User) {\n    const newConversation: Conversation = {\n      uuid: uuidv4(),\n      id: null,\n      conversationPartner: conversationPartner,\n      isHistoryLoaded: true,\n      isLoading: false,\n      messages: [],\n    };\n\n    this.setState((state, props) => {\n      const updatedConversations = [\n        newConversation,\n        ...state.conversations,\n      ];\n      return {\n        conversations: updatedConversations,\n        selectedConversationUuid: newConversation.uuid,\n        isConversationCreatorOpen: false,\n      };\n    });\n\n    this.sendMessage(newConversation.uuid, messageBody);\n  }\n\n  async handleSendMessage(messageBody: string) {\n    if (this.state.selectedConversationUuid === null) {\n      return;\n    }\n\n    this.sendMessage(this.state.selectedConversationUuid, messageBody);\n  }\n\n  logoutHandler() {\n    this.props.logoutHandler();\n    navigate(\"/accounts/get-started\");\n  }\n\n  private addMessageToConversation(conversations: Conversation[], index: number, message: Message):\n    Conversation[] {\n    const updatedConversation = update(conversations[index],\n      {\n        messages: {\n          $push: [message],\n        }\n      }\n    );\n    const withRemovedConversation = update(conversations,\n      {\n        $splice: [[index, 1]]\n      }\n    );\n    return [\n      updatedConversation,\n      ...withRemovedConversation,\n    ]\n  }\n\n  private async sendMessage(conversationUuid: string, body: string) {\n    const newMessage: Message = {\n      uuid: uuidv4(),\n      id: null,\n      senderId: this.props.user.id,\n      body: body,\n      sent: new Date(),\n    }\n\n    this.setState((state, props) => {\n      const conversationIndex = this.findConversationIndex(conversationUuid, state.conversations);\n      const updatedConversations =\n        this.addMessageToConversation(state.conversations, conversationIndex, newMessage);\n\n      return {\n        conversations: updatedConversations,\n      }\n    }, async () => {\n      const conversation = this.findConversation(conversationUuid);\n      if (conversation === null) {\n        return;\n      }\n\n      const request: WSRequest<WSMessageRequestData> = {\n        type: \"request\",\n        method: \"sendMessage\",\n        data: {\n          username: conversation.conversationPartner.username,\n          body: body,\n        },\n      };\n\n      const response = await this.props.webSocket.sendRequest\n        <WSMessageRequestData, WSMessageSuccessResponseData>(request);\n\n      this.setState((state, props) => {\n        const conversationIndex = this.findConversationIndex(conversationUuid, state.conversations);\n        const messageIndex = state.conversations[conversationIndex].messages.findIndex(m => {\n          return m.uuid === newMessage.uuid;\n        });\n\n        const syncedConversations = update(state.conversations,\n          {\n            [conversationIndex]: {\n              id: {\n                $set: response.data.conversation.id,\n              },\n              messages: {\n                [messageIndex]: {\n                  id: {\n                    $set: response.data.message.id,\n                  },\n                  sent: {\n                    $set: parseISO(response.data.message.sent),\n                  }\n                },\n              },\n            },\n          },\n        );\n\n        return {\n          conversations: syncedConversations,\n        };\n      });\n    });\n  }\n\n  private findConversationIndex(uuid: string | null, conversations?: Conversation[]): number {\n    const toSearch = conversations ? conversations : this.state.conversations;\n    if (uuid === null) {\n      return -1;\n    }\n    return toSearch.findIndex(c => c.uuid === uuid);\n  }\n\n  private findConversation(uuid: string | null, conversations?: Conversation[]): Conversation | null {\n    const toSearch = conversations ? conversations : this.state.conversations;\n    if (uuid === null) {\n      return null;\n    }\n    return toSearch.find(c => c.uuid === uuid) ?? null;\n  }\n\n  render() {\n    const contextValue = {\n      authKey: this.props.authKey,\n      user: this.props.user,\n    }\n\n    const selectedConversation = this.findConversation(this.state.selectedConversationUuid);\n\n    return (\n      <div className={styles.main}>\n        <ChatAppContext.Provider value={contextValue}>\n          <Sidebar\n            conversations={this.state.conversations}\n            selectedConversationUuid={this.state.selectedConversationUuid}\n            handleConversationRowClick={this.handleConversationRowClick}\n            handleLaunchConversationCreator={this.handleLaunchConversationCreator}\n            logoutHandler={this.logoutHandler} />\n          <ContentView\n            isConversationCreatorOpen={this.state.isConversationCreatorOpen}\n            handleCreateConversation={this.handleCreateConversation}\n            handleSendMessage={this.handleSendMessage}\n            selectedConversation={selectedConversation} />\n        </ChatAppContext.Provider>\n      </div >\n    );\n  }\n\n  componentWillUnmount() {\n    this.props.webSocket.close();\n  }\n}\n\nexport default ChatApp;\n","export interface WSNotification<T> {\n  type: \"notification\",\n  method: string,\n  data: T,\n}\n\nexport interface WSRequest<T> {\n  id?: number,\n  type: \"request\",\n  method: string,\n  data: T,\n}\n\nexport interface WSSuccessResponse<T> {\n  id: number,\n  type: \"response\",\n  status: \"success\",\n  data: T,\n}\n\nexport interface WSErrorResponse<T> {\n  id: number,\n  type: \"response\",\n  status: \"error\",\n  code: number,\n  message: string,\n  data: T,\n}\n\ntype NotificationListener = (notification: WSNotification<any>) => void\ninterface NotificationListeners {\n  [index: string]: NotificationListener[]\n}\n\ntype PromiseResolveFunc = (value: WSSuccessResponse<any>) => void;\ntype PromiseRejectFunc = (reason: WSErrorResponse<any>) => void;\ntype PromiseCallbacks = {\n  resolve: PromiseResolveFunc,\n  reject: PromiseRejectFunc,\n}\n\nclass NchatWebSocket {\n  static websocketUrl = NchatWebSocket.getWebsocketUrl();\n\n  webSocket: WebSocket;\n  isAuthMessageSent = false;\n  requestId = 0;\n  requestPromiseCallbacks: PromiseCallbacks[] = [];\n  notificationListeners: NotificationListeners = {};\n\n  static getWebsocketUrl(): string {\n    let location = window.location;\n    let url = (location.protocol === \"https:\" ? \"wss:\" : \"ws:\");\n    url += \"//\" + location.host + \"/api/v1/chat\";\n    return url;\n  }\n\n  static createWebSocket(): Promise<NchatWebSocket> {\n    const webSocket = new WebSocket(this.websocketUrl, \"nchat\");\n    return new Promise((resolve, reject) => {\n      webSocket.addEventListener(\"open\", (event: Event) => {\n        const nchatWebSocket = new NchatWebSocket(webSocket);\n        resolve(nchatWebSocket);\n      })\n      webSocket.addEventListener(\"error\", (event: Event) => {\n        reject(event);\n      })\n    });\n  }\n\n  constructor(webSocket: WebSocket) {\n    this.handleMessageReceived = this.handleMessageReceived.bind(this);\n    this.webSocket = webSocket;\n    this.webSocket.addEventListener(\"message\", this.handleMessageReceived);\n  }\n\n  handleMessageReceived(event: MessageEvent) {\n    const data: WSNotification<any> | WSSuccessResponse<any> | WSErrorResponse<any> =\n      JSON.parse(event.data);\n    if (data.type === \"response\") {\n      const callbacks = this.requestPromiseCallbacks[data.id];\n      if (typeof callbacks === 'undefined') {\n        return;\n      }\n\n      if (data.status === \"success\") {\n        callbacks.resolve(data);\n      } else {\n        callbacks.reject(data);\n      }\n    } else if (data.type === \"notification\") {\n      const listeners = this.notificationListeners[data.method];\n      if (typeof listeners === \"undefined\") {\n        return;\n      }\n\n      for (const listener of listeners) {\n        listener(data);\n      }\n    }\n  }\n\n  addNotificationListener(method: string, listener: (notification: WSNotification<any>) => void) {\n    if (this.notificationListeners.hasOwnProperty(method)) {\n      this.notificationListeners[method]?.push(listener);\n    } else {\n      this.notificationListeners[method] = [listener];\n    }\n  }\n\n  sendRequest<T, S>(request: WSRequest<T>):\n    Promise<WSSuccessResponse<S>> {\n    const id = this.getNextId();\n    request.id = id;\n\n    this.webSocket.send(JSON.stringify(request));\n\n    return new Promise((resolve, reject) => {\n      this.registerPromise(id, resolve, reject);\n    });\n  }\n\n  close() {\n    this.webSocket.close();\n  }\n\n  private registerPromise(id: number, resolve: PromiseResolveFunc, reject: PromiseRejectFunc) {\n    this.requestPromiseCallbacks[id] = {\n      resolve: resolve,\n      reject: reject\n    };\n  }\n\n  private getNextId(): number {\n    return this.requestId++;\n  }\n}\n\nexport default NchatWebSocket;","import React, { ChangeEvent, FormEvent } from 'react';\nimport { RouteComponentProps } from '@reach/router';\nimport { Link } from \"@reach/router\";\nimport { NchatApiError } from '../utils/NchatApi';\n\nimport styles from './LoginForm.module.css';\nimport loadingIconStyles from '../assets/LoadingIcon.module.css';\n\nenum LoginFormStatus {\n  Empty,\n  Loading,\n  Error,\n}\n\ninterface LoginFormProps extends RouteComponentProps {\n  authenticateUser: (username: string, password: string) => Promise<void>,\n};\n\ninterface LoginFormState {\n  username: string,\n  password: string,\n  status: {\n    value: LoginFormStatus,\n    message?: string,\n  },\n}\n\nclass LoginForm extends React.Component<LoginFormProps, LoginFormState> {\n  state: LoginFormState = {\n    username: '',\n    password: '',\n    status: {\n      value: LoginFormStatus.Empty,\n    }\n  };\n\n  constructor(props: LoginFormProps) {\n    super(props);\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleChange(event: ChangeEvent<HTMLInputElement>) {\n    switch (event.target.name) {\n      case \"username\":\n        this.setState({\n          username: event.target.value,\n        });\n        break;\n      case \"password\":\n        this.setState({\n          password: event.target.value,\n        });\n        break;\n    }\n  }\n\n  async handleSubmit(event: FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n\n    this.setState({\n      status: {\n        value: LoginFormStatus.Loading,\n      }\n    });\n\n    try {\n      await this.props.authenticateUser(this.state.username, this.state.password);\n    } catch (error) {\n      if (error instanceof NchatApiError && error.body.code === 1) {\n        this.setState({\n          status: {\n            value: LoginFormStatus.Error,\n            message: \"The username or password you entered doesn't match our records. Please try again.\",\n          },\n        });\n      } else {\n        this.setState({\n          status: {\n            value: LoginFormStatus.Error,\n            message: \"Could not login. Please try again later.\",\n          },\n        });\n      }\n    }\n  }\n\n  render() {\n    const autoFocus = window.matchMedia(\"(min-width: 700px)\").matches;\n\n    let status: JSX.Element | null;\n    switch (this.state.status.value) {\n      case LoginFormStatus.Empty:\n        status = null;\n        break;\n      case LoginFormStatus.Loading:\n        status = <div className={styles.loading + \" \" + loadingIconStyles.main}></div>;\n        break;\n      case LoginFormStatus.Error:\n        status =\n          <div className=\"errorMessage\">\n            {this.state.status.message}\n          </div>\n        break;\n    }\n\n    return (\n      <div className={styles.main} >\n        <h1 className={styles.header}>Login</h1>\n        <form onSubmit={this.handleSubmit}>\n          <p><input className=\"textInput\" name=\"username\" type=\"text\" placeholder=\"Username\"\n            value={this.state.username} onChange={this.handleChange} required={true}\n            autoFocus={autoFocus} /></p>\n          <p><input className=\"textInput\" name=\"password\" type=\"password\" placeholder=\"Password\"\n            value={this.state.password} onChange={this.handleChange} required={true} /></p>\n          <p><input className=\"button\" type=\"submit\" value=\"Login\" /></p>\n        </form>\n        <div className={styles.signUpMessage}>\n          Don't have an account? <Link to=\"../get-started\">Sign up</Link>\n        </div>\n        <div className={styles.status}>\n          {status}\n        </div>\n      </div >\n    );\n  }\n}\n\nexport default LoginForm;\n","import React from 'react';\nimport { navigate, RouteComponentProps } from '@reach/router';\nimport { v4 as uuidv4 } from 'uuid';\nimport parseISO from 'date-fns/parseISO'\n\nimport ChatApp from './ChatApp';\nimport { Conversation } from '../models/Conversation';\nimport { ConversationJson } from '../utils/json/ConversationJson';\nimport { User } from '../models/User';\nimport { UserJson } from '../utils/json/UserJson';\nimport NchatApi, { FetchError } from '../utils/NchatApi';\nimport NchatWebSocket, { WSRequest, WSSuccessResponse } from '../utils/NchatWebSocket';\n\nimport styles from \"./ChatAppLoader.module.css\";\nimport loadingIconStyles from \"../assets/LoadingIcon.module.css\";\n\ninterface GetAuthenticateResponse {\n  user: UserJson,\n}\n\ninterface GetConversationsResponse {\n  conversations: ConversationJson[];\n}\n\ninterface WSAuthRequestData {\n  authKey: string,\n}\n\ninterface WSAuthResponseData {\n}\n\ninterface ChatAppLoaderProps extends RouteComponentProps {\n  authKey: string | null,\n  user: User | null,\n  logoutHandler: () => void;\n}\n\ninterface ChatAppLoaderState {\n  user: User | null,\n  conversations: Conversation[] | null,\n  webSocket: NchatWebSocket | null,\n  errorMessage: string | null;\n}\n\nclass ChatAppLoader extends React.Component<ChatAppLoaderProps, ChatAppLoaderState> {\n  state: ChatAppLoaderState = {\n    user: this.props.user,\n    conversations: null,\n    webSocket: null,\n    errorMessage: null,\n  }\n\n  async componentDidMount() {\n    if (this.props.authKey === null) {\n      // There is an acknowledged bug where navigate does not work in componentDidMount. This\n      // hack is a workaround.\n      setTimeout(() => navigate('/accounts/get-started'), 1);\n      return;\n    }\n\n    const authKey = this.props.authKey;\n\n    try {\n      const userPromise = this.state.user === null\n        ? this.initUser(authKey)\n        : Promise.resolve(this.state.user);\n\n      const conversationsPromise = this.initConversations(authKey);\n\n      const webSocketPromise = NchatWebSocket.createWebSocket()\n        .then(webSocket => {\n          this.sendAuth(authKey, webSocket);\n          return webSocket;\n        });\n\n      const [user, conversations, webSocket] =\n        await Promise.all([userPromise, conversationsPromise, webSocketPromise]);\n\n      this.setState({\n        user: user,\n        conversations: conversations,\n        webSocket: webSocket,\n      });\n    } catch (error) {\n      if (error instanceof FetchError && error.response.status === 403) {\n        this.props.logoutHandler();\n      } else {\n        this.setState({\n          errorMessage: \"Could not load nchat. Please try again later.\",\n        });\n      }\n    }\n  }\n\n  async initUser(authKey: string): Promise<User> {\n    const response =\n      await NchatApi.get<GetAuthenticateResponse>(\"authenticate\", authKey);\n    const user: User = {\n      id: response.data.user.id,\n      name: response.data.user.name,\n      username: response.data.user.username,\n    }\n    return user;\n  }\n\n  async initConversations(authKey: string): Promise<Conversation[]> {\n    const response =\n      await NchatApi.get<GetConversationsResponse>(\"conversations\", authKey);\n\n    const conversations = response.data.conversations.map(conversation => {\n      return {\n        uuid: uuidv4(),\n        id: conversation.id,\n        conversationPartner: {\n          id: conversation.conversationPartner.id,\n          username: conversation.conversationPartner.username,\n          name: conversation.conversationPartner.name,\n        },\n        messages: conversation.messages.map(message => {\n          return {\n            uuid: uuidv4(),\n            id: message.id,\n            senderId: message.senderId,\n            body: message.body,\n            sent: parseISO(message.sent),\n          };\n        }),\n        isHistoryLoaded: false,\n        isLoading: false,\n      };\n    });\n    return conversations;\n  }\n\n  private sendAuth(authKey: string, webSocket: NchatWebSocket):\n    Promise<WSSuccessResponse<WSAuthResponseData>> {\n    const request: WSRequest<WSAuthRequestData> = {\n      type: \"request\",\n      method: \"authorize\",\n      data: {\n        authKey: authKey,\n      },\n    };\n\n    return webSocket.sendRequest(request);\n  }\n\n  componentWillUnmount() {\n  }\n\n  render() {\n    return (\n      <div className={styles.main}>\n        {\n          this.state.user && this.state.conversations && this.state.webSocket && this.props.authKey\n            ?\n            <ChatApp\n              authKey={this.props.authKey}\n              user={this.state.user}\n              webSocket={this.state.webSocket}\n              conversations={this.state.conversations}\n              logoutHandler={this.props.logoutHandler} />\n            :\n            <div className={styles.loading}>\n              {this.state.errorMessage === null\n                ? <div className={styles.loadingIcon + \" \" + loadingIconStyles.main}></div>\n                : <div className={styles.errorMessage}>{this.state.errorMessage}</div>\n              }\n            </div>\n        }\n      </div>\n    );\n  }\n}\n\nexport default ChatAppLoader","import React, { MouseEvent } from 'react';\nimport { navigate } from '@reach/router';\n\nimport NchatApi from '../utils/NchatApi';\nimport { User } from '../models/User';\nimport { UserJson } from '../utils/json/UserJson';\n\nimport styles from \"./TryNowForm.module.css\";\nimport loadingIconStyles from '../assets/LoadingIcon.module.css';\n\nenum TryNowFormStatus {\n  Empty,\n  Loading,\n  Error,\n}\n\ninterface PostDemoUsersResponse {\n  authKey: string,\n  user: UserJson,\n}\n\ninterface TryNowFormProps {\n  setAuthenticatedUser: (authKey: string, user: User) => void;\n}\n\ninterface TryNowFormState {\n  status: {\n    value: TryNowFormStatus,\n    message?: string,\n  },\n}\n\nclass TryNowForm extends React.Component<TryNowFormProps, TryNowFormState> {\n  state: TryNowFormState = {\n    status: {\n      value: TryNowFormStatus.Empty,\n    },\n  };\n\n  constructor(props: TryNowFormProps) {\n    super(props);\n\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  async handleClick(event: MouseEvent<HTMLButtonElement>) {\n    this.setState({\n      status: {\n        value: TryNowFormStatus.Loading,\n      },\n    });\n\n    try {\n      const response = await NchatApi.post<PostDemoUsersResponse>(\"demoUsers\", {});\n\n      const authKey = response.data.authKey;\n      const user: User = {\n        id: response.data.user.id,\n        username: response.data.user.username,\n        name: response.data.user.name,\n      }\n\n      this.props.setAuthenticatedUser(authKey, user);\n      navigate(\"/\")\n    } catch (error) {\n      this.setState({\n        status: {\n          value: TryNowFormStatus.Error,\n          message: \"Could not launch demo. Please try again later.\",\n        },\n      });\n    }\n  }\n\n  render() {\n    let status: JSX.Element | null;\n\n    switch (this.state.status.value) {\n      case TryNowFormStatus.Empty:\n        status = null;\n        break;\n      case TryNowFormStatus.Loading:\n        status = <div className={styles.loading + \" \" + loadingIconStyles.main}></ div>;\n        break;\n      case TryNowFormStatus.Error:\n        status =\n          <div className=\"errorMessage\">\n            {this.state.status.message}\n          </div>\n        break;\n    }\n\n    return (\n      <div className={styles.main}>\n        <h1 className={styles.header}>Try now!</h1>\n        <p>\n          Try a demo of nchat now.\n        </p>\n        <button className=\"button\" onClick={this.handleClick}>Try it now </button>\n        <div className={styles.status}>\n          <p>\n            {status}\n          </p>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default TryNowForm;","import React, { ChangeEvent, FormEvent } from 'react';\nimport { RouteComponentProps } from '@reach/router';\nimport { Link } from \"@reach/router\";\n\nimport NchatApi, { NchatApiError } from '../utils/NchatApi';\n\nimport styles from './SignUpForm.module.css';\nimport loadingIconStyles from '../assets/LoadingIcon.module.css';\n\nenum SignUpFormStatus {\n  Empty,\n  Loading,\n  Error,\n}\n\ninterface SignUpFormProps extends RouteComponentProps {\n  authenticateUser: (username: string, password: string) => Promise<void>,\n};\n\ninterface SignUpFormState {\n  name: string,\n  username: string,\n  password: string,\n  status: {\n    value: SignUpFormStatus,\n    message?: string,\n  },\n}\n\nclass SignUpForm extends React.Component<SignUpFormProps, SignUpFormState> {\n  state: SignUpFormState = {\n    \"name\": \"\",\n    \"username\": \"\",\n    \"password\": \"\",\n    status: {\n      value: SignUpFormStatus.Empty,\n    },\n  };\n\n  constructor(props: SignUpFormProps) {\n    super(props);\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleChange(event: ChangeEvent<HTMLInputElement>) {\n    switch (event.target.name) {\n      case \"username\":\n        this.setState({\n          username: event.target.value,\n        });\n        break;\n      case \"password\":\n        this.setState({\n          password: event.target.value,\n        });\n        break;\n      case \"name\":\n        this.setState({\n          name: event.target.value,\n        });\n        break;\n    }\n  }\n\n  async handleSubmit(event: FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n\n    this.setState({\n      status: {\n        value: SignUpFormStatus.Loading\n      },\n    });\n\n    const requestBody = {\n      \"name\": this.state.name,\n      \"username\": this.state.username,\n      \"password\": this.state.password,\n    }\n\n    try {\n      await NchatApi.post(\"users\", requestBody);\n    } catch (error) {\n      if (error instanceof NchatApiError && error.body.code === 6) {\n        this.setState({\n          status: {\n            value: SignUpFormStatus.Error,\n            message: \"That username is already taken. Please select another username.\",\n          },\n        });\n      } else {\n        this.setState({\n          status: {\n            value: SignUpFormStatus.Error,\n            message: \"Could not sign up. Please try again later.\",\n          },\n        });\n      }\n      return;\n    }\n\n    try {\n      await this.props.authenticateUser(this.state.username, this.state.password);\n    } catch (error) {\n      this.setState({\n        status: {\n          value: SignUpFormStatus.Error,\n          message: `Error logging in: account created but could not login.\n           Please try logging in again later.`,\n        },\n      });\n      return;\n    }\n  }\n\n  render() {\n    const autoFocus = window.matchMedia(\"(min-width: 700px)\").matches;\n\n    let status: JSX.Element | null;\n    switch (this.state.status.value) {\n      case SignUpFormStatus.Empty:\n        status = null;\n        break;\n      case SignUpFormStatus.Loading:\n        status = <div className={styles.loading + \" \" + loadingIconStyles.main}></div >;\n        break;\n      case SignUpFormStatus.Error:\n        status =\n          <div className=\"errorMessage\">\n            {this.state.status.message}\n          </div>\n        break;\n    }\n\n    return (\n      <div className={styles.main} >\n        <h1 className={styles.header}>Sign up</h1>\n        <form onSubmit={this.handleSubmit}>\n          <p><input className=\"textInput\" name=\"name\" type=\"text\" placeholder=\"Display name\"\n            value={this.state.name} onChange={this.handleChange} required={true}\n            autoFocus={autoFocus} /></p>\n          <p><input className=\"textInput\" name=\"username\" type=\"text\" placeholder=\"Username\"\n            value={this.state.username} onChange={this.handleChange} required={true} /></p>\n          <p><input className=\"textInput\" name=\"password\" type=\"password\" placeholder=\"Password\"\n            value={this.state.password} onChange={this.handleChange} required={true} /></p>\n          <p><input className=\"button\" type=\"submit\" value=\"Sign up\" /></p>\n        </form>\n        <div className={styles.loginMessage}>\n          Already have an account? <Link to=\"../login\">Login</Link>\n        </div>\n        <div className={styles.status}>\n          {status}\n        </div>\n      </div >\n    );\n  }\n}\n\nexport default SignUpForm;\n","import React from 'react';\nimport { RouteComponentProps } from '@reach/router';\nimport { Router, navigate } from \"@reach/router\";\n\nimport LoginForm from './LoginForm';\nimport NchatApi from '../utils/NchatApi';\nimport { User } from '../models/User';\nimport { UserJson } from '../utils/json/UserJson';\nimport TryNowForm from './TryNowForm';\nimport SignUpForm from './SignUpForm';\n\nimport { ReactComponent as NchatLogo } from '../assets/logo.svg';\n\nimport styles from './AccountsView.module.css'\n\ninterface PostAuthenticateResponse {\n  authKey: string,\n  user: UserJson,\n}\n\ninterface AccountsViewProps extends RouteComponentProps {\n  setAuthenticatedUser: (authKey: string, user: User) => void;\n}\n\ninterface AccountsViewState {\n}\n\nclass AccountsView extends React.Component<AccountsViewProps, AccountsViewState> {\n  constructor(props: AccountsViewProps) {\n    super(props);\n\n    this.authenticateUser = this.authenticateUser.bind(this);\n  }\n\n  async authenticateUser(username: string, password: string): Promise<void> {\n    const requestBody = {\n      \"username\": username,\n      \"password\": password,\n    }\n\n    const response = await NchatApi.post<PostAuthenticateResponse>(\"authenticate\", requestBody);\n\n    const authKey = response.data.authKey;\n    const user: User = {\n      id: response.data.user.id,\n      username: response.data.user.username,\n      name: response.data.user.name,\n    }\n    this.props.setAuthenticatedUser(authKey, user);\n    navigate(\"/\");\n  }\n\n  render() {\n    return (\n      <main className={styles.main}>\n        <div className={styles.logoContainer}>\n          <NchatLogo className={styles.logo} title=\"nchat logo\" />\n        </div>\n        <div className={styles.intro}>\n          nchat is an app for chatting with your friends.\n        </div>\n        <div className={styles.selector}>\n          <section className={styles.tryNow}>\n            <TryNowForm setAuthenticatedUser={this.props.setAuthenticatedUser} />\n          </section>\n          <div className={styles.divider}>\n            or\n            </div>\n          <section className={styles.authenticate}>\n            <Router>\n              <SignUpForm path=\"get-started\" authenticateUser={this.authenticateUser} />\n              <LoginForm path=\"login\" authenticateUser={this.authenticateUser} />\n            </Router>\n          </section>\n        </div>\n      </main>\n    );\n  }\n}\n\nexport default AccountsView;","import React from 'react';\nimport { Router } from \"@reach/router\";\nimport Cookies from 'universal-cookie';\n\nimport ChatAppLoader from './chatApp/ChatAppLoader';\nimport AccountsView from './accounts/AccountsView';\nimport { User } from './models/User'\n\ninterface AppState {\n  authKey: string | null,\n  user: User | null,\n}\n\nclass App extends React.Component<{}, AppState> {\n  state: AppState = {\n    authKey: null,\n    user: null,\n  };\n\n  constructor(props: {}) {\n    super(props);\n\n    this.setAuthenticatedUser = this.setAuthenticatedUser.bind(this);\n    this.logout = this.logout.bind(this);\n\n    const cookies = new Cookies();\n    const authKey = cookies.get(\"authKey\");\n    if (authKey) {\n      this.state.authKey = authKey;\n    }\n  }\n\n  setAuthenticatedUser(authKey: string, user: User) {\n    const cookies = new Cookies();\n    cookies.set(\"authKey\", authKey, { path: \"/\", sameSite: \"lax\", maxAge: 60 * 60 * 24 * 365 });\n\n    this.setState({\n      \"authKey\": authKey,\n      \"user\": user,\n    })\n  }\n\n  logout() {\n    const cookies = new Cookies();\n    cookies.remove(\"authKey\", { path: \"/\" });\n    this.setState({\n      authKey: null,\n      user: null,\n    });\n  }\n\n  render() {\n    return (\n      <Router className=\"Router\">\n        <ChatAppLoader path=\"/\"\n          authKey={this.state.authKey}\n          user={this.state.user}\n          key={this.state.authKey}\n          logoutHandler={this.logout} />\n        <AccountsView path=\"accounts/*\" setAuthenticatedUser={this.setAuthenticatedUser} />\n      </Router >\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\n\nimport './common.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}