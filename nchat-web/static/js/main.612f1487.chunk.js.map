{"version":3,"sources":["assets/LoadingIcon.module.css","chatApp/contentView/ConversationCreatorViewBanner.module.css","chatApp/contentView/ContentView.module.css","chatApp/sidebar/ConversationRow.module.css","accounts/AccountsView.module.css","chatApp/sidebar/Sidebar.module.css","chatApp/sidebar/SidebarBanner.module.css","chatApp/contentView/MessageView.module.css","accounts/LoginForm.module.css","accounts/SignUpForm.module.css","chatApp/contentView/ConversationViewBanner.module.css","chatApp/ChatAppLoader.module.css","accounts/TryNowForm.module.css","chatApp/contentView/MessagesView.module.css","chatApp/contentView/MessageInput.module.css","chatApp/contentView/ConversationCreatorView.module.css","chatApp/sidebar/ConversationList.module.css","chatApp/contentView/ConversationView.module.css","chatApp/ChatApp.module.css","utils/NchatApi.tsx","chatApp/ChatAppContext.tsx","chatApp/sidebar/logout.svg","chatApp/sidebar/plus.svg","chatApp/sidebar/SidebarBanner.tsx","chatApp/sidebar/ConversationRow.tsx","chatApp/sidebar/ConversationList.tsx","chatApp/sidebar/Sidebar.tsx","assets/logoCompact.svg","assets/logo.svg","chatApp/contentView/ConversationViewBanner.tsx","chatApp/contentView/MessageView.tsx","chatApp/contentView/MessagesView.tsx","chatApp/contentView/MessageInput.tsx","chatApp/contentView/ConversationView.tsx","chatApp/contentView/greenCheck.svg","chatApp/contentView/redX.svg","chatApp/contentView/ConversationCreatorViewBanner.tsx","chatApp/contentView/ConversationCreatorView.tsx","chatApp/contentView/ContentView.tsx","chatApp/ChatApp.tsx","utils/NchatWebSocket.tsx","accounts/LoginForm.tsx","chatApp/ChatAppLoader.tsx","accounts/TryNowForm.tsx","accounts/SignUpForm.tsx","accounts/AccountsView.tsx","App.tsx","index.tsx"],"names":["module","exports","NchatApi","path","authKey","init","customHeaders","headers","this","appendHeaders","fetch","apiUrl","response","responseClone","clone","json","jsonResponse","ok","status","NchatApiError","message","FetchError","body","postInit","JSON","stringify","putInit","deleteInit","additionalHeaders","headerKey","hasOwnProperty","Headers","append","Array","isArray","push","Error","captureStackTrace","ChatAppContext","React","createContext","user","id","name","username","_extends","Object","assign","target","i","arguments","length","source","key","prototype","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_ref2","createElement","stroke","strokeLinejoin","d","fill","strokeLinecap","strokeWidth","_ref","svgRef","title","props","width","height","viewBox","ref","ForwardRef","forwardRef","SidebarBanner","Consumer","context","className","styles","main","userName","button","onClick","logoutHandler","icon","handleLaunchConversationCreator","ConversationRow","messageTimeStr","lastMessage","conversation","messages","daysDifference","differenceInCalendarDays","Date","sent","formatDate","conversationPartnerName","conversationPartner","selected","main_selected","handleConversationRowClick","bubble","split","slice","map","e","charAt","toUpperCase","full","header","time","ConversationList","conversationRows","conversations","uuid","selectedConversationUuid","Sidebar","control","transform","fillRule","ConversationViewBanner","selectedConversation","logoCompact","logo","MessageView","senderId","fromUs_unsynced","fromUs_synced","fromThem","messageBody","MessagesView","SCROLL_TOLERANCE","conversationViewDiv","createRef","scrollToBottom","bind","prevProps","prevState","isScrolledToBottom","snapshot","prevMessages","node","current","scrollTop","scrollHeight","clientHeight","scrollTo","isLoading","loading","loadingIcon","loadingIconStyles","Component","contextType","MessageInput","state","handleChange","handleClickSend","handleKeyDown","event","setState","value","trim","handleSendMessage","input","type","onKeyDown","onChange","autoFocus","placeholder","autoComplete","disabled","ConversationView","window","matchMedia","matches","cx","cy","rx","ry","style","paintOrder","ConversationCreatorViewBannerStatus","r","ConversationCreatorViewBanner","Empty","to","Loading","error","Ok","success","htmlFor","label","conversationCreatorUsername","onBlur","handleBlur","ConversationCreatorView","usernameInputStatus","handleUsernameChange","handleUsernameInputBlur","getConversationPartner","get","userJson","data","spacer","ContentView","content","isConversationCreatorOpen","actionPhrase","noConversationContainer","noConversation","logoFull","hint","newChatIcon","ChatApp","handleMessageReceived","webSocket","addNotificationListener","isHistoryLoaded","conversationIndex","findIndex","c","loadingConversations","update","$set","retrievedMessages","uuidv4","parseISO","updatedConversations","notification","messageJson","conversationJson","newMessage","addMessageToConversation","newConversation","sendMessage","messageIndex","m","navigate","index","updatedConversation","$push","withRemovedConversation","$splice","request","method","sendRequest","contextValue","find","Provider","close","NchatWebSocket","isAuthMessageSent","requestId","requestPromiseCallbacks","notificationListeners","addEventListener","location","url","protocol","host","WebSocket","websocketUrl","Promise","resolve","reject","nchatWebSocket","parse","callbacks","listeners","listener","getNextId","send","registerPromise","getWebsocketUrl","LoginFormStatus","ChatAppLoader","errorMessage","setTimeout","userPromise","initUser","conversationsPromise","initConversations","webSocketPromise","createWebSocket","then","sendAuth","all","TryNowFormStatus","LoginForm","password","handleSubmit","preventDefault","authenticateUser","code","onSubmit","required","signUpMessage","SignUpFormStatus","TryNowForm","handleClick","post","setAuthenticatedUser","SignUpForm","requestBody","loginMessage","AccountsView","logoContainer","intro","selector","tryNow","divider","authenticate","App","logout","Cookies","set","sameSite","maxAge","remove","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"yGACAA,EAAOC,QAAU,CAAC,KAAO,0BAA0B,kBAAoB,yC,gBCAvED,EAAOC,QAAU,CAAC,KAAO,4CAA4C,OAAS,8CAA8C,MAAQ,6CAA6C,GAAK,0CAA0C,QAAU,+CAA+C,QAAU,+CAA+C,MAAQ,6CAA6C,MAAQ,6CAA6C,YAAc,mDAAmD,KAAO,8C,gBCApgBD,EAAOC,QAAU,CAAC,KAAO,0BAA0B,wBAA0B,6CAA6C,eAAiB,oCAAoC,KAAO,0BAA0B,SAAW,8BAA8B,KAAO,0BAA0B,YAAc,iCAAiC,YAAc,mC,gBCAvVD,EAAOC,QAAU,CAAC,KAAO,8BAA8B,cAAgB,uCAAuC,OAAS,gCAAgC,KAAO,8BAA8B,OAAS,gCAAgC,KAAO,8BAA8B,KAAO,8BAA8B,QAAU,mC,gBCAzTD,EAAOC,QAAU,CAAC,KAAO,2BAA2B,cAAgB,oCAAoC,KAAO,2BAA2B,MAAQ,4BAA4B,QAAU,8BAA8B,SAAW,+BAA+B,OAAS,6BAA6B,aAAe,qC,gBCArTD,EAAOC,QAAU,CAAC,KAAO,sBAAsB,QAAU,yBAAyB,OAAS,wBAAwB,KAAO,wB,kBCA1HD,EAAOC,QAAU,CAAC,KAAO,4BAA4B,SAAW,gCAAgC,OAAS,8BAA8B,KAAO,8B,sBCA9ID,EAAOC,QAAU,CAAC,KAAO,0BAA0B,YAAc,iCAAiC,cAAgB,mCAAmC,gBAAkB,qCAAqC,SAAW,gC,gBCAvND,EAAOC,QAAU,CAAC,cAAgB,iCAAiC,OAAS,0BAA0B,QAAU,2BAA2B,OAAS,4B,gBCApJD,EAAOC,QAAU,CAAC,aAAe,iCAAiC,OAAS,2BAA2B,QAAU,4BAA4B,OAAS,6B,mBCArJD,EAAOC,QAAU,CAAC,KAAO,qCAAqC,KAAO,qCAAqC,YAAc,4CAA4C,KAAO,uC,gBCA3KD,EAAOC,QAAU,CAAC,KAAO,4BAA4B,QAAU,+BAA+B,YAAc,mCAAmC,aAAe,sC,gBCA9JD,EAAOC,QAAU,CAAC,KAAO,yBAAyB,QAAU,4BAA4B,OAAS,6B,iBCAjGD,EAAOC,QAAU,CAAC,KAAO,2BAA2B,QAAU,8BAA8B,YAAc,oC,gBCA1GD,EAAOC,QAAU,CAAC,KAAO,2BAA2B,MAAQ,4BAA4B,OAAS,+B,kBCAjGD,EAAOC,QAAU,CAAC,KAAO,sCAAsC,OAAS,0C,oBCAxED,EAAOC,QAAU,CAAC,KAAO,iC,gBCAzBD,EAAOC,QAAU,CAAC,KAAO,iC,gBCAzBD,EAAOC,QAAU,CAAC,KAAO,wB,+RCDnBC,E,8PAGkBC,EAAcC,EAAkBC,G,oFAGhDC,EAA6C,CAC/C,OAAU,oBAERF,IACFE,EAAc,aAAeF,GAG3BC,EACEA,EAAKE,QACPC,KAAKC,cAAcJ,EAAKE,QAASD,GAEjCD,EAAKE,QAAUD,EAGjBD,EAAO,CACL,QAAWC,G,SAIQI,MAAMF,KAAKG,OAASR,EAAME,G,cAA3CO,E,OAIAC,EAAgBD,EAASE,Q,SAEJF,EAASG,O,UAA9BC,E,OAEDJ,EAASK,OAAO,WAAYD,IAAwC,YAAxBA,EAAaE,Q,sBACxD,WAAYF,MAAgB,YAAaA,G,uBACrC,IAAIG,EAAc,uBAAyBH,EAAaI,QAC5DP,EAAeG,G,cAEX,IAAIK,EAAW,sBAAuBR,G,WAI1C,WAAYG,E,uBACV,IAAIK,EAAW,4CAA6CR,G,iCAG7DG,G,gLAGWb,EAAcC,EAAkBC,G,0FAE3CG,KAAKE,MAAMP,EAAMC,EAASC,I,+KAGdF,EAAcmB,EAAWlB,EAAkBC,G,8EAExDkB,E,2BACDlB,G,IACH,OAAU,OACV,KAAQmB,KAAKC,UAAUH,K,kBAElBd,KAAKE,MAASP,EAAMC,EAASmB,I,gLAGlBpB,EAAcmB,EAAWlB,EAAkBC,G,8EAEvDqB,E,2BACDrB,G,IACH,OAAU,MACV,KAAQmB,KAAKC,UAAUH,K,kBAElBd,KAAKE,MAASP,EAAMC,EAASsB,I,mLAGfvB,EAAcC,EAAkBC,G,8EAE/CsB,E,2BACDtB,G,IACH,OAAU,W,kBAELG,KAAKE,MAASP,EAAMC,EAASuB,I,+IAIpCpB,EACAqB,GACA,IAAK,IAAMC,KAAaD,EAClBA,EAAkBE,eAAeD,KAC/BtB,aAAmBwB,QACrBxB,EAAQyB,OAAOH,EAAWD,EAAkBC,IACnCI,MAAMC,QAAQ3B,GACvBA,EAAQ4B,KAAK,CAACN,EAAWD,EAAkBC,KACf,kBAAZtB,IAChBA,EAAQsB,GAAaD,EAAkBC,S,KA7F3C3B,EACGS,OAAS,WA8GX,IAAMU,EAAb,kDAEE,WAAYD,EAAiBR,GAAqB,IAAD,8BAC/C,cAAMQ,IAFRR,cACiD,EAE3CwB,MAAMC,mBACRD,MAAMC,kBAAN,eAA8BhB,GAEhC,EAAKT,SAAWA,EAL+B,EAFnD,sBAAgCwB,QAWnBjB,EAAb,kDAGE,WAAYC,EAAiBR,EAAoBU,GAA8B,IAAD,8BAC5E,cAAMF,EAASR,IAHjBU,UAE8E,EAExEc,MAAMC,mBACRD,MAAMC,kBAAN,eAA8BlB,GAEhC,EAAKG,KAAOA,EALgE,EAHhF,UAAmCD,GAYpBnB,IC9HFoC,EAAiBC,IAAMC,cAAkC,CACpEpC,QAAS,GACTqC,KAAM,CACJC,IAAK,EACLC,KAAM,GACNC,SAAU,MCbd,SAASC,IAA2Q,OAA9PA,EAAWC,OAAOC,QAAU,SAAUC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAII,KAAOD,EAAcN,OAAOQ,UAAUxB,eAAeyB,KAAKH,EAAQC,KAAQL,EAAOK,GAAOD,EAAOC,IAAY,OAAOL,IAA2BQ,MAAMhD,KAAM0C,WAEhT,SAASO,EAAyBL,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkEC,EAAKJ,EAAnED,EAEzF,SAAuCI,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DC,EAAKJ,EAA5DD,EAAS,GAAQW,EAAab,OAAOc,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOI,EAAMM,EAAWV,GAAQS,EAASG,QAAQR,IAAQ,IAAaL,EAAOK,GAAOD,EAAOC,IAAQ,OAAOL,EAFxMc,CAA8BV,EAAQM,GAAuB,GAAIZ,OAAOiB,sBAAuB,CAAE,IAAIC,EAAmBlB,OAAOiB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOI,EAAMW,EAAiBf,GAAQS,EAASG,QAAQR,IAAQ,GAAkBP,OAAOQ,UAAUW,qBAAqBV,KAAKH,EAAQC,KAAgBL,EAAOK,GAAOD,EAAOC,IAAU,OAAOL,EAMne,IAAIkB,EAAqB,IAAMC,cAAc,IAAK,CAChDC,OAAQ,UACRC,eAAgB,SACF,IAAMF,cAAc,OAAQ,CAC1CG,EAAG,oDACHC,KAAM,OACNC,cAAe,QACfC,YAAa,SACE,IAAMN,cAAc,OAAQ,CAC3CG,EAAG,2EACHC,KAAM,UACNE,YAAa,SAGX,EAAY,SAAmBC,GACjC,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQpB,EAAyBiB,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMP,cAAc,MAAOtB,EAAS,CACtDiC,MAAO,GACPC,OAAQ,GACRC,QAAS,YACTC,IAAKN,GACJE,GAAQD,EAAqB,IAAMT,cAAc,QAAS,KAAMS,GAAS,KAAMV,IAGhFgB,EAA0B,IAAMC,YAAW,SAAUN,EAAOI,GAC9D,OAAoB,IAAMd,cAAc,EAAWtB,EAAS,CAC1D8B,OAAQM,GACPJ,OAEU,ICxCf,SAAS,IAA2Q,OAA9P,EAAW/B,OAAOC,QAAU,SAAUC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAII,KAAOD,EAAcN,OAAOQ,UAAUxB,eAAeyB,KAAKH,EAAQC,KAAQL,EAAOK,GAAOD,EAAOC,IAAY,OAAOL,IAA2BQ,MAAMhD,KAAM0C,WAEhT,SAAS,EAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkEC,EAAKJ,EAAnED,EAEzF,SAAuCI,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DC,EAAKJ,EAA5DD,EAAS,GAAQW,EAAab,OAAOc,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOI,EAAMM,EAAWV,GAAQS,EAASG,QAAQR,IAAQ,IAAaL,EAAOK,GAAOD,EAAOC,IAAQ,OAAOL,EAFxM,CAA8BI,EAAQM,GAAuB,GAAIZ,OAAOiB,sBAAuB,CAAE,IAAIC,EAAmBlB,OAAOiB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOI,EAAMW,EAAiBf,GAAQS,EAASG,QAAQR,IAAQ,GAAkBP,OAAOQ,UAAUW,qBAAqBV,KAAKH,EAAQC,KAAgBL,EAAOK,GAAOD,EAAOC,IAAU,OAAOL,EAMne,IAAI,EAAqB,IAAMmB,cAAc,OAAQ,CACnDG,EAAG,sCACHC,KAAM,OACNH,OAAQ,UACRI,cAAe,QACfC,YAAa,IAGX,EAAU,SAAiBC,GAC7B,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,EAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMP,cAAc,MAAO,EAAS,CACtDW,MAAO,GACPC,OAAQ,GACRC,QAAS,YACTC,IAAKN,GACJE,GAAQD,EAAqB,IAAMT,cAAc,QAAS,KAAMS,GAAS,KAAM,IAGhF,EAA0B,IAAMO,YAAW,SAAUN,EAAOI,GAC9D,OAAoB,IAAMd,cAAc,EAAS,EAAS,CACxDQ,OAAQM,GACPJ,O,GAEU,I,gBCOAO,MA1Bf,SAAuBP,GACrB,OACE,kBAACvC,EAAe+C,SAAhB,MAEI,SAAAC,GAAY,IAAD,EACT,OACE,4BAAQC,UAAWC,IAAOC,MACxB,yBAAKF,UAAWC,IAAOE,UAAvB,UACGJ,EAAQ7C,KAAKE,YADhB,QACwB2C,EAAQ7C,KAAKG,UAErC,4BAAQ2C,UAAWC,IAAOG,OACxBC,QAASf,EAAMgB,eACf,kBAAC,EAAD,CAAYN,UAAWC,IAAOM,KAAMlB,MAAM,YAE5C,4BAAQW,UAAWC,IAAOG,OACxBC,QAASf,EAAMkB,iCACf,kBAAC,EAAD,CAAUR,UAAWC,IAAOM,KAAMlB,MAAM,2B,iCCyBzCoB,MA1Cf,SAAyBnB,GAA8B,IAAD,EAIhDoB,EAHEC,EAAcrB,EAAMsB,aAAaC,SAASvB,EAAMsB,aAAaC,SAASjD,OAAS,GAE/EkD,EAAiBC,YAAyB,IAAIC,KAAQL,EAAYM,MAItEP,EADqB,IAAnBI,EACeI,YAAWP,EAAYM,KAAM,KAClB,IAAnBH,EACQ,YACRA,EAAiB,EACTI,YAAWP,EAAYM,KAAM,QAE7BC,YAAWP,EAAYM,KAAM,KAGhD,IAAME,EAAuB,UAAG7B,EAAMsB,aAAaQ,oBAAoBhE,YAA1C,QACxBkC,EAAMsB,aAAaQ,oBAAoB/D,SAE5C,OACE,yBACE2C,UAAWC,IAAOC,MAAQZ,EAAM+B,SAAW,IAAMpB,IAAOqB,cAAgB,IAExEjB,QAAS,kBAAMf,EAAMiC,2BAA2BjC,EAAMsB,gBACtD,yBAAKZ,UAAWC,IAAOuB,QACpBL,EAAwBM,MAAM,KAAKC,MAAM,EAAG,GAAGC,KAAI,SAAAC,GAAC,OAAIA,EAAEC,OAAO,GAAGC,kBAEvE,yBAAK9B,UAAWC,IAAO8B,MACrB,yBAAK/B,UAAWC,IAAO+B,QACrB,yBAAKhC,UAAWC,IAAO7C,MACpB+D,GAEH,yBAAKnB,UAAWC,IAAOgC,MAAOvB,IAEhC,yBAAKV,UAAWC,IAAOpE,SACpB8E,EAAY5E,S,iBClBRmG,MAjBf,SAA0B5C,GACxB,IAAM6C,EAAmB7C,EAAM8C,cAAcT,KAAI,SAAAf,GAC/C,OACE,kBAAC,EAAD,CACE9C,IAAK8C,EAAayB,KAClBhB,SAAUT,EAAayB,OAAS/C,EAAMgD,yBACtC1B,aAAcA,EACdW,2BAA4BjC,EAAMiC,gCAGxC,OACE,yBAAKvB,UAAWC,IAAOC,MACpBiC,I,iBCoBQI,OA1Bf,SAAiBjD,GACf,OACE,yBAAKU,UAAWC,IAAOC,MACrB,yBAAKF,UAAWC,IAAOuC,SACrB,4BAAQxC,UAAWC,IAAOG,OACxBC,QAASf,EAAMkB,iCACf,kBAAC,EAAD,CAAUR,UAAWC,IAAOM,KAAMlB,MAAM,uBAG5C,kBAAC,EAAD,CACEmB,gCAAiClB,EAAMkB,gCACvCF,cAAehB,EAAMgB,gBACvB,kBAAC,EAAD,CACE8B,cAAe9C,EAAM8C,cACrBE,yBAA0BhD,EAAMgD,yBAChCf,2BAA4BjC,EAAMiC,6BACpC,yBAAKvB,UAAWC,IAAOuC,SACrB,4BAAQxC,UAAWC,IAAOG,OACxBC,QAASf,EAAMgB,eACf,kBAAC,EAAD,CAAYN,UAAWC,IAAOM,KAAMlB,MAAM,eCvCpD,SAAS,KAA2Q,OAA9P,GAAW9B,OAAOC,QAAU,SAAUC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAII,KAAOD,EAAcN,OAAOQ,UAAUxB,eAAeyB,KAAKH,EAAQC,KAAQL,EAAOK,GAAOD,EAAOC,IAAY,OAAOL,IAA2BQ,MAAMhD,KAAM0C,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkEC,EAAKJ,EAAnED,EAEzF,SAAuCI,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DC,EAAKJ,EAA5DD,EAAS,GAAQW,EAAab,OAAOc,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOI,EAAMM,EAAWV,GAAQS,EAASG,QAAQR,IAAQ,IAAaL,EAAOK,GAAOD,EAAOC,IAAQ,OAAOL,EAFxM,CAA8BI,EAAQM,GAAuB,GAAIZ,OAAOiB,sBAAuB,CAAE,IAAIC,EAAmBlB,OAAOiB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOI,EAAMW,EAAiBf,GAAQS,EAASG,QAAQR,IAAQ,GAAkBP,OAAOQ,UAAUW,qBAAqBV,KAAKH,EAAQC,KAAgBL,EAAOK,GAAOD,EAAOC,IAAU,OAAOL,EAMne,IAAI,GAAqB,IAAMmB,cAAc,IAAK,CAChD6D,UAAW,iCACG,IAAM7D,cAAc,IAAK,CACvC6D,UAAW,4CACXvD,YAAa,QACC,IAAMN,cAAc,IAAK,CACvC6D,UAAW,yCACXzD,KAAM,UACN0D,SAAU,UACVxD,YAAa,QACC,IAAMN,cAAc,OAAQ,CAC1CG,EAAG,8DACY,IAAMH,cAAc,OAAQ,CAC3CG,EAAG,6CAGD,GAAiB,SAAwBI,GAC3C,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMP,cAAc,MAAO,GAAS,CACtDW,MAAO,MACPC,OAAQ,OACRC,QAAS,mBACTC,IAAKN,GACJE,GAAQD,EAAqB,IAAMT,cAAc,QAAS,KAAMS,GAAS,KAAM,KAGhF,GAA0B,IAAMO,YAAW,SAAUN,EAAOI,GAC9D,OAAoB,IAAMd,cAAc,GAAgB,GAAS,CAC/DQ,OAAQM,GACPJ,OAEU,IC1Cf,SAAS,KAA2Q,OAA9P,GAAW/B,OAAOC,QAAU,SAAUC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAII,KAAOD,EAAcN,OAAOQ,UAAUxB,eAAeyB,KAAKH,EAAQC,KAAQL,EAAOK,GAAOD,EAAOC,IAAY,OAAOL,IAA2BQ,MAAMhD,KAAM0C,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkEC,EAAKJ,EAAnED,EAEzF,SAAuCI,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DC,EAAKJ,EAA5DD,EAAS,GAAQW,EAAab,OAAOc,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOI,EAAMM,EAAWV,GAAQS,EAASG,QAAQR,IAAQ,IAAaL,EAAOK,GAAOD,EAAOC,IAAQ,OAAOL,EAFxM,CAA8BI,EAAQM,GAAuB,GAAIZ,OAAOiB,sBAAuB,CAAE,IAAIC,EAAmBlB,OAAOiB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOI,EAAMW,EAAiBf,GAAQS,EAASG,QAAQR,IAAQ,GAAkBP,OAAOQ,UAAUW,qBAAqBV,KAAKH,EAAQC,KAAgBL,EAAOK,GAAOD,EAAOC,IAAU,OAAOL,EAMne,IAAI,GAAqB,IAAMmB,cAAc,IAAK,CAChD6D,UAAW,6CACG,IAAM7D,cAAc,IAAK,CACvC6D,UAAW,yCACXzD,KAAM,UACN0D,SAAU,UACVxD,YAAa,QACC,IAAMN,cAAc,OAAQ,CAC1CG,EAAG,8DACY,IAAMH,cAAc,OAAQ,CAC3CG,EAAG,2CACa,IAAMH,cAAc,IAAK,CACzCM,YAAa,OACb,aAAc,QACA,IAAMN,cAAc,OAAQ,CAC1CG,EAAG,qtBACY,IAAMH,cAAc,OAAQ,CAC3CG,EAAG,+bACY,IAAMH,cAAc,OAAQ,CAC3CG,EAAG,kzCACY,IAAMH,cAAc,OAAQ,CAC3CG,EAAG,6UAGD,GAAU,SAAiBI,GAC7B,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMP,cAAc,MAAO,GAAS,CACtDW,MAAO,IACPC,OAAQ,OACRC,QAAS,iBACTC,IAAKN,GACJE,GAAQD,EAAqB,IAAMT,cAAc,QAAS,KAAMS,GAAS,KAAM,KAGhF,GAA0B,IAAMO,YAAW,SAAUN,EAAOI,GAC9D,OAAoB,IAAMd,cAAc,GAAS,GAAS,CACxDQ,OAAQM,GACPJ,O,IAEU,I,kBCpBAqD,OAbf,SAAgCrD,GAAqC,IAAD,EAClE,OACE,4BAAQU,UAAWC,KAAOC,MACxB,yBAAKF,UAAWC,KAAO7C,MAAvB,UACGkC,EAAMsD,qBAAqBxB,oBAAoBhE,YADlD,QAEOkC,EAAMsD,qBAAqBxB,oBAAoB/D,UAEtD,kBAAC,GAAD,CAAkB2C,UAAWC,KAAO4C,YAAaxD,MAAM,eACvD,kBAAC,GAAD,CAAWW,UAAWC,KAAO6C,KAAMzD,MAAM,iB,oBCUhC0D,OAvBf,SAAqBzD,GACnB,OACE,kBAACvC,EAAe+C,SAAhB,MACG,SAAAC,GAAO,aACN,yBACEC,UACEC,KAAOC,OACJ,UAAAH,EAAQ7C,YAAR,eAAcC,MAAOmC,EAAMzD,QAAQmH,SACZ,OAArB1D,EAAMzD,QAAQsB,GACb,IAAM8C,KAAOgD,gBACb,IAAMhD,KAAOiD,cAEf,IAAMjD,KAAOkD,WAEnB,yBAAKnD,UAAWC,KAAOmD,aACpB9D,EAAMzD,QAAQE,W,wCCLrBsH,G,kDASJ,WAAY/D,GAA2B,IAAD,8BACpC,cAAMA,IARRgE,iBAAmB,GAOmB,EALtCC,oBAAsBvG,IAAMwG,YAKU,EAFtCzD,aAEsC,EAEpC,EAAK0D,eAAiB,EAAKA,eAAeC,KAApB,gBAFc,E,gEAMpCzI,KAAKwI,mB,8CAGiBE,EAA8BC,GAEpD,MAAO,CACLC,mBAAoB5I,KAAK4I,wB,yCAK3BF,EACAC,EACAE,GACC,IAAD,IACMC,EAAeJ,EAAU9C,SACzBA,EAAW5F,KAAKqE,MAAMuB,UAGxB,UAAAkD,EAAaA,EAAanG,OAAS,UAAnC,eAAuCyE,SAAvC,UAAgDxB,EAASA,EAASjD,OAAS,UAA3E,aAAgD,EAA+ByE,QAG7EyB,EAASD,oBACRhD,EAASA,EAASjD,OAAS,GAAGoF,WAAa/H,KAAK8E,QAAQ7C,KAAKC,KAChElC,KAAKwI,mB,2CAMT,IAAMO,EAAO/I,KAAKsI,oBAAoBU,QACtC,OAAa,OAATD,GAGGA,EAAKE,WAAcF,EAAKG,aAAeH,EAAKI,aAAgBnJ,KAAKqI,mB,uCAIxE,IAAMU,EAAO/I,KAAKsI,oBAAoBU,QACzB,OAATD,GAGJA,EAAKK,SAAS,EAAGL,EAAKG,aAAeH,EAAKI,gB,+BAI1C,IAAIvD,EAA0B5F,KAAKqE,MAAMuB,SAASc,KAAI,SAAA9F,GACpD,OAAO,kBAAC,GAAD,CAAaiC,IAAKjC,EAAQwG,KAAMxG,QAASA,OAElD,OACE,yBAAKmE,UAAWC,KAAOC,KAAMR,IAAKzE,KAAKsI,qBACpCtI,KAAKqE,MAAMgF,WACV,yBAAKtE,UAAWC,KAAOsE,SACrB,yBAAKvE,UAAWC,KAAOuE,YAAc,IAAMC,KAAkBvE,QAEhEW,O,GAtEkB7D,IAAM0H,WAA3BrB,GAMGsB,YAAc5H,EAsERsG,U,oBCvBAuB,G,kDAvDb,WAAYtF,GAA2B,IAAD,8BACpC,cAAMA,IALRuF,MAA2B,CACzBzB,YAAa,IAKb,EAAK0B,aAAe,EAAKA,aAAapB,KAAlB,gBACpB,EAAKqB,gBAAkB,EAAKA,gBAAgBrB,KAArB,gBACvB,EAAKsB,cAAgB,EAAKA,cAActB,KAAnB,gBAJe,E,yDAOzBuB,GACXhK,KAAKiK,SAAS,CACZ9B,YAAa6B,EAAMxH,OAAO0H,U,qJAKU,KAAlClK,KAAK4J,MAAMzB,YAAYgC,O,iDAGXnK,KAAKqE,MAAM+F,kBAAkBpK,KAAK4J,MAAMzB,cAEtDnI,KAAKiK,SAAS,CACZ9B,YAAa,K,0IAKL6B,GACM,UAAdA,EAAMnH,KACR7C,KAAK8J,oB,+BAKP,OACE,yBAAK/E,UAAWC,KAAOC,MACrB,2BACE9C,KAAK,cACL4C,UAAWC,KAAOqF,MAClBC,KAAK,OACLJ,MAAOlK,KAAK4J,MAAMzB,YAClBoC,UAAWvK,KAAK+J,cAChBS,SAAUxK,KAAK6J,aACfY,UAAWzK,KAAKqE,MAAMoG,UACtBC,YAAY,iBACZC,aAAa,QACf,4BACE5F,UAAWC,KAAOG,OAAS,UAC3BC,QAASpF,KAAK8J,gBACdc,SAAU5K,KAAKqE,MAAMuG,UAHvB,a,GAjDmB7I,IAAM0H,W,oBCsBlBoB,OAtBf,SAA0BxG,GACxB,IAAMoG,EAAYK,OAAOC,WAAW,sBAAsBC,QAE1D,OACE,yBAAKjG,UAAWC,KAAOC,MACrB,kBAAC,GAAD,CACE0C,qBAAsBtD,EAAMsD,uBAC9B,kBAAC,GAAD,CACE0B,UAAWhF,EAAMsD,qBAAqB0B,UACtCzD,SAAUvB,EAAMsD,qBAAqB/B,WACvC,kBAAC,GAAD,CACE6E,UAAWA,EACXL,kBACE,SAACjC,GAEC,OADA9D,EAAM+F,kBAAkBjC,IACjB,OC9BnB,SAAS,KAA2Q,OAA9P,GAAW7F,OAAOC,QAAU,SAAUC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAII,KAAOD,EAAcN,OAAOQ,UAAUxB,eAAeyB,KAAKH,EAAQC,KAAQL,EAAOK,GAAOD,EAAOC,IAAY,OAAOL,IAA2BQ,MAAMhD,KAAM0C,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkEC,EAAKJ,EAAnED,EAEzF,SAAuCI,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DC,EAAKJ,EAA5DD,EAAS,GAAQW,EAAab,OAAOc,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOI,EAAMM,EAAWV,GAAQS,EAASG,QAAQR,IAAQ,IAAaL,EAAOK,GAAOD,EAAOC,IAAQ,OAAOL,EAFxM,CAA8BI,EAAQM,GAAuB,GAAIZ,OAAOiB,sBAAuB,CAAE,IAAIC,EAAmBlB,OAAOiB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOI,EAAMW,EAAiBf,GAAQS,EAASG,QAAQR,IAAQ,GAAkBP,OAAOQ,UAAUW,qBAAqBV,KAAKH,EAAQC,KAAgBL,EAAOK,GAAOD,EAAOC,IAAU,OAAOL,EAMne,IAAI,GAAqB,IAAMmB,cAAc,UAAW,CACtDsH,GAAI,GACJC,GAAI,GACJC,GAAI,GACJC,GAAI,GACJnH,YAAa,IAGX,GAAgB,SAAuBC,GACzC,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMP,cAAc,MAAO,GAAS,CACtDW,MAAO,GACPC,OAAQ,GACRC,QAAS,YACTC,IAAKN,GACJE,GAAQD,EAAqB,IAAMT,cAAc,QAAS,KAAMS,GAAS,KAAmB,IAAMT,cAAc,IAAK,CACtHI,KAAM,OACNH,OAAQ,UACRI,cAAe,QACfH,eAAgB,SACF,IAAMF,cAAc,OAAQ,CAC1CG,EAAG,2CACHG,YAAa,EACboH,MAAO,CACLC,WAAY,YAEZ,MAGF,GAA0B,IAAM3G,YAAW,SAAUN,EAAOI,GAC9D,OAAoB,IAAMd,cAAc,GAAe,GAAS,CAC9DQ,OAAQM,GACPJ,OAEU,IC7Cf,SAAS,KAA2Q,OAA9P,GAAW/B,OAAOC,QAAU,SAAUC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAII,KAAOD,EAAcN,OAAOQ,UAAUxB,eAAeyB,KAAKH,EAAQC,KAAQL,EAAOK,GAAOD,EAAOC,IAAY,OAAOL,IAA2BQ,MAAMhD,KAAM0C,WAEhT,SAAS,GAAyBE,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkEC,EAAKJ,EAAnED,EAEzF,SAAuCI,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2DC,EAAKJ,EAA5DD,EAAS,GAAQW,EAAab,OAAOc,KAAKR,GAAqB,IAAKH,EAAI,EAAGA,EAAIU,EAAWR,OAAQF,IAAOI,EAAMM,EAAWV,GAAQS,EAASG,QAAQR,IAAQ,IAAaL,EAAOK,GAAOD,EAAOC,IAAQ,OAAOL,EAFxM,CAA8BI,EAAQM,GAAuB,GAAIZ,OAAOiB,sBAAuB,CAAE,IAAIC,EAAmBlB,OAAOiB,sBAAsBX,GAAS,IAAKH,EAAI,EAAGA,EAAIe,EAAiBb,OAAQF,IAAOI,EAAMW,EAAiBf,GAAQS,EAASG,QAAQR,IAAQ,GAAkBP,OAAOQ,UAAUW,qBAAqBV,KAAKH,EAAQC,KAAgBL,EAAOK,GAAOD,EAAOC,IAAU,OAAOL,EAMne,ICGY+I,GDHR,GAAqB,IAAM5H,cAAc,IAAK,CAChDI,KAAM,QACQ,IAAMJ,cAAc,SAAU,CAC5CsH,GAAI,IACJC,GAAI,IACJM,EAAG,EACH5H,OAAQ,UACRK,YAAa,SACE,IAAMN,cAAc,IAAK,CACxCC,OAAQ,UACRI,cAAe,QACfH,eAAgB,SACF,IAAMF,cAAc,OAAQ,CAC1CG,EAAG,eACHG,YAAa,IACE,IAAMN,cAAc,OAAQ,CAC3CG,EAAG,eACHG,YAAa,IACE,IAAMN,cAAc,UAAW,CAC9CsH,GAAI,GACJC,GAAI,GACJC,GAAI,GACJC,GAAI,GACJnH,YAAa,MAGX,GAAU,SAAiBC,GAC7B,IAAIC,EAASD,EAAKC,OACdC,EAAQF,EAAKE,MACbC,EAAQ,GAAyBH,EAAM,CAAC,SAAU,UAEtD,OAAoB,IAAMP,cAAc,MAAO,GAAS,CACtDW,MAAO,GACPC,OAAQ,GACRC,QAAS,YACTC,IAAKN,GACJE,GAAQD,EAAqB,IAAMT,cAAc,QAAS,KAAMS,GAAS,KAAM,KAGhF,GAA0B,IAAMO,YAAW,SAAUN,EAAOI,GAC9D,OAAoB,IAAMd,cAAc,GAAS,GAAS,CACxDQ,OAAQM,GACPJ,O,IAEU,I,4BCzCHkH,O,iBAAAA,I,qBAAAA,I,WAAAA,I,kBAAAA,Q,SAgEGE,G,uKA5CX,IAAI/K,EACJ,OAAQV,KAAKqE,MAAM3D,QACjB,KAAK6K,GAAoCG,MACvChL,EAAS,0BAAMqE,UAAWC,KAAO2G,IAAxB,OACT,MACF,KAAKJ,GAAoCK,QACvClL,EAAS,yBAAKqE,UAAWC,KAAOsE,QAAU,IAAME,KAAkBvE,KAChEb,MAAM,yBACR,MACF,KAAKmH,GAAoC3J,MACvClB,EAAS,kBAAC,GAAD,CAAMqE,UAAWC,KAAO6G,MAC/BzH,MAAM,2BACR,MACF,KAAKmH,GAAoCO,GACvCpL,EAAS,kBAAC,GAAD,CAAYqE,UAAWC,KAAO+G,QACrC3H,MAAM,gBAGZ,OACE,4BAAQW,UAAWC,KAAOC,MACxB,yBAAKF,UAAWC,KAAOtE,QACrB,2BACEsL,QAAQ,qCACRjH,UAAWC,KAAOiH,OACjBvL,IAGL,2BACEwB,GAAG,qCACH6C,UAAWC,KAAOqF,MAClBC,KAAK,OACLJ,MAAOlK,KAAKqE,MAAM6H,4BAClBzB,WAAW,EACXD,SAAUxK,KAAKqE,MAAMwF,aACrBsC,OAAQnM,KAAKqE,MAAM+H,WACnB1B,YAAY,WACZC,aAAa,QACf,kBAAC,GAAD,CAAkB5F,UAAWC,KAAO4C,YAAaxD,MAAM,eACvD,kBAAC,GAAD,CAAWW,UAAWC,KAAO6C,KAAMzD,MAAM,oB,GAxC/CrC,IAAM0H,W,oBCHF4C,G,kDAYJ,WAAYhI,GAAsC,IAAD,8BAC/C,cAAMA,IATRS,aAQiD,IANjD8E,MAAsC,CACpCxH,SAAU,GACV+D,oBAAqB,KACrBmG,oBAAqBf,GAAoCG,OAKzD,EAAKa,qBAAuB,EAAKA,qBAAqB9D,KAA1B,gBAC5B,EAAK2B,kBAAoB,EAAKA,kBAAkB3B,KAAvB,gBACzB,EAAK+D,wBAA0B,EAAKA,wBAAwB/D,KAA7B,gBAJgB,E,iEAO5BuB,GACnB,IAAM5H,EAAW4H,EAAMxH,OAAO0H,MAC9BlK,KAAKiK,SAAS,CACZqC,oBAAqBf,GAAoCG,MACzDtJ,SAAUA,M,wCAII+F,GAChB,OAAuC,OAAnCnI,KAAK4J,MAAMzD,sBAGfnG,KAAKqE,MAAM+F,kBAAkBjC,EAAanI,KAAK4J,MAAMzD,sBAC9C,K,uFAGqB6D,G,4EAC5BhK,KAAKiK,SAAS,CACZqC,oBAAqBf,GAAoCK,UAK1C,MAFXxJ,EAAWpC,KAAK4J,MAAMxH,SAAS+H,Q,uBAGnCnK,KAAKiK,SAAS,CACZqC,oBAAqBf,GAAoCG,Q,mDAMzB1L,KAAKyM,uBAAuBrK,G,OAAxD+D,E,OACNnG,KAAKiK,SAAS,CACZ9D,oBAAqBA,EACrBmG,oBAAqBf,GAAoCO,K,kDAG3D9L,KAAKiK,SAAS,CACZ9D,oBAAqB,KACrBmG,oBAAqBf,GAAoC3J,Q,uMAKlCQ,G,yFAEnB1C,EAASgN,IAAqB,SAAWtK,EAAUpC,KAAK8E,QAAQlF,S,cADlEQ,E,OAEAuM,EAAWvM,EAASwM,KAAK3K,K,kBAExB,CACLC,GAAIyK,EAASzK,GACbE,SAAUuK,EAASvK,SACnBD,KAAMwK,EAASxK,O,sIAKjB,OACE,yBAAK4C,UAAWC,KAAOC,MACrB,kBAAC,GAAD,CACEiH,4BAA6BlM,KAAK4J,MAAMxH,SACxC1B,OAAQV,KAAK4J,MAAM0C,oBACnBzC,aAAc7J,KAAKuM,qBACnBH,WAAYpM,KAAKwM,0BACnB,yBAAKzH,UAAWC,KAAO6H,SACvB,kBAAC,GAAD,CACEpC,WAAW,EACXL,kBAAmBpK,KAAKoK,kBACxBQ,SAAU5K,KAAK4J,MAAM0C,sBAAwBf,GAAoCO,U,GAtFjF/J,IAAM0H,WADV4C,GAGG3C,YAAc5H,EA0FRuK,U,oBCjEAS,OAlCf,SAAqBzI,GACnB,IAAI0I,EACJ,GAAI1I,EAAM2I,0BACRD,EAAU,kBAAC,GAAD,CACR3C,kBAAmB/F,EAAM+F,yBACtB,GAAmC,OAA/B/F,EAAMsD,qBAA+B,CAAC,IAAD,EAC9CoF,EAAU,kBAAC,GAAD,CACRpF,qBAAsBtD,EAAMsD,qBAC5ByC,kBAAmB/F,EAAM+F,kBACzBvH,IAAG,UAAEwB,EAAMsD,4BAAR,aAAE,EAA4BP,WAC9B,CACL,IAAM6F,EAAenC,OAAOC,WAAW,kBAAkBC,QAAU,QAAU,MAC7E+B,EACE,yBAAKhI,UAAWC,KAAOkI,yBACrB,yBAAKnI,UAAWC,KAAOmI,gBACrB,kBAAC,GAAD,CAAkBpI,UAAWC,KAAO6C,KAAO,IAAM7C,KAAO4C,YAAaxD,MAAM,eAC3E,kBAAC,GAAD,CAAWW,UAAWC,KAAO6C,KAAO,IAAM7C,KAAOoI,SAAUhJ,MAAM,eACjE,yBAAKW,UAAWC,KAAOqI,MACpBJ,EADH,OAGA,kBAAC,EAAD,CAAUlI,UAAWC,KAAOsI,YAAalJ,MAAM,qBAH/C,uCAUR,OACE,0BAAMW,UAAWC,KAAOC,MACrB8H,I,oBC0SQQ,G,kDA5Rb,WAAYlJ,GAAsB,IAAD,8BAC/B,cAAMA,IAPRuF,MAAsB,CACpBzC,cAAe,EAAK9C,MAAM8C,cAC1BE,yBAA0B,KAC1B2F,2BAA2B,GAK3B,EAAKQ,sBAAwB,EAAKA,sBAAsB/E,KAA3B,gBAC7B,EAAKlD,gCAAkC,EAAKA,gCAAgCkD,KAArC,gBACvC,EAAKnC,2BAA6B,EAAKA,2BAA2BmC,KAAhC,gBAClC,EAAK2B,kBAAoB,EAAKA,kBAAkB3B,KAAvB,gBACzB,EAAKpD,cAAgB,EAAKA,cAAcoD,KAAnB,gBANU,E,gEAU/BzI,KAAKqE,MAAMoJ,UAAUC,wBAAwB,aAAc1N,KAAKwN,yB,wDAIhExN,KAAKiK,SAAS,CACZ5C,yBAA0B,KAC1B2F,2BAA2B,M,0FAIErH,G,kFAC3BA,EAAayB,OAASpH,KAAK4J,MAAMvC,yB,oDAIrCrH,KAAKiK,SAAS,CACZ+C,2BAA2B,EAC3B3F,yBAA0B1B,EAAayB,OAGpCzB,EAAagI,iBAAoBhI,EAAa0D,U,wBAC7CuE,EAAoB5N,KAAK4J,MAAMzC,cAAc0G,WAAU,SAAAC,GAAC,OAAIA,EAAE1G,OAASzB,EAAayB,QAClF2G,EAAuBC,IAAOhO,KAAK4J,MAAMzC,cAAZ,eAE9ByG,EAAoB,CACnBvE,UAAW,CACT4E,MAAM,MAMdjO,KAAKiK,SAAS,CACZ9C,cAAe4G,I,SAGMrO,EAASgN,IAC9B,iBAAmB/G,EAAazD,GAAIlC,KAAKqE,MAAMzE,S,OAD3CQ,E,OAGA8N,EAA+B9N,EAASwM,KAAKjH,aAAaC,SAASc,KAAI,SAAA9F,GAC3E,MAAO,CACLwG,KAAM+G,cACNjM,GAAItB,EAAQsB,GACZ6F,SAAUnH,EAAQmH,SAClBjH,KAAMF,EAAQE,KACdkF,KAAMoI,YAASxN,EAAQoF,UAI3B4H,EAAoB5N,KAAK4J,MAAMzC,cAAc0G,WAAU,SAAAC,GAAC,OAAIA,EAAE1G,OAASzB,EAAayB,QAC9EiH,EAAuBL,IAAOhO,KAAK4J,MAAMzC,cAAZ,eAE9ByG,EAAoB,CACnBhI,SAAU,CACRqI,KAAMC,GAER7E,UAAW,CACT4E,MAAM,GAERN,gBAAiB,CACfM,MAAM,MAMdjO,KAAKiK,SAAS,CACZ9C,cAAekH,I,oJAKCC,GACpB,IAAMC,EAAcD,EAAa1B,KAAKhM,QAChC4N,EAAmBF,EAAa1B,KAAKjH,aAErC8I,EAAsB,CAC1BrH,KAAM+G,cACNjM,GAAIqM,EAAYrM,GAChBpB,KAAMyN,EAAYzN,KAClBiH,SAAUwG,EAAYxG,SACtB/B,KAAMoI,YAASG,EAAYvI,OAGvB4H,EAAoB5N,KAAK4J,MAAMzC,cAAc0G,WAAU,SAAAC,GAAC,OAAIA,EAAE5L,KAAOsM,EAAiBtM,MAC5F,IAA2B,IAAvB0L,EAA0B,CAC5B,IAYMS,EAAoB,CAZY,CACpCjH,KAAM+G,cACNjM,GAAIsM,EAAiBtM,GACrBiE,oBAAqB,CACnBjE,GAAIsM,EAAiBrI,oBAAoBjE,GACzCE,SAAUoM,EAAiBrI,oBAAoB/D,SAC/CD,KAAMqM,EAAiBrI,oBAAoBhE,MAE7CyD,SAAU,CAAC6I,GACXd,iBAAiB,EACjBtE,WAAW,IAEa,mBAErBrJ,KAAK4J,MAAMzC,gBAEhBnH,KAAKiK,SAAS,CACZ9C,cAAekH,QAEZ,CACL,IAAMA,EACJrO,KAAK0O,yBAAyB1O,KAAK4J,MAAMzC,cAAeyG,EAAmBa,GAC7EzO,KAAKiK,SAAS,CACZ9C,cAAekH,O,iFAKGlG,EAAqBhC,G,2FACrCsI,EAAsB,CAC1BrH,KAAM+G,cACNjM,GAAI,KACJ6F,SAAU/H,KAAKqE,MAAMpC,KAAKC,GAC1BpB,KAAMqH,EACNnC,KAAM,IAAID,OAKR/F,KAAK4J,MAAMoD,4BAA6B7G,E,gBACpCwI,EAAgC,CACpCvH,KAAM+G,cACNjM,GAAI,KACJiE,oBAAqBA,EACrBwH,iBAAiB,EACjBtE,WAAW,EACXzD,SAAU,CAAC6I,IAGbzO,KAAKiK,UAAS,SAACL,EAAOvF,GAKpB,MAAO,CACL8C,cALwB,CACxBwH,GADwB,mBAErB/E,EAAMzC,gBAITE,yBAA0BsH,EAAgBvH,KAC1C4F,2BAA2B,MAI/BrF,EAAuBgH,E,0BAEqB,OAAxC3O,KAAK4J,MAAMvC,yB,iDAITuG,EAAoB5N,KAAK4J,MAAMzC,cAAc0G,WAAU,SAAAC,GAC3D,OAAOA,EAAE1G,OAAS,EAAKwC,MAAMvC,4BAEzBgH,EACJrO,KAAK0O,yBAAyB1O,KAAK4J,MAAMzC,cAAeyG,EAAmBa,GAE7EzO,KAAKiK,SAAS,CACZ9C,cAAekH,IAGjB1G,EAAuB0G,EAAqB,G,yBAGvBrO,KAAK4O,YAC1BjH,EAAqBxB,oBAAoB/D,SAAU+F,G,QAD/C/H,E,OAINJ,KAAKiK,UAAS,SAACL,EAAOvF,GACpB,IAAMuJ,EAAoBhE,EAAMzC,cAAc0G,WAAU,SAAAC,GAAM,IAAD,EAC3D,OAAOA,EAAE1G,QAAF,UAAWO,SAAX,aAAW,EAAsBP,SAEpCyH,EAAejF,EAAMzC,cAAcyG,GAAmBhI,SAASiI,WAAU,SAAAiB,GAC7E,OAAOA,EAAE1H,OAASqH,EAAWrH,QAuB/B,MAAO,CACLD,cArB0B6G,IAAOpE,EAAMzC,cAAP,eAE7ByG,EAAoB,CACnB1L,GAAI,CACF+L,KAAM7N,EAASwM,KAAKjH,aAAazD,IAEnC0D,SAAS,eACNiJ,EAAe,CACd3M,GAAI,CACF+L,KAAM7N,EAASwM,KAAKhM,QAAQsB,IAE9B8D,KAAM,CACJiI,KAAMG,YAAShO,EAASwM,KAAKhM,QAAQoF,gB,gJAenDhG,KAAKqE,MAAMgB,gBACX0J,YAAS,2B,+CAGsB5H,EAA+B6H,EAAepO,GAE7E,IAAMqO,EAAsBjB,IAAOhO,KAAK4J,MAAMzC,cAAc6H,GAC1D,CACEpJ,SAAU,CACRsJ,MAAO,CAACtO,MAIRuO,EAA0BnB,IAAO7G,EACrC,CACEiI,QAAS,CAAC,CAACJ,EAAO,MAGtB,MAAM,CACJC,GADF,mBAEKE,M,kCAIa/M,EAAkBtB,GAEpC,IAAMuO,EAA2C,CAC/C/E,KAAM,UACNgF,OAAQ,cACR1C,KAAM,CACJxK,SAAUA,EACVtB,KAAMA,IAGV,OAAOd,KAAKqE,MAAMoJ,UAAU8B,YAAYF,K,+BAGhC,IAAD,SACDG,EAAe,CACnB5P,QAASI,KAAKqE,MAAMzE,QACpBqC,KAAMjC,KAAKqE,MAAMpC,MAGb0F,EAAoB,UAAG3H,KAAK4J,MAAMzC,cACrCsI,MAAK,SAAA3B,GAAC,OAAIA,EAAE1G,OAAS,EAAKwC,MAAMvC,mCADT,QACsC,KAEhE,OACE,yBAAKtC,UAAWC,KAAOC,MACrB,kBAACnD,EAAe4N,SAAhB,CAAyBxF,MAAOsF,GAC9B,kBAAC,GAAD,CACErI,cAAenH,KAAK4J,MAAMzC,cAC1BE,yBAA0BrH,KAAK4J,MAAMvC,yBACrCf,2BAA4BtG,KAAKsG,2BACjCf,gCAAiCvF,KAAKuF,gCACtCF,cAAerF,KAAKqF,gBACtB,kBAAC,GAAD,CACE2H,0BAA2BhN,KAAK4J,MAAMoD,0BACtC5C,kBAAmBpK,KAAKoK,kBACxBzC,qBAAsBA,Q,6CAO9B3H,KAAKqE,MAAMoJ,UAAUkC,Y,GA/RH5N,IAAM0H,W,SCftBmG,G,WA6BJ,WAAYnC,GAAuB,yBA1BnCA,eA0BkC,OAzBlCoC,mBAAoB,EAyBc,KAxBlCC,UAAY,EAwBsB,KAvBlCC,wBAA8C,GAuBZ,KAtBlCC,sBAA+C,GAuB7ChQ,KAAKwN,sBAAwBxN,KAAKwN,sBAAsB/E,KAAKzI,MAC7DA,KAAKyN,UAAYA,EACjBzN,KAAKyN,UAAUwC,iBAAiB,UAAWjQ,KAAKwN,uB,mEAtBhD,IAAI0C,EAAWpF,OAAOoF,SAClBC,EAA6B,WAAtBD,EAASE,SAAwB,OAAS,MAErD,OADAD,GAAO,KAAOD,EAASG,KAAO,iB,wCAK9B,IAAM5C,EAAY,IAAI6C,UAAUtQ,KAAKuQ,aAAc,SACnD,OAAO,IAAIC,SAAQ,SAACC,EAASC,GAC3BjD,EAAUwC,iBAAiB,QAAQ,SAACjG,GAClC,IAAM2G,EAAiB,IAAIf,EAAenC,GAC1CgD,EAAQE,MAEVlD,EAAUwC,iBAAiB,SAAS,SAACjG,GACnC0G,EAAO1G,a,2DAWSA,GACpB,IAAM4C,EACJ5L,KAAK4P,MAAM5G,EAAM4C,MACnB,GAAkB,aAAdA,EAAKtC,KAAqB,CAC5B,IAAMuG,EAAY7Q,KAAK+P,wBAAwBnD,EAAK1K,IACpD,GAAyB,qBAAd2O,EACT,OAGkB,YAAhBjE,EAAKlM,OACPmQ,EAAUJ,QAAQ7D,GAElBiE,EAAUH,OAAO9D,QAEd,GAAkB,iBAAdA,EAAKtC,KAAyB,CACvC,IAAMwG,EAAY9Q,KAAKgQ,sBAAsBpD,EAAK0C,QAClD,GAAyB,qBAAdwB,EACT,OAHqC,qBAMhBA,GANgB,IAMvC,2BAAkC,EAChCC,EADgC,SACvBnE,IAP4B,kC,8CAYnB0C,EAAgByB,GACkB,IAAD,EAAnD/Q,KAAKgQ,sBAAsB1O,eAAegO,GAC5C,UAAAtP,KAAKgQ,sBAAsBV,UAA3B,SAAoC3N,KAAKoP,GAEzC/Q,KAAKgQ,sBAAsBV,GAAU,CAACyB,K,kCAIxB1B,GACe,IAAD,OACxBnN,EAAKlC,KAAKgR,YAKhB,OAJA3B,EAAQnN,GAAKA,EAEblC,KAAKyN,UAAUwD,KAAKjQ,KAAKC,UAAUoO,IAE5B,IAAImB,SAAQ,SAACC,EAASC,GAC3B,EAAKQ,gBAAgBhP,EAAIuO,EAASC,Q,8BAKpC1Q,KAAKyN,UAAUkC,U,sCAGOzN,EAAYuO,EAA6BC,GAC/D1Q,KAAK+P,wBAAwB7N,GAAM,CACjCuO,QAASA,EACTC,OAAQA,K,kCAKV,OAAO1Q,KAAK8P,gB,KA7FVF,GACGW,aAAeX,GAAeuB,kBAgGxBvB,IClIVwB,GDkIUxB,M,oBEqCAyB,G,4MAlIbzH,MAA4B,CAC1B3H,KAAM,EAAKoC,MAAMpC,KACjBkF,cAAe,KACfsG,UAAW,KACX6D,aAAc,M,4MAIa,OAAvBtR,KAAKqE,MAAMzE,Q,uBAGb2R,YAAW,kBAAMxC,YAAS,2BAA0B,G,iCAIhDnP,EAAUI,KAAKqE,MAAMzE,Q,SAGnB4R,EAAkC,OAApBxR,KAAK4J,MAAM3H,KAC3BjC,KAAKyR,SAAS7R,GACd4Q,QAAQC,QAAQzQ,KAAK4J,MAAM3H,MAEzByP,EAAuB1R,KAAK2R,kBAAkB/R,GAE9CgS,EAAmBhC,GAAeiC,kBACrCC,MAAK,SAAArE,GAEJ,OADA,EAAKsE,SAASnS,EAAS6N,GAChBA,K,UAIH+C,QAAQwB,IAAI,CAACR,EAAaE,EAAsBE,I,oCADjD3P,E,KAAMkF,E,KAAesG,E,KAG5BzN,KAAKiK,SAAS,CACZhI,KAAMA,EACNkF,cAAeA,EACfsG,UAAWA,I,kDAGT,gBAAiB5M,GAAwC,MAA1B,KAAMT,SAASM,OAChDV,KAAKqE,MAAMgB,gBAEXrF,KAAKiK,SAAS,CACZqH,aAAc,kD,wLAMP1R,G,yFAELF,EAASgN,IAA6B,eAAgB9M,G,cADxDQ,E,OAEA6B,EAAa,CACjBC,GAAI9B,EAASwM,KAAK3K,KAAKC,GACvBC,KAAM/B,EAASwM,KAAK3K,KAAKE,KACzBC,SAAUhC,EAASwM,KAAK3K,KAAKG,U,kBAExBH,G,mLAGerC,G,yFAEdF,EAASgN,IAA8B,gBAAiB9M,G,cAD1DQ,E,OAGA+G,EAAgB/G,EAASwM,KAAKzF,cAAcT,KAAI,SAAAf,GACpD,MAAO,CACLyB,KAAM+G,cACNjM,GAAIyD,EAAazD,GACjBiE,oBAAqB,CACnBjE,GAAIyD,EAAaQ,oBAAoBjE,GACrCE,SAAUuD,EAAaQ,oBAAoB/D,SAC3CD,KAAMwD,EAAaQ,oBAAoBhE,MAEzCyD,SAAUD,EAAaC,SAASc,KAAI,SAAA9F,GAClC,MAAO,CACLwG,KAAM+G,cACNjM,GAAItB,EAAQsB,GACZ6F,SAAUnH,EAAQmH,SAClBjH,KAAMF,EAAQE,KACdkF,KAAMoI,YAASxN,EAAQoF,UAG3B2H,iBAAiB,EACjBtE,WAAW,M,kBAGRlC,G,iIAGQvH,EAAiB6N,GAEhC,IAAM4B,EAAwC,CAC5C/E,KAAM,UACNgF,OAAQ,YACR1C,KAAM,CACJhN,QAASA,IAIb,OAAO6N,EAAU8B,YAAYF,K,+EAO7B,OACE,yBAAKtK,UAAWC,KAAOC,MAEnBjF,KAAK4J,MAAM3H,MAAQjC,KAAK4J,MAAMzC,eAAiBnH,KAAK4J,MAAM6D,WAAazN,KAAKqE,MAAMzE,QAEhF,kBAAC,GAAD,CACEA,QAASI,KAAKqE,MAAMzE,QACpBqC,KAAMjC,KAAK4J,MAAM3H,KACjBwL,UAAWzN,KAAK4J,MAAM6D,UACtBtG,cAAenH,KAAK4J,MAAMzC,cAC1B9B,cAAerF,KAAKqE,MAAMgB,gBAE5B,yBAAKN,UAAWC,KAAOsE,SACQ,OAA5BtJ,KAAK4J,MAAM0H,aACR,yBAAKvM,UAAWC,KAAOuE,YAAc,IAAMC,KAAkBvE,OAC7D,yBAAKF,UAAWC,KAAOsM,cAAetR,KAAK4J,MAAM0H,oB,GA1HvCvP,IAAM0H,W,8BDpC7B2H,O,iBAAAA,I,qBAAAA,I,kBAAAA,Q,SEEAa,GFuHUC,G,kDA7Fb,WAAY7N,GAAwB,IAAD,8BACjC,cAAMA,IATRuF,MAAwB,CACtBxH,SAAU,GACV+P,SAAU,GACVzR,OAAQ,CACNwJ,MAAOkH,GAAgB1F,QAOzB,EAAK7B,aAAe,EAAKA,aAAapB,KAAlB,gBACpB,EAAK2J,aAAe,EAAKA,aAAa3J,KAAlB,gBAJa,E,yDAOtBuB,GACX,OAAQA,EAAMxH,OAAOL,MACnB,IAAK,WACHnC,KAAKiK,SAAS,CACZ7H,SAAU4H,EAAMxH,OAAO0H,QAEzB,MACF,IAAK,WACHlK,KAAKiK,SAAS,CACZkI,SAAUnI,EAAMxH,OAAO0H,W,4EAMZF,G,wEACjBA,EAAMqI,iBAENrS,KAAKiK,SAAS,CACZvJ,OAAQ,CACNwJ,MAAOkH,GAAgBxF,W,kBAKnB5L,KAAKqE,MAAMiO,iBAAiBtS,KAAK4J,MAAMxH,SAAUpC,KAAK4J,MAAMuI,U,uDAE9D,gBAAiBxR,GAAqC,IAApB,KAAMG,KAAKyR,KAC/CvS,KAAKiK,SAAS,CACZvJ,OAAQ,CACNwJ,MAAOkH,GAAgBxP,MACvBhB,QAAS,uFAIbZ,KAAKiK,SAAS,CACZvJ,OAAQ,CACNwJ,MAAOkH,GAAgBxP,MACvBhB,QAAS,8C,+IAQjB,IAEIF,EAFE+J,EAAYK,OAAOC,WAAW,sBAAsBC,QAG1D,OAAQhL,KAAK4J,MAAMlJ,OAAOwJ,OACxB,KAAKkH,GAAgB1F,MACnBhL,EAAS,KACT,MACF,KAAK0Q,GAAgBxF,QACnBlL,EAAS,yBAAKqE,UAAWC,KAAOsE,QAAU,IAAME,KAAkBvE,OAClE,MACF,KAAKmM,GAAgBxP,MACnBlB,EACE,yBAAKqE,UAAU,gBACZ/E,KAAK4J,MAAMlJ,OAAOE,SAK3B,OACE,yBAAKmE,UAAWC,KAAOC,MACrB,wBAAIF,UAAWC,KAAO+B,QAAtB,SACA,0BAAMyL,SAAUxS,KAAKoS,cACnB,2BAAG,2BAAOrN,UAAU,YAAY5C,KAAK,WAAWmI,KAAK,OAAOI,YAAY,WACtER,MAAOlK,KAAK4J,MAAMxH,SAAUoI,SAAUxK,KAAK6J,aAAc4I,UAAU,EACnEhI,UAAWA,KACb,2BAAG,2BAAO1F,UAAU,YAAY5C,KAAK,WAAWmI,KAAK,WAAWI,YAAY,WAC1ER,MAAOlK,KAAK4J,MAAMuI,SAAU3H,SAAUxK,KAAK6J,aAAc4I,UAAU,KACrE,2BAAG,2BAAO1N,UAAU,SAASuF,KAAK,SAASJ,MAAM,YAEnD,yBAAKnF,UAAWC,KAAO0N,eAAvB,0BACyB,kBAAC,IAAD,CAAM/G,GAAG,kBAAT,YAEzB,yBAAK5G,UAAWC,KAAOtE,QACpBA,Q,GA/FaqB,IAAM0H,W,8BEjBzBwI,O,iBAAAA,I,qBAAAA,I,kBAAAA,Q,SCDAU,GDoGUC,G,kDAtEb,WAAYvO,GAAyB,IAAD,8BAClC,cAAMA,IAPRuF,MAAyB,CACvBlJ,OAAQ,CACNwJ,MAAO+H,GAAiBvG,QAO1B,EAAKmH,YAAc,EAAKA,YAAYpK,KAAjB,gBAHe,E,iGAMlBuB,G,kFAChBhK,KAAKiK,SAAS,CACZvJ,OAAQ,CACNwJ,MAAO+H,GAAiBrG,W,kBAKHlM,EAASoT,KAA4B,YAAa,I,OAAnE1S,E,OAEAR,EAAUQ,EAASwM,KAAKhN,QACxBqC,EAAa,CACjBC,GAAI9B,EAASwM,KAAK3K,KAAKC,GACvBE,SAAUhC,EAASwM,KAAK3K,KAAKG,SAC7BD,KAAM/B,EAASwM,KAAK3K,KAAKE,MAG3BnC,KAAKqE,MAAM0O,qBAAqBnT,EAASqC,GACzC8M,YAAS,K,kDAET/O,KAAKiK,SAAS,CACZvJ,OAAQ,CACNwJ,MAAO+H,GAAiBrQ,MACxBhB,QAAS,oD,gJAOf,IAAIF,EAEJ,OAAQV,KAAK4J,MAAMlJ,OAAOwJ,OACxB,KAAK+H,GAAiBvG,MACpBhL,EAAS,KACT,MACF,KAAKuR,GAAiBrG,QACpBlL,EAAS,yBAAKqE,UAAWC,KAAOsE,QAAU,IAAME,KAAkBvE,OAClE,MACF,KAAKgN,GAAiBrQ,MACpBlB,EACE,yBAAKqE,UAAU,gBACZ/E,KAAK4J,MAAMlJ,OAAOE,SAK3B,OACE,yBAAKmE,UAAWC,KAAOC,MACrB,wBAAIF,UAAWC,KAAO+B,QAAtB,YACA,uDAGA,4BAAQhC,UAAU,SAASK,QAASpF,KAAK6S,aAAzC,qBACA,yBAAK9N,UAAWC,KAAOtE,QACrB,2BACGA,S,GArEYqB,IAAM0H,W,8BCvB1BkJ,O,iBAAAA,I,qBAAAA,I,kBAAAA,Q,SAsJUK,G,kDAxHb,WAAY3O,GAAyB,IAAD,8BAClC,cAAMA,IAVRuF,MAAyB,CACvB,KAAQ,GACR,SAAY,GACZ,SAAY,GACZlJ,OAAQ,CACNwJ,MAAOyI,GAAiBjH,QAO1B,EAAK7B,aAAe,EAAKA,aAAapB,KAAlB,gBACpB,EAAK2J,aAAe,EAAKA,aAAa3J,KAAlB,gBAJc,E,yDAOvBuB,GACX,OAAQA,EAAMxH,OAAOL,MACnB,IAAK,WACHnC,KAAKiK,SAAS,CACZ7H,SAAU4H,EAAMxH,OAAO0H,QAEzB,MACF,IAAK,WACHlK,KAAKiK,SAAS,CACZkI,SAAUnI,EAAMxH,OAAO0H,QAEzB,MACF,IAAK,OACHlK,KAAKiK,SAAS,CACZ9H,KAAM6H,EAAMxH,OAAO0H,W,4EAMRF,G,8EACjBA,EAAMqI,iBAENrS,KAAKiK,SAAS,CACZvJ,OAAQ,CACNwJ,MAAOyI,GAAiB/G,WAItBqH,EAAc,CAClB,KAAQjT,KAAK4J,MAAMzH,KACnB,SAAYnC,KAAK4J,MAAMxH,SACvB,SAAYpC,KAAK4J,MAAMuI,U,kBAIjBzS,EAASoT,KAAK,QAASG,G,8DAEzB,gBAAiBtS,GAAqC,IAApB,KAAMG,KAAKyR,KAC/CvS,KAAKiK,SAAS,CACZvJ,OAAQ,CACNwJ,MAAOyI,GAAiB/Q,MACxBhB,QAAS,qEAIbZ,KAAKiK,SAAS,CACZvJ,OAAQ,CACNwJ,MAAOyI,GAAiB/Q,MACxBhB,QAAS,gD,sDAQTZ,KAAKqE,MAAMiO,iBAAiBtS,KAAK4J,MAAMxH,SAAUpC,KAAK4J,MAAMuI,U,kEAElEnS,KAAKiK,SAAS,CACZvJ,OAAQ,CACNwJ,MAAOyI,GAAiB/Q,MACxBhB,QAAQ,2G,0KASd,IAEIF,EAFE+J,EAAYK,OAAOC,WAAW,sBAAsBC,QAG1D,OAAQhL,KAAK4J,MAAMlJ,OAAOwJ,OACxB,KAAKyI,GAAiBjH,MACpBhL,EAAS,KACT,MACF,KAAKiS,GAAiB/G,QACpBlL,EAAS,yBAAKqE,UAAWC,KAAOsE,QAAU,IAAME,KAAkBvE,OAClE,MACF,KAAK0N,GAAiB/Q,MACpBlB,EACE,yBAAKqE,UAAU,gBACZ/E,KAAK4J,MAAMlJ,OAAOE,SAK3B,OACE,yBAAKmE,UAAWC,KAAOC,MACrB,wBAAIF,UAAWC,KAAO+B,QAAtB,WACA,0BAAMyL,SAAUxS,KAAKoS,cACnB,2BAAG,2BAAOrN,UAAU,YAAY5C,KAAK,OAAOmI,KAAK,OAAOI,YAAY,eAClER,MAAOlK,KAAK4J,MAAMzH,KAAMqI,SAAUxK,KAAK6J,aAAc4I,UAAU,EAC/DhI,UAAWA,KACb,2BAAG,2BAAO1F,UAAU,YAAY5C,KAAK,WAAWmI,KAAK,OAAOI,YAAY,WACtER,MAAOlK,KAAK4J,MAAMxH,SAAUoI,SAAUxK,KAAK6J,aAAc4I,UAAU,KACrE,2BAAG,2BAAO1N,UAAU,YAAY5C,KAAK,WAAWmI,KAAK,WAAWI,YAAY,WAC1ER,MAAOlK,KAAK4J,MAAMuI,SAAU3H,SAAUxK,KAAK6J,aAAc4I,UAAU,KACrE,2BAAG,2BAAO1N,UAAU,SAASuF,KAAK,SAASJ,MAAM,cAEnD,yBAAKnF,UAAWC,KAAOkO,cAAvB,4BAC2B,kBAAC,IAAD,CAAMvH,GAAG,YAAT,UAE3B,yBAAK5G,UAAWC,KAAOtE,QACpBA,Q,GA3HcqB,IAAM0H,W,oBCmDhB0J,G,kDApDb,WAAY9O,GAA2B,IAAD,8BACpC,cAAMA,IAEDiO,iBAAmB,EAAKA,iBAAiB7J,KAAtB,gBAHY,E,sGAMfrG,EAAkB+P,G,oFACjCc,EAAc,CAClB,SAAY7Q,EACZ,SAAY+P,G,SAGSzS,EAASoT,KAA+B,eAAgBG,G,OAAzE7S,E,OAEAR,EAAUQ,EAASwM,KAAKhN,QACxBqC,EAAa,CACjBC,GAAI9B,EAASwM,KAAK3K,KAAKC,GACvBE,SAAUhC,EAASwM,KAAK3K,KAAKG,SAC7BD,KAAM/B,EAASwM,KAAK3K,KAAKE,MAE3BnC,KAAKqE,MAAM0O,qBAAqBnT,EAASqC,GACzC8M,YAAS,K,wIAIT,OACE,0BAAMhK,UAAWC,KAAOC,MACtB,yBAAKF,UAAWC,KAAOoO,eACrB,kBAAC,GAAD,CAAWrO,UAAWC,KAAO6C,KAAMzD,MAAM,gBAE3C,yBAAKW,UAAWC,KAAOqO,OAAvB,mDAGA,yBAAKtO,UAAWC,KAAOsO,UACrB,6BAASvO,UAAWC,KAAOuO,QACzB,kBAAC,GAAD,CAAYR,qBAAsB/S,KAAKqE,MAAM0O,wBAE/C,yBAAKhO,UAAWC,KAAOwO,SAAvB,MAGA,6BAASzO,UAAWC,KAAOyO,cACzB,kBAAC,IAAD,KACE,kBAAC,GAAD,CAAY9T,KAAK,cAAc2S,iBAAkBtS,KAAKsS,mBACtD,kBAAC,GAAD,CAAW3S,KAAK,QAAQ2S,iBAAkBtS,KAAKsS,2B,GA5ClCvQ,IAAM0H,WCsClBiK,G,kDA9Cb,WAAYrP,GAAY,IAAD,uBACrB,cAAMA,IANRuF,MAAkB,CAChBhK,QAAS,KACTqC,KAAM,MAMN,EAAK8Q,qBAAuB,EAAKA,qBAAqBtK,KAA1B,gBAC5B,EAAKkL,OAAS,EAAKA,OAAOlL,KAAZ,gBAEd,IACM7I,GADU,IAAIgU,KACIlH,IAAI,WAPP,OAQjB9M,IACF,EAAKgK,MAAMhK,QAAUA,GATF,E,iEAaFA,EAAiBqC,IACpB,IAAI2R,KACZC,IAAI,UAAWjU,EAAS,CAAED,KAAM,IAAKmU,SAAU,MAAOC,OAAQ,UAEtE/T,KAAKiK,SAAS,CACZ,QAAWrK,EACX,KAAQqC,M,gCAKM,IAAI2R,KACZI,OAAO,UAAW,CAAErU,KAAM,MAClCK,KAAKiK,SAAS,CACZrK,QAAS,KACTqC,KAAM,S,+BAKR,OACE,kBAAC,IAAD,CAAQ8C,UAAU,UAChB,kBAAC,GAAD,CAAepF,KAAK,IAClBC,QAASI,KAAK4J,MAAMhK,QACpBqC,KAAMjC,KAAK4J,MAAM3H,KACjBY,IAAK7C,KAAK4J,MAAMhK,QAChByF,cAAerF,KAAK2T,SACtB,kBAAC,GAAD,CAAchU,KAAK,aAAaoT,qBAAsB/S,KAAK+S,4B,GA9CjDhR,IAAM0H,W,MCLxBwK,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,GAAD,OAEFC,SAASC,eAAe,W","file":"static/js/main.612f1487.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"LoadingIcon_main__34XFe\",\"rotateLoadingIcon\":\"LoadingIcon_rotateLoadingIcon__7vz7G\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationCreatorViewBanner_main__2RuqB\",\"status\":\"ConversationCreatorViewBanner_status__33eIj\",\"label\":\"ConversationCreatorViewBanner_label__1GUTo\",\"to\":\"ConversationCreatorViewBanner_to__2CFmT\",\"loading\":\"ConversationCreatorViewBanner_loading__1Bazp\",\"success\":\"ConversationCreatorViewBanner_success__4uYs9\",\"error\":\"ConversationCreatorViewBanner_error__3xyF-\",\"input\":\"ConversationCreatorViewBanner_input__1n_BT\",\"logoCompact\":\"ConversationCreatorViewBanner_logoCompact__xXF5g\",\"logo\":\"ConversationCreatorViewBanner_logo__3JRhd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ContentView_main__1wKd8\",\"noConversationContainer\":\"ContentView_noConversationContainer__cNJRp\",\"noConversation\":\"ContentView_noConversation__2Aa6q\",\"logo\":\"ContentView_logo__145Qh\",\"logoFull\":\"ContentView_logoFull__1bV84\",\"hint\":\"ContentView_hint__2LgK_\",\"newChatIcon\":\"ContentView_newChatIcon__3nwJn\",\"logoCompact\":\"ContentView_logoCompact__2wA-P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationRow_main__15UeD\",\"main_selected\":\"ConversationRow_main_selected__1NOlm\",\"bubble\":\"ConversationRow_bubble__3Ao4F\",\"full\":\"ConversationRow_full__Jdv7t\",\"header\":\"ConversationRow_header__1ZnpL\",\"name\":\"ConversationRow_name__23KPO\",\"time\":\"ConversationRow_time__OgSgH\",\"message\":\"ConversationRow_message__foiam\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"AccountsView_main__3bB6D\",\"logoContainer\":\"AccountsView_logoContainer__WpB20\",\"logo\":\"AccountsView_logo__3C1wl\",\"intro\":\"AccountsView_intro__TLRBm\",\"divider\":\"AccountsView_divider__OB39W\",\"selector\":\"AccountsView_selector__2zNAb\",\"tryNow\":\"AccountsView_tryNow__2DSPt\",\"authenticate\":\"AccountsView_authenticate__3Ry6X\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"Sidebar_main__4NAoH\",\"control\":\"Sidebar_control__zeglL\",\"button\":\"Sidebar_button___Uwje\",\"icon\":\"Sidebar_icon__2be8Y\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"SidebarBanner_main__aKmsQ\",\"userName\":\"SidebarBanner_userName__2-u0O\",\"button\":\"SidebarBanner_button__2yvjF\",\"icon\":\"SidebarBanner_icon__3ED6o\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"MessageView_main__iUNFr\",\"messageBody\":\"MessageView_messageBody__2HVi_\",\"fromUs_synced\":\"MessageView_fromUs_synced__xva42\",\"fromUs_unsynced\":\"MessageView_fromUs_unsynced__3hq1Q\",\"fromThem\":\"MessageView_fromThem__2rvmg\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"signUpMessage\":\"LoginForm_signUpMessage__1r2se\",\"status\":\"LoginForm_status__19Y73\",\"loading\":\"LoginForm_loading__25Wew\",\"header\":\"LoginForm_header__2JLXQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"loginMessage\":\"SignUpForm_loginMessage__37JjP\",\"status\":\"SignUpForm_status__1IEWG\",\"loading\":\"SignUpForm_loading__1JIgt\",\"header\":\"SignUpForm_header__21dfs\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationViewBanner_main__1QcAL\",\"name\":\"ConversationViewBanner_name__6kOJg\",\"logoCompact\":\"ConversationViewBanner_logoCompact__1ZKm8\",\"logo\":\"ConversationViewBanner_logo__-7pzv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ChatAppLoader_main__3MLko\",\"loading\":\"ChatAppLoader_loading__10PNe\",\"loadingIcon\":\"ChatAppLoader_loadingIcon__1FXvN\",\"errorMessage\":\"ChatAppLoader_errorMessage__3ZIkB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"TryNowForm_main__3uKR4\",\"loading\":\"TryNowForm_loading__2llzz\",\"header\":\"TryNowForm_header__zTYsS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"MessagesView_main__42rqi\",\"loading\":\"MessagesView_loading__1CrH0\",\"loadingIcon\":\"MessagesView_loadingIcon__6ERDa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"MessageInput_main__2csiL\",\"input\":\"MessageInput_input__2yt7Q\",\"button\":\"MessageInput_button__1IFqk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationCreatorView_main__2pC5Z\",\"spacer\":\"ConversationCreatorView_spacer__3HChQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationList_main__6a_YG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ConversationView_main__N3c4M\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"main\":\"ChatApp_main__1mAeE\"};","class NchatApi {\n  static apiUrl = \"/api/v1/\";\n\n  static async fetch<T>(path: string, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n\n    let customHeaders: { [index: string]: string } = {\n      \"Accept\": \"application/json\",\n    }\n    if (authKey) {\n      customHeaders[\"X-API-KEY\"] = authKey;\n    }\n\n    if (init) {\n      if (init.headers) {\n        this.appendHeaders(init.headers, customHeaders);\n      } else {\n        init.headers = customHeaders;\n      }\n    } else {\n      init = {\n        \"headers\": customHeaders,\n      }\n    }\n\n    const response = await fetch(this.apiUrl + path, init)\n\n    // If we want to pass the response in an error later, we must clone it, because\n    // response.body can only be consumed once.\n    const responseClone = response.clone();\n\n    const jsonResponse = await response.json();\n\n    if (!response.ok || (\"status\" in jsonResponse && jsonResponse.status !== \"success\")) {\n      if (\"status\" in jsonResponse && \"message\" in jsonResponse) {\n        throw new NchatApiError(\"Nchat server error: \" + jsonResponse.message,\n          responseClone, jsonResponse);\n      } else {\n        throw new FetchError(\"Nchat server error.\", responseClone);\n      }\n    }\n\n    if (!(\"status\" in jsonResponse)) {\n      throw new FetchError(\"Missing 'status' field in nchat response.\", responseClone);\n    }\n\n    return jsonResponse as NchatApiSuccessResponse<T>;\n  }\n\n  static async get<T>(path: string, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n    return this.fetch(path, authKey, init);\n  }\n\n  static async post<T>(path: string, body: any, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n    const postInit = {\n      ...init,\n      \"method\": \"POST\",\n      \"body\": JSON.stringify(body),\n    };\n    return this.fetch<T>(path, authKey, postInit);\n  }\n\n  static async put<T>(path: string, body: any, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n    const putInit = {\n      ...init,\n      \"method\": \"PUT\",\n      \"body\": JSON.stringify(body),\n    };\n    return this.fetch<T>(path, authKey, putInit);\n  }\n\n  static async delete<T>(path: string, authKey?: string, init?: RequestInit):\n    Promise<NchatApiSuccessResponse<T>> {\n    const deleteInit = {\n      ...init,\n      \"method\": \"DELETE\",\n    };\n    return this.fetch<T>(path, authKey, deleteInit);\n  }\n\n  private static appendHeaders(\n    headers: HeadersInit,\n    additionalHeaders: { [index: string]: string }) {\n    for (const headerKey in additionalHeaders) {\n      if (additionalHeaders.hasOwnProperty(headerKey)) {\n        if (headers instanceof Headers) {\n          headers.append(headerKey, additionalHeaders[headerKey]);\n        } else if (Array.isArray(headers)) {\n          headers.push([headerKey, additionalHeaders[headerKey]]);\n        } else if (typeof headers === 'object') {\n          headers[headerKey] = additionalHeaders[headerKey];\n        }\n      }\n    }\n  }\n}\n\nexport interface NchatApiSuccessResponse<T> {\n  status: string,\n  data: T,\n}\n\nexport interface NchatApiErrorResponse {\n  status: string,\n  message: string,\n  code: number,\n}\n\nexport class FetchError extends Error {\n  response: Response;\n  constructor(message: string, response: Response) {\n    super(message);\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, FetchError)\n    }\n    this.response = response;\n  }\n}\n\nexport class NchatApiError extends FetchError {\n  body: NchatApiErrorResponse;\n\n  constructor(message: string, response: Response, body: NchatApiErrorResponse) {\n    super(message, response);\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, NchatApiError)\n    }\n    this.body = body;\n  }\n}\n\nexport default NchatApi;\n","import React from \"react\";\nimport { User } from \"../models/User\";\n\ninterface ChatAppContextType {\n  authKey: string,\n  user: User,\n}\n\nexport const ChatAppContext = React.createContext<ChatAppContextType>({\n  authKey: \"\",\n  user: {\n    id: -1,\n    name: \"\",\n    username: \"\"\n  },\n});\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"g\", {\n  stroke: \"#bababa\",\n  strokeLinejoin: \"round\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m23.66 10.666v-5.6004h-19.33v29.869h19.33v-5.6004\",\n  fill: \"none\",\n  strokeLinecap: \"round\",\n  strokeWidth: 5.9988\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m16.192 17.434h13.998v-5.1316l8.932 7.6974-8.932 7.6974v-5.1316h-13.998z\",\n  fill: \"#bababa\",\n  strokeWidth: 0.9998\n}));\n\nvar SvgLogout = function SvgLogout(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 40,\n    height: 40,\n    viewBox: \"0 0 40 40\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgLogout, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/logout.e43442ba.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m3 19.737h34m-17-16.737-0.012014 34\",\n  fill: \"none\",\n  stroke: \"#bababa\",\n  strokeLinecap: \"round\",\n  strokeWidth: 6\n});\n\nvar SvgPlus = function SvgPlus(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 40,\n    height: 40,\n    viewBox: \"0 0 40 40\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgPlus, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/plus.8461f02d.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { ChatAppContext } from '../ChatAppContext';\n\nimport { ReactComponent as LogoutIcon } from './logout.svg';\nimport { ReactComponent as PlusIcon } from './plus.svg';\n\nimport styles from \"./SidebarBanner.module.css\"\n\ninterface SidebarBannerProps extends RouteComponentProps {\n  handleLaunchConversationCreator: () => void,\n  logoutHandler: () => void,\n}\n\nfunction SidebarBanner(props: SidebarBannerProps) {\n  return (\n    <ChatAppContext.Consumer>\n      {\n        context => {\n          return (\n            <header className={styles.main}>\n              <div className={styles.userName}>\n                {context.user.name ?? context.user.username}\n              </div>\n              <button className={styles.button}\n                onClick={props.logoutHandler}>\n                <LogoutIcon className={styles.icon} title=\"Logout\" />\n              </button>\n              <button className={styles.button}\n                onClick={props.handleLaunchConversationCreator}>\n                <PlusIcon className={styles.icon} title=\"New conversation\" />\n              </button>\n            </header>\n          )\n        }\n      }\n    </ChatAppContext.Consumer >\n  );\n}\n\nexport default SidebarBanner;","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\nimport { format as formatDate, differenceInCalendarDays } from 'date-fns';\n\nimport { Conversation } from '../../models/Conversation';\n\nimport styles from \"./ConversationRow.module.css\"\n\ninterface ConversationRowProps extends RouteComponentProps {\n  selected: boolean,\n  conversation: Conversation,\n  handleConversationRowClick: (conversation: Conversation) => void,\n}\n\nfunction ConversationRow(props: ConversationRowProps) {\n  const lastMessage = props.conversation.messages[props.conversation.messages.length - 1];\n\n  const daysDifference = differenceInCalendarDays(new Date(), lastMessage.sent);\n  let messageTimeStr: string;\n\n  if (daysDifference === 0) {\n    messageTimeStr = formatDate(lastMessage.sent, 'p');\n  } else if (daysDifference === 1) {\n    messageTimeStr = \"yesterday\"\n  } else if (daysDifference < 7) {\n    messageTimeStr = formatDate(lastMessage.sent, 'cccc');\n  } else {\n    messageTimeStr = formatDate(lastMessage.sent, 'P');\n  }\n\n  const conversationPartnerName = props.conversation.conversationPartner.name\n    ?? props.conversation.conversationPartner.username\n\n  return (\n    <div\n      className={styles.main + (props.selected ? \" \" + styles.main_selected : \"\")\n      }\n      onClick={() => props.handleConversationRowClick(props.conversation)}>\n      <div className={styles.bubble}>\n        {conversationPartnerName.split(\" \").slice(0, 2).map(e => e.charAt(0).toUpperCase())}\n      </div>\n      <div className={styles.full}>\n        <div className={styles.header}>\n          <div className={styles.name}>\n            {conversationPartnerName}\n          </div>\n          <div className={styles.time}>{messageTimeStr}</div>\n        </div>\n        <div className={styles.message}>\n          {lastMessage.body}\n        </div>\n      </div>\n    </div >\n  );\n}\n\nexport default ConversationRow;\n","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport ConversationRow from './ConversationRow';\nimport { Conversation } from '../../models/Conversation';\n\nimport styles from \"./ConversationList.module.css\"\n\ninterface ConversationListProps extends RouteComponentProps {\n  conversations: Conversation[],\n  selectedConversationUuid: string | null,\n  handleConversationRowClick: (conversation: Conversation) => void,\n}\n\nfunction ConversationList(props: ConversationListProps) {\n  const conversationRows = props.conversations.map(conversation => {\n    return (\n      <ConversationRow\n        key={conversation.uuid}\n        selected={conversation.uuid === props.selectedConversationUuid}\n        conversation={conversation}\n        handleConversationRowClick={props.handleConversationRowClick} />\n    );\n  });\n  return (\n    <div className={styles.main}>\n      {conversationRows}\n    </div>\n  );\n}\n\nexport default ConversationList;\n","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport SidebarBanner from './SidebarBanner';\nimport ConversationList from './ConversationList';\nimport { Conversation } from '../../models/Conversation';\n\nimport { ReactComponent as LogoutIcon } from './logout.svg';\nimport { ReactComponent as PlusIcon } from './plus.svg';\n\nimport styles from './Sidebar.module.css'\n\ninterface SidebarProps extends RouteComponentProps {\n  conversations: Conversation[],\n  selectedConversationUuid: string | null,\n  handleLaunchConversationCreator: () => void,\n  handleConversationRowClick: (conversation: Conversation) => void,\n  logoutHandler: () => void,\n}\n\nfunction Sidebar(props: SidebarProps) {\n  return (\n    <nav className={styles.main}>\n      <div className={styles.control}>\n        <button className={styles.button}\n          onClick={props.handleLaunchConversationCreator}>\n          <PlusIcon className={styles.icon} title=\"New Conversation\" />\n        </button>\n      </div>\n      <SidebarBanner\n        handleLaunchConversationCreator={props.handleLaunchConversationCreator}\n        logoutHandler={props.logoutHandler} />\n      <ConversationList\n        conversations={props.conversations}\n        selectedConversationUuid={props.selectedConversationUuid}\n        handleConversationRowClick={props.handleConversationRowClick} />\n      <div className={styles.control}>\n        <button className={styles.button}\n          onClick={props.logoutHandler}>\n          <LogoutIcon className={styles.icon} title=\"Logout\" />\n        </button>\n      </div>\n    </nav>\n  );\n}\n\nexport default Sidebar;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"translate(-9.6323e-7 -10.288)\"\n}, /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"matrix(1.0981 0 0 1.0981 -11.363 -2.7657)\",\n  strokeWidth: 0.91067\n}, /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"matrix(.70143 0 0 .70143 3.8237 -10.6)\",\n  fill: \"#66c072\",\n  fillRule: \"evenodd\",\n  strokeWidth: 1.2983\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m22.115 44.874v46.131h-12.814l-2e-7 -58.946h38.443v12.814\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m47.744 44.874h12.814v46.131h-12.814z\"\n}))));\n\nvar SvgLogoCompact = function SvgLogoCompact(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 39.48,\n    height: 45.402,\n    viewBox: \"0 0 39.48 45.402\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgLogoCompact, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/logoCompact.70d85da3.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"matrix(1.0981 0 0 1.0981 -11.363 -2.7657)\"\n}, /*#__PURE__*/React.createElement(\"g\", {\n  transform: \"matrix(.70143 0 0 .70143 3.8237 -10.6)\",\n  fill: \"#66c072\",\n  fillRule: \"evenodd\",\n  strokeWidth: 1.2983\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m22.115 44.874v46.131h-12.814l-2e-7 -58.946h38.443v12.814\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m47.744 44.874h12.814v46.131h-12.814z\"\n})), /*#__PURE__*/React.createElement(\"g\", {\n  strokeWidth: 0.24095,\n  \"aria-label\": \"chat\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m82.203 29.191h6.4659q-0.36738-3.3799-1.7634-5.8047-1.3961-2.4982-3.6004-4.1147-2.1308-1.6165-4.9964-2.3513-2.7921-0.80824-6.0251-0.80824-4.4821 0-7.862 1.6165-3.3799 1.543-5.6577 4.3351-2.2043 2.7186-3.3064 6.4659-1.1021 3.6738-1.1021 7.9355t1.1021 7.862q1.1756 3.5269 3.3799 6.0986 2.2778 2.5717 5.5842 3.9677 3.3799 1.3961 7.715 1.3961 7.2742 0 11.462-3.8208 4.2616-3.8208 5.2903-10.875h-6.3925q-0.58781 4.4086-3.233 6.8333-2.5717 2.4247-7.2007 2.4247-2.9391 0-5.0699-1.1756-2.1308-1.1756-3.4534-3.086-1.3226-1.9839-1.9839-4.4821-0.58781-2.4982-0.58781-5.1434 0-2.8656 0.58781-5.5107 0.58781-2.7186 1.9104-4.776 1.3961-2.0573 3.6738-3.3064 2.2778-1.2491 5.6577-1.2491 3.9677 0 6.319 1.9839 2.3513 1.9839 3.086 5.5842z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m95.878 2.5186v52.462h6.2455v-21.455q0-2.5717 0.66129-4.7025 0.73477-2.2043 2.1308-3.8208 1.3961-1.6165 3.4534-2.4982 2.1308-0.88172 4.9964-0.88172 3.6004 0 5.6577 2.0573 2.0573 2.0573 2.0573 5.5842v25.717h6.2455v-24.982q0-3.086-0.66129-5.5842-0.58781-2.5717-2.1308-4.4086t-4.0412-2.8656q-2.4982-1.0287-6.2455-1.0287-1.69 0-3.5269 0.36738-1.7634 0.36738-3.4534 1.1756-1.6165 0.73477-2.9391 1.9839-1.3226 1.1756-2.0574 2.9391h-0.14695v-20.059z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m170.43 54.834q-1.6165 0.9552-4.4821 0.9552-2.4247 0-3.8943-1.3226-1.3961-1.3961-1.3961-4.4821-2.5717 3.086-6.0251 4.4821-3.3799 1.3226-7.3477 1.3226-2.5717 0-4.9229-0.58781-2.2778-0.58781-3.9677-1.8369t-2.7186-3.233q-0.9552-2.0573-0.9552-4.9229 0-3.233 1.1022-5.2903t2.8656-3.3064q1.8369-1.3226 4.1147-1.9839 2.3512-0.66129 4.776-1.1021 2.5717-0.51434 4.8494-0.73477 2.3512-0.29391 4.1147-0.73477 1.7634-0.51434 2.7921-1.3961 1.0287-0.9552 1.0287-2.7186 0-2.0573-0.80824-3.3064-0.73476-1.2491-1.9839-1.9104-1.1756-0.66129-2.7186-0.88172-1.4695-0.22043-2.9391-0.22043-3.9677 0-6.6129 1.543-2.6452 1.4695-2.8656 5.6577h-6.2455q0.14696-3.5269 1.4695-5.9516 1.3226-2.4247 3.5269-3.8943 2.2043-1.543 4.9964-2.2043 2.8656-0.66129 6.0986-0.66129 2.5717 0 5.0699 0.36738 2.5717 0.36738 4.629 1.543 2.0573 1.1021 3.3064 3.1595 1.2491 2.0573 1.2491 5.3638v19.545q0 2.2043 0.22043 3.233 0.2939 1.0287 1.7634 1.0287 0.80824 0 1.9104-0.36738zm-10.14-19.471q-1.1756 0.88172-3.086 1.3226-1.9104 0.36738-4.0412 0.66129-2.0574 0.22043-4.1882 0.58781-2.1308 0.29391-3.8208 1.0287t-2.7921 2.1308q-1.0287 1.3226-1.0287 3.6738 0 1.543 0.58782 2.6452 0.66129 1.0287 1.6165 1.69 1.0287 0.66129 2.3512 0.9552 1.3226 0.29391 2.7921 0.29391 3.086 0 5.2903-0.80824 2.2043-0.88172 3.6004-2.1308 1.3961-1.3226 2.0574-2.7921 0.66129-1.543 0.66129-2.8656z\"\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m184.91 16.993v-11.389h-6.2455v11.389h-6.4659v5.5107h6.4659v24.174q0 2.6452 0.51434 4.2616 0.51433 1.6165 1.543 2.4982 1.1022 0.88172 2.7921 1.2491 1.7634 0.29391 4.1882 0.29391h4.776v-5.5107h-2.8656q-1.4695 0-2.4247-0.07348-0.88171-0.14695-1.396-0.51434t-0.73477-1.0287q-0.14695-0.66129-0.14695-1.7634v-23.586h7.5681v-5.5107z\"\n})));\n\nvar SvgLogo = function SvgLogo(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 200,\n    height: 58.496,\n    viewBox: \"0 0 200 58.496\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgLogo, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/logo.09a69678.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react'\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { Conversation } from '../../models/Conversation';\n\nimport { ReactComponent as NchatLogoCompact } from '../../assets/logoCompact.svg';\nimport { ReactComponent as NchatLogo } from '../../assets/logo.svg';\n\nimport styles from './ConversationViewBanner.module.css'\n\ninterface ConversationViewBannerProps extends RouteComponentProps {\n  selectedConversation: Conversation,\n}\n\ninterface ConversationViewBannerState {\n}\n\nfunction ConversationViewBanner(props: ConversationViewBannerProps) {\n  return (\n    <header className={styles.main}>\n      <div className={styles.name}>\n        {props.selectedConversation.conversationPartner.name\n          ?? props.selectedConversation.conversationPartner.username}\n      </div>\n      <NchatLogoCompact className={styles.logoCompact} title=\"nchat logo\" />\n      <NchatLogo className={styles.logo} title=\"nchat logo\" />\n    </header>\n  );\n}\n\nexport default ConversationViewBanner;","import React from \"react\"\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { ChatAppContext } from \"../ChatAppContext\";\nimport { Message } from \"../../models/Message\";\n\nimport styles from './MessageView.module.css'\n\ninterface MessageViewProps extends RouteComponentProps {\n  message: Message,\n}\n\nfunction MessageView(props: MessageViewProps) {\n  return (\n    <ChatAppContext.Consumer>\n      {context =>\n        <div\n          className={\n            styles.main\n            + (context.user?.id === props.message.senderId\n              ? (props.message.id === null\n                ? \" \" + styles.fromUs_unsynced\n                : \" \" + styles.fromUs_synced\n              )\n              : \" \" + styles.fromThem)\n          }>\n          <div className={styles.messageBody}>\n            {props.message.body}\n          </div>\n        </div >\n      }\n    </ChatAppContext.Consumer >\n  );\n}\n\nexport default MessageView;\n","import React from 'react'\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport MessageView from './MessageView';\nimport { Message } from '../../models/Message';\nimport { ChatAppContext } from '../ChatAppContext';\n\nimport styles from './MessagesView.module.css'\nimport loadingIconStyles from '../../assets/LoadingIcon.module.css';\n\ninterface MessagesViewProps extends RouteComponentProps {\n  isLoading: boolean,\n  messages: Message[],\n}\n\ninterface MessagesViewState {\n}\n\ninterface MessagesViewSnapshot {\n  isScrolledToBottom: boolean,\n}\n\nclass MessagesView extends React.Component<MessagesViewProps, MessagesViewState> {\n  // Number of pixels chat div can be scrolled above bottom to still be considered at bottom\n  SCROLL_TOLERANCE = 40;\n\n  conversationViewDiv = React.createRef<HTMLDivElement>();\n\n  static contextType = ChatAppContext;\n  context!: React.ContextType<typeof ChatAppContext>\n\n  constructor(props: MessagesViewProps) {\n    super(props);\n    this.scrollToBottom = this.scrollToBottom.bind(this);\n  }\n\n  componentDidMount() {\n    this.scrollToBottom();\n  }\n\n  getSnapshotBeforeUpdate(prevProps: MessagesViewProps, prevState: MessagesViewState):\n    MessagesViewSnapshot {\n    return {\n      isScrolledToBottom: this.isScrolledToBottom()\n    };\n  }\n\n  componentDidUpdate(\n    prevProps: MessagesViewProps,\n    prevState: MessagesViewState,\n    snapshot: MessagesViewSnapshot,\n  ) {\n    const prevMessages = prevProps.messages;\n    const messages = this.props.messages;\n\n    // If there's a new message added\n    if (prevMessages[prevMessages.length - 1]?.uuid !== messages[messages.length - 1]?.uuid) {\n      // Keep us scrolled to the bottom if we're already there, or if the last message\n      // added is from us (i.e. we just sent a message).\n      if (snapshot.isScrolledToBottom\n        || messages[messages.length - 1].senderId === this.context.user.id) {\n        this.scrollToBottom();\n      }\n    }\n  }\n\n  private isScrolledToBottom(): boolean {\n    const node = this.conversationViewDiv.current;\n    if (node === null) {\n      return true;\n    }\n    return node.scrollTop >= (node.scrollHeight - node.clientHeight) - this.SCROLL_TOLERANCE;\n  }\n\n  private scrollToBottom() {\n    const node = this.conversationViewDiv.current;\n    if (node === null) {\n      return;\n    }\n    node.scrollTo(0, node.scrollHeight - node.clientHeight);\n  }\n\n  render() {\n    let messages: JSX.Element[] = this.props.messages.map(message => {\n      return <MessageView key={message.uuid} message={message} />\n    });\n    return (\n      <div className={styles.main} ref={this.conversationViewDiv}>\n        {this.props.isLoading &&\n          <div className={styles.loading}>\n            <div className={styles.loadingIcon + \" \" + loadingIconStyles.main}></div>\n          </div>}\n        {messages}\n      </div>\n    );\n  }\n}\n\nexport default MessagesView;\n","import React, { ChangeEvent, KeyboardEvent } from 'react'\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport styles from './MessageInput.module.css'\n\ninterface MessageInputProps extends RouteComponentProps {\n  autoFocus?: boolean,\n  disabled?: boolean,\n  handleSendMessage: (messageBody: string) => boolean,\n}\n\ninterface MessageInputState {\n  messageBody: string,\n}\n\nclass MessageInput extends React.Component<MessageInputProps, MessageInputState> {\n  state: MessageInputState = {\n    messageBody: \"\",\n  };\n\n  constructor(props: MessageInputProps) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleClickSend = this.handleClickSend.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  handleChange(event: ChangeEvent<HTMLInputElement>) {\n    this.setState({\n      messageBody: event.target.value,\n    });\n  }\n\n  async handleClickSend() {\n    if (this.state.messageBody.trim() === \"\") {\n      return;\n    }\n    const success = this.props.handleSendMessage(this.state.messageBody);\n    if (success) {\n      this.setState({\n        messageBody: \"\",\n      });\n    }\n  }\n\n  handleKeyDown(event: KeyboardEvent<HTMLInputElement>) {\n    if (event.key === \"Enter\") {\n      this.handleClickSend();\n    }\n  }\n\n  render() {\n    return (\n      <div className={styles.main}>\n        <input\n          name=\"messageBody\"\n          className={styles.input}\n          type=\"text\"\n          value={this.state.messageBody}\n          onKeyDown={this.handleKeyDown}\n          onChange={this.handleChange}\n          autoFocus={this.props.autoFocus}\n          placeholder=\"Type a message\"\n          autoComplete=\"off\" />\n        <button\n          className={styles.button + \" button\"}\n          onClick={this.handleClickSend}\n          disabled={this.props.disabled}>\n          Send\n          </button>\n      </div>\n    );\n  }\n}\n\nexport default MessageInput;\n","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { Conversation } from '../../models/Conversation';\nimport ConversationViewBanner from './ConversationViewBanner';\nimport MessagesView from './MessagesView';\nimport MessageInput from './MessageInput';\n\nimport styles from './ConversationView.module.css'\n\ninterface ConversationViewProps extends RouteComponentProps {\n  selectedConversation: Conversation,\n  handleSendMessage: (messageBody: string) => void,\n}\n\nfunction ConversationView(props: ConversationViewProps) {\n  const autoFocus = window.matchMedia(\"(min-width: 700px)\").matches;\n\n  return (\n    <div className={styles.main} >\n      <ConversationViewBanner\n        selectedConversation={props.selectedConversation} />\n      <MessagesView\n        isLoading={props.selectedConversation.isLoading}\n        messages={props.selectedConversation.messages} />\n      <MessageInput\n        autoFocus={autoFocus}\n        handleSendMessage={\n          (messageBody) => {\n            props.handleSendMessage(messageBody);\n            return true;\n          }\n        } />\n    </div>\n  );\n}\n\nexport default ConversationView","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"ellipse\", {\n  cx: 20,\n  cy: 20,\n  rx: 18,\n  ry: 18,\n  strokeWidth: 4\n});\n\nvar SvgGreenCheck = function SvgGreenCheck(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 40,\n    height: 40,\n    viewBox: \"0 0 40 40\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, /*#__PURE__*/React.createElement(\"g\", {\n    fill: \"none\",\n    stroke: \"#66c072\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"m10.9 21.485 5.2674 5.2314 12.252-12.169\",\n    strokeWidth: 4,\n    style: {\n      paintOrder: \"normal\"\n    }\n  }), _ref2));\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgGreenCheck, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/greenCheck.9955ebcf.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"g\", {\n  fill: \"none\"\n}, /*#__PURE__*/React.createElement(\"circle\", {\n  cx: 100,\n  cy: 100,\n  r: 0,\n  stroke: \"#ab2121\",\n  strokeWidth: 19.413\n}), /*#__PURE__*/React.createElement(\"g\", {\n  stroke: \"#bc2020\",\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\"\n}, /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m13 13 14 14\",\n  strokeWidth: 4\n}), /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m27 13-14 14\",\n  strokeWidth: 4\n}), /*#__PURE__*/React.createElement(\"ellipse\", {\n  cx: 20,\n  cy: 20,\n  rx: 18,\n  ry: 18,\n  strokeWidth: 4\n})));\n\nvar SvgRedX = function SvgRedX(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 40,\n    height: 40,\n    viewBox: \"0 0 40 40\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgRedX, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/redX.9d8ae0c2.svg\";\nexport { ForwardRef as ReactComponent };","import React, { ChangeEvent, FocusEvent } from 'react';\n\nimport { ReactComponent as GreenCheck } from './greenCheck.svg';\nimport { ReactComponent as RedX } from './redX.svg';\n\nimport { ReactComponent as NchatLogoCompact } from '../../assets/logoCompact.svg';\nimport { ReactComponent as NchatLogo } from '../../assets/logo.svg';\n\nimport styles from './ConversationCreatorViewBanner.module.css'\nimport loadingIconStyles from '../../assets/LoadingIcon.module.css';\n\nexport enum ConversationCreatorViewBannerStatus {\n  Empty,\n  Loading,\n  Ok,\n  Error,\n}\n\ninterface ConversationCreatorViewBannerProps {\n  conversationCreatorUsername: string,\n  status: ConversationCreatorViewBannerStatus,\n  handleChange: (event: ChangeEvent<HTMLInputElement>) => void,\n  handleBlur: (event: FocusEvent<HTMLInputElement>) => void,\n}\n\ninterface ConversationCreatorViewBannerState {\n}\n\nclass ConversationCreatorViewBanner extends\n  React.Component<ConversationCreatorViewBannerProps, ConversationCreatorViewBannerState> {\n  render() {\n    let status: JSX.Element;\n    switch (this.props.status) {\n      case ConversationCreatorViewBannerStatus.Empty:\n        status = <span className={styles.to}>To:</span>;\n        break;\n      case ConversationCreatorViewBannerStatus.Loading:\n        status = <div className={styles.loading + \" \" + loadingIconStyles.main}\n          title=\"Checking username...\" ></div >;\n        break;\n      case ConversationCreatorViewBannerStatus.Error:\n        status = <RedX className={styles.error}\n          title=\"Username doesn't exist\" />\n        break;\n      case ConversationCreatorViewBannerStatus.Ok:\n        status = <GreenCheck className={styles.success}\n          title=\"Username OK\" />\n        break;\n    }\n    return (\n      <header className={styles.main} >\n        <div className={styles.status}>\n          <label\n            htmlFor=\"ConversationCreatorViewBannerInput\"\n            className={styles.label}>\n            {status}\n          </label>\n        </div>\n        <input\n          id=\"ConversationCreatorViewBannerInput\"\n          className={styles.input}\n          type=\"text\"\n          value={this.props.conversationCreatorUsername}\n          autoFocus={true}\n          onChange={this.props.handleChange}\n          onBlur={this.props.handleBlur}\n          placeholder=\"Username\"\n          autoComplete=\"off\" />\n        <NchatLogoCompact className={styles.logoCompact} title=\"nchat logo\" />\n        <NchatLogo className={styles.logo} title=\"nchat logo\" />\n      </header>\n    );\n  }\n}\n\nexport default ConversationCreatorViewBanner;","import React, { ChangeEvent, FocusEvent } from 'react';\n\nimport ConversationCreatorViewBanner, { ConversationCreatorViewBannerStatus }\n  from './ConversationCreatorViewBanner';\nimport MessageInput from './MessageInput';\nimport { User } from '../../models/User';\nimport NchatApi from '../../utils/NchatApi';\nimport { ChatAppContext } from '../ChatAppContext';\nimport { UserJson } from '../../utils/json/UserJson';\n\nimport styles from './ConversationCreatorView.module.css';\n\ninterface GetUserResponse {\n  user: UserJson,\n}\n\ninterface ConversationCreatorViewProps {\n  handleSendMessage: (messageBody: string, user?: User) => void,\n}\n\ninterface ConversationCreatorViewState {\n  username: string,\n  conversationPartner: User | null,\n  usernameInputStatus: ConversationCreatorViewBannerStatus,\n}\n\nclass ConversationCreatorView\n  extends React.Component<ConversationCreatorViewProps, ConversationCreatorViewState> {\n\n  static contextType = ChatAppContext;\n  context!: React.ContextType<typeof ChatAppContext>\n\n  state: ConversationCreatorViewState = {\n    username: \"\",\n    conversationPartner: null,\n    usernameInputStatus: ConversationCreatorViewBannerStatus.Empty,\n  }\n\n  constructor(props: ConversationCreatorViewProps) {\n    super(props);\n    this.handleUsernameChange = this.handleUsernameChange.bind(this);\n    this.handleSendMessage = this.handleSendMessage.bind(this);\n    this.handleUsernameInputBlur = this.handleUsernameInputBlur.bind(this);\n  }\n\n  handleUsernameChange(event: ChangeEvent<HTMLInputElement>) {\n    const username = event.target.value;\n    this.setState({\n      usernameInputStatus: ConversationCreatorViewBannerStatus.Empty,\n      username: username,\n    });\n  }\n\n  handleSendMessage(messageBody: string): boolean {\n    if (this.state.conversationPartner === null) {\n      return false;\n    }\n    this.props.handleSendMessage(messageBody, this.state.conversationPartner);\n    return true;\n  }\n\n  async handleUsernameInputBlur(event: FocusEvent<HTMLInputElement>) {\n    this.setState({\n      usernameInputStatus: ConversationCreatorViewBannerStatus.Loading,\n    });\n\n    const username = this.state.username.trim();\n\n    if (username === \"\") {\n      this.setState({\n        usernameInputStatus: ConversationCreatorViewBannerStatus.Empty,\n      });\n      return;\n    }\n\n    try {\n      const conversationPartner = await this.getConversationPartner(username);\n      this.setState({\n        conversationPartner: conversationPartner,\n        usernameInputStatus: ConversationCreatorViewBannerStatus.Ok,\n      });\n    } catch (err) {\n      this.setState({\n        conversationPartner: null,\n        usernameInputStatus: ConversationCreatorViewBannerStatus.Error,\n      });\n    }\n  }\n\n  async getConversationPartner(username: string): Promise<User> {\n    const response =\n      await NchatApi.get<GetUserResponse>(\"users/\" + username, this.context.authKey);\n    const userJson = response.data.user;\n\n    return {\n      id: userJson.id,\n      username: userJson.username,\n      name: userJson.name,\n    }\n  }\n\n  render() {\n    return (\n      <div className={styles.main}>\n        <ConversationCreatorViewBanner\n          conversationCreatorUsername={this.state.username}\n          status={this.state.usernameInputStatus}\n          handleChange={this.handleUsernameChange}\n          handleBlur={this.handleUsernameInputBlur} />\n        <div className={styles.spacer} />\n        <MessageInput\n          autoFocus={false}\n          handleSendMessage={this.handleSendMessage}\n          disabled={this.state.usernameInputStatus !== ConversationCreatorViewBannerStatus.Ok} />\n      </div>\n    )\n  }\n}\n\nexport default ConversationCreatorView;","import React from 'react';\nimport { RouteComponentProps } from \"@reach/router\";\n\nimport { Conversation } from '../../models/Conversation';\nimport ConversationView from './ConversationView';\nimport ConversationCreatorView from './ConversationCreatorView';\nimport { User } from '../../models/User';\n\nimport { ReactComponent as NchatLogoCompact } from '../../assets/logoCompact.svg';\nimport { ReactComponent as NchatLogo } from '../../assets/logo.svg';\nimport { ReactComponent as PlusIcon } from '../sidebar/plus.svg';\n\nimport styles from \"./ContentView.module.css\";\n\ninterface ContentViewProps extends RouteComponentProps {\n  isConversationCreatorOpen: boolean,\n  selectedConversation: Conversation | null,\n  handleSendMessage: (messageBody: string, user?: User) => void,\n}\n\nfunction ContentView(props: ContentViewProps) {\n  let content: JSX.Element;\n  if (props.isConversationCreatorOpen) {\n    content = <ConversationCreatorView\n      handleSendMessage={props.handleSendMessage} />\n  } else if (props.selectedConversation !== null) {\n    content = <ConversationView\n      selectedConversation={props.selectedConversation}\n      handleSendMessage={props.handleSendMessage}\n      key={props.selectedConversation?.uuid} />\n  } else {\n    const actionPhrase = window.matchMedia(\"(hover: hover)\").matches ? \"Click\" : \"Tap\";\n    content =\n      <div className={styles.noConversationContainer}>\n        <div className={styles.noConversation}>\n          <NchatLogoCompact className={styles.logo + \" \" + styles.logoCompact} title=\"nchat logo\" />\n          <NchatLogo className={styles.logo + \" \" + styles.logoFull} title=\"nchat logo\" />\n          <div className={styles.hint}>\n            {actionPhrase}\n            &nbsp;\n          <PlusIcon className={styles.newChatIcon} title=\"New conversation\" />\n          &nbsp;\n          to start a new conversation.\n        </div>\n        </div>\n      </div >\n  }\n  return (\n    <main className={styles.main}>\n      {content}\n    </main>\n  );\n}\n\nexport default ContentView;\n","import React from 'react';\nimport { navigate, RouteComponentProps } from '@reach/router';\nimport { v4 as uuidv4 } from 'uuid';\nimport update from 'immutability-helper';\nimport parseISO from 'date-fns/parseISO'\n\nimport NchatApi from '../utils/NchatApi';\nimport Sidebar from './sidebar/Sidebar'\nimport ContentView from './contentView/ContentView'\nimport { User } from '../models/User';\nimport { Conversation } from '../models/Conversation';\nimport { Message } from '../models/Message';\nimport { ConversationJson } from '../utils/json/ConversationJson';\nimport { MessageJson } from '../utils/json/MessageJson';\nimport { ChatAppContext } from './ChatAppContext';\nimport NchatWebSocket, { WSNotification, WSRequest, WSSuccessResponse }\n  from '../utils/NchatWebSocket';\n\nimport styles from './ChatApp.module.css';\n\ninterface GetConversationResponse {\n  conversation: ConversationJson,\n}\n\ninterface WSMessageNotificationData {\n  message: MessageJson,\n  conversation: ConversationJson,\n}\n\ninterface WSMessageRequestData {\n  username: string,\n  body: string,\n}\n\ninterface WSMessageSuccessResponseData {\n  message: MessageJson,\n  conversation: ConversationJson,\n}\n\ninterface WSMessageErrorResponseData {\n}\n\ninterface ChatAppProps extends RouteComponentProps {\n  authKey: string,\n  user: User,\n  conversations: Conversation[],\n  webSocket: NchatWebSocket,\n  logoutHandler: () => void,\n}\n\ninterface ChatAppState {\n  conversations: Conversation[],\n  selectedConversationUuid: string | null,\n  isConversationCreatorOpen: boolean,\n}\n\nclass ChatApp extends React.Component<ChatAppProps, ChatAppState> {\n  state: ChatAppState = {\n    conversations: this.props.conversations,\n    selectedConversationUuid: null,\n    isConversationCreatorOpen: false,\n  }\n\n  constructor(props: ChatAppProps) {\n    super(props);\n    this.handleMessageReceived = this.handleMessageReceived.bind(this);\n    this.handleLaunchConversationCreator = this.handleLaunchConversationCreator.bind(this);\n    this.handleConversationRowClick = this.handleConversationRowClick.bind(this);\n    this.handleSendMessage = this.handleSendMessage.bind(this);\n    this.logoutHandler = this.logoutHandler.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.webSocket.addNotificationListener(\"newMessage\", this.handleMessageReceived);\n  }\n\n  handleLaunchConversationCreator() {\n    this.setState({\n      selectedConversationUuid: null,\n      isConversationCreatorOpen: true,\n    });\n  }\n\n  async handleConversationRowClick(conversation: Conversation) {\n    if (conversation.uuid === this.state.selectedConversationUuid) {\n      return;\n    }\n\n    this.setState({\n      isConversationCreatorOpen: false,\n      selectedConversationUuid: conversation.uuid,\n    });\n\n    if (!conversation.isHistoryLoaded && !conversation.isLoading) {\n      let conversationIndex = this.state.conversations.findIndex(c => c.uuid === conversation.uuid);\n      const loadingConversations = update(this.state.conversations,\n        {\n          [conversationIndex]: {\n            isLoading: {\n              $set: true,\n            },\n          },\n        },\n      );\n\n      this.setState({\n        conversations: loadingConversations,\n      });\n\n      const response = await NchatApi.get<GetConversationResponse>(\n        \"conversations/\" + conversation.id, this.props.authKey);\n\n      const retrievedMessages: Message[] = response.data.conversation.messages.map(message => {\n        return {\n          uuid: uuidv4(),\n          id: message.id,\n          senderId: message.senderId,\n          body: message.body,\n          sent: parseISO(message.sent),\n        }\n      });\n\n      conversationIndex = this.state.conversations.findIndex(c => c.uuid === conversation.uuid);\n      const updatedConversations = update(this.state.conversations,\n        {\n          [conversationIndex]: {\n            messages: {\n              $set: retrievedMessages,\n            },\n            isLoading: {\n              $set: false,\n            },\n            isHistoryLoaded: {\n              $set: true,\n            }\n          }\n        },\n      );\n\n      this.setState({\n        conversations: updatedConversations,\n      });\n    }\n  }\n\n  handleMessageReceived(notification: WSNotification<WSMessageNotificationData>) {\n    const messageJson = notification.data.message;\n    const conversationJson = notification.data.conversation;\n\n    const newMessage: Message = {\n      uuid: uuidv4(),\n      id: messageJson.id,\n      body: messageJson.body,\n      senderId: messageJson.senderId,\n      sent: parseISO(messageJson.sent),\n    };\n\n    const conversationIndex = this.state.conversations.findIndex(c => c.id === conversationJson.id);\n    if (conversationIndex === -1) {\n      const newConversation: Conversation = {\n        uuid: uuidv4(),\n        id: conversationJson.id,\n        conversationPartner: {\n          id: conversationJson.conversationPartner.id,\n          username: conversationJson.conversationPartner.username,\n          name: conversationJson.conversationPartner.name,\n        },\n        messages: [newMessage],\n        isHistoryLoaded: true,\n        isLoading: false,\n      };\n      const updatedConversations = [\n        newConversation,\n        ...this.state.conversations,\n      ];\n      this.setState({\n        conversations: updatedConversations,\n      });\n    } else {\n      const updatedConversations =\n        this.addMessageToConversation(this.state.conversations, conversationIndex, newMessage);\n      this.setState({\n        conversations: updatedConversations,\n      });\n    }\n  }\n\n  async handleSendMessage(messageBody: string, conversationPartner?: User) {\n    const newMessage: Message = {\n      uuid: uuidv4(),\n      id: null,\n      senderId: this.props.user.id,\n      body: messageBody,\n      sent: new Date(),\n    }\n\n    let selectedConversation: Conversation | null;\n\n    if (this.state.isConversationCreatorOpen && conversationPartner) {\n      const newConversation: Conversation = {\n        uuid: uuidv4(),\n        id: null,\n        conversationPartner: conversationPartner,\n        isHistoryLoaded: true,\n        isLoading: false,\n        messages: [newMessage],\n      };\n\n      this.setState((state, props) => {\n        const updatedConversations = [\n          newConversation,\n          ...state.conversations,\n        ];\n        return {\n          conversations: updatedConversations,\n          selectedConversationUuid: newConversation.uuid,\n          isConversationCreatorOpen: false,\n        };\n      });\n\n      selectedConversation = newConversation;\n    } else {\n      if (this.state.selectedConversationUuid === null) {\n        return;\n      }\n\n      const conversationIndex = this.state.conversations.findIndex(c => {\n        return c.uuid === this.state.selectedConversationUuid\n      });\n      const updatedConversations =\n        this.addMessageToConversation(this.state.conversations, conversationIndex, newMessage);\n\n      this.setState({\n        conversations: updatedConversations,\n      });\n\n      selectedConversation = updatedConversations[0];\n    }\n\n    const response = await this.sendMessage(\n      selectedConversation.conversationPartner.username, messageBody);\n\n\n    this.setState((state, props) => {\n      const conversationIndex = state.conversations.findIndex(c => {\n        return c.uuid === selectedConversation?.uuid\n      });\n      const messageIndex = state.conversations[conversationIndex].messages.findIndex(m => {\n        return m.uuid === newMessage.uuid;\n      });\n\n      const syncedConversations = update(state.conversations,\n        {\n          [conversationIndex]: {\n            id: {\n              $set: response.data.conversation.id,\n            },\n            messages: {\n              [messageIndex]: {\n                id: {\n                  $set: response.data.message.id,\n                },\n                sent: {\n                  $set: parseISO(response.data.message.sent),\n                }\n              },\n            },\n          },\n        },\n      );\n\n      return {\n        conversations: syncedConversations,\n      };\n    });\n  }\n\n  logoutHandler() {\n    this.props.logoutHandler();\n    navigate(\"/accounts/get-started\");\n  }\n\n  private addMessageToConversation(conversations: Conversation[], index: number, message: Message):\n    Conversation[] {\n    const updatedConversation = update(this.state.conversations[index],\n      {\n        messages: {\n          $push: [message],\n        }\n      }\n    );\n    const withRemovedConversation = update(conversations,\n      {\n        $splice: [[index, 1]]\n      }\n    );\n    return [\n      updatedConversation,\n      ...withRemovedConversation,\n    ]\n  }\n\n  private sendMessage(username: string, body: string):\n    Promise<WSSuccessResponse<WSMessageSuccessResponseData>> {\n    const request: WSRequest<WSMessageRequestData> = {\n      type: \"request\",\n      method: \"sendMessage\",\n      data: {\n        username: username,\n        body: body,\n      },\n    };\n    return this.props.webSocket.sendRequest(request);\n  }\n\n  render() {\n    const contextValue = {\n      authKey: this.props.authKey,\n      user: this.props.user,\n    }\n\n    const selectedConversation = this.state.conversations\n      .find(c => c.uuid === this.state.selectedConversationUuid) ?? null;\n\n    return (\n      <div className={styles.main}>\n        <ChatAppContext.Provider value={contextValue}>\n          <Sidebar\n            conversations={this.state.conversations}\n            selectedConversationUuid={this.state.selectedConversationUuid}\n            handleConversationRowClick={this.handleConversationRowClick}\n            handleLaunchConversationCreator={this.handleLaunchConversationCreator}\n            logoutHandler={this.logoutHandler} />\n          <ContentView\n            isConversationCreatorOpen={this.state.isConversationCreatorOpen}\n            handleSendMessage={this.handleSendMessage}\n            selectedConversation={selectedConversation} />\n        </ChatAppContext.Provider>\n      </div >\n    );\n  }\n\n  componentWillUnmount() {\n    this.props.webSocket.close();\n  }\n}\n\nexport default ChatApp;\n","export interface WSNotification<T> {\n  type: \"notification\",\n  method: string,\n  data: T,\n}\n\nexport interface WSRequest<T> {\n  id?: number,\n  type: \"request\",\n  method: string,\n  data: T,\n}\n\nexport interface WSSuccessResponse<T> {\n  id: number,\n  type: \"response\",\n  status: \"success\",\n  data: T,\n}\n\nexport interface WSErrorResponse<T> {\n  id: number,\n  type: \"response\",\n  status: \"error\",\n  code: number,\n  message: string,\n  data: T,\n}\n\ntype NotificationListener = (notification: WSNotification<any>) => void\ninterface NotificationListeners {\n  [index: string]: NotificationListener[]\n}\n\ntype PromiseResolveFunc = (value: WSSuccessResponse<any>) => void;\ntype PromiseRejectFunc = (reason: WSErrorResponse<any>) => void;\ntype PromiseCallbacks = {\n  resolve: PromiseResolveFunc,\n  reject: PromiseRejectFunc,\n}\n\nclass NchatWebSocket {\n  static websocketUrl = NchatWebSocket.getWebsocketUrl();\n\n  webSocket: WebSocket;\n  isAuthMessageSent = false;\n  requestId = 0;\n  requestPromiseCallbacks: PromiseCallbacks[] = [];\n  notificationListeners: NotificationListeners = {};\n\n  static getWebsocketUrl(): string {\n    let location = window.location;\n    let url = (location.protocol === \"https:\" ? \"wss:\" : \"ws:\");\n    url += \"//\" + location.host + \"/api/v1/chat\";\n    return url;\n  }\n\n  static createWebSocket(): Promise<NchatWebSocket> {\n    const webSocket = new WebSocket(this.websocketUrl, \"nchat\");\n    return new Promise((resolve, reject) => {\n      webSocket.addEventListener(\"open\", (event: Event) => {\n        const nchatWebSocket = new NchatWebSocket(webSocket);\n        resolve(nchatWebSocket);\n      })\n      webSocket.addEventListener(\"error\", (event: Event) => {\n        reject(event);\n      })\n    });\n  }\n\n  constructor(webSocket: WebSocket) {\n    this.handleMessageReceived = this.handleMessageReceived.bind(this);\n    this.webSocket = webSocket;\n    this.webSocket.addEventListener(\"message\", this.handleMessageReceived);\n  }\n\n  handleMessageReceived(event: MessageEvent) {\n    const data: WSNotification<any> | WSSuccessResponse<any> | WSErrorResponse<any> =\n      JSON.parse(event.data);\n    if (data.type === \"response\") {\n      const callbacks = this.requestPromiseCallbacks[data.id];\n      if (typeof callbacks === 'undefined') {\n        return;\n      }\n\n      if (data.status === \"success\") {\n        callbacks.resolve(data);\n      } else {\n        callbacks.reject(data);\n      }\n    } else if (data.type === \"notification\") {\n      const listeners = this.notificationListeners[data.method];\n      if (typeof listeners === \"undefined\") {\n        return;\n      }\n\n      for (const listener of listeners) {\n        listener(data);\n      }\n    }\n  }\n\n  addNotificationListener(method: string, listener: (notification: WSNotification<any>) => void) {\n    if (this.notificationListeners.hasOwnProperty(method)) {\n      this.notificationListeners[method]?.push(listener);\n    } else {\n      this.notificationListeners[method] = [listener];\n    }\n  }\n\n  sendRequest<T, S>(request: WSRequest<T>):\n    Promise<WSSuccessResponse<S>> {\n    const id = this.getNextId();\n    request.id = id;\n\n    this.webSocket.send(JSON.stringify(request));\n\n    return new Promise((resolve, reject) => {\n      this.registerPromise(id, resolve, reject);\n    });\n  }\n\n  close() {\n    this.webSocket.close();\n  }\n\n  private registerPromise(id: number, resolve: PromiseResolveFunc, reject: PromiseRejectFunc) {\n    this.requestPromiseCallbacks[id] = {\n      resolve: resolve,\n      reject: reject\n    };\n  }\n\n  private getNextId(): number {\n    return this.requestId++;\n  }\n}\n\nexport default NchatWebSocket;","import React, { ChangeEvent, FormEvent } from 'react';\nimport { RouteComponentProps } from '@reach/router';\nimport { Link } from \"@reach/router\";\nimport { NchatApiError } from '../utils/NchatApi';\n\nimport styles from './LoginForm.module.css';\nimport loadingIconStyles from '../assets/LoadingIcon.module.css';\n\nenum LoginFormStatus {\n  Empty,\n  Loading,\n  Error,\n}\n\ninterface LoginFormProps extends RouteComponentProps {\n  authenticateUser: (username: string, password: string) => Promise<void>,\n};\n\ninterface LoginFormState {\n  username: string,\n  password: string,\n  status: {\n    value: LoginFormStatus,\n    message?: string,\n  },\n}\n\nclass LoginForm extends React.Component<LoginFormProps, LoginFormState> {\n  state: LoginFormState = {\n    username: '',\n    password: '',\n    status: {\n      value: LoginFormStatus.Empty,\n    }\n  };\n\n  constructor(props: LoginFormProps) {\n    super(props);\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleChange(event: ChangeEvent<HTMLInputElement>) {\n    switch (event.target.name) {\n      case \"username\":\n        this.setState({\n          username: event.target.value,\n        });\n        break;\n      case \"password\":\n        this.setState({\n          password: event.target.value,\n        });\n        break;\n    }\n  }\n\n  async handleSubmit(event: FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n\n    this.setState({\n      status: {\n        value: LoginFormStatus.Loading,\n      }\n    });\n\n    try {\n      await this.props.authenticateUser(this.state.username, this.state.password);\n    } catch (error) {\n      if (error instanceof NchatApiError && error.body.code === 1) {\n        this.setState({\n          status: {\n            value: LoginFormStatus.Error,\n            message: \"The username or password you entered doesn't match our records. Please try again.\",\n          },\n        });\n      } else {\n        this.setState({\n          status: {\n            value: LoginFormStatus.Error,\n            message: \"Could not login. Please try again later.\",\n          },\n        });\n      }\n    }\n  }\n\n  render() {\n    const autoFocus = window.matchMedia(\"(min-width: 700px)\").matches;\n\n    let status: JSX.Element | null;\n    switch (this.state.status.value) {\n      case LoginFormStatus.Empty:\n        status = null;\n        break;\n      case LoginFormStatus.Loading:\n        status = <div className={styles.loading + \" \" + loadingIconStyles.main}></div>;\n        break;\n      case LoginFormStatus.Error:\n        status =\n          <div className=\"errorMessage\">\n            {this.state.status.message}\n          </div>\n        break;\n    }\n\n    return (\n      <div className={styles.main} >\n        <h1 className={styles.header}>Login</h1>\n        <form onSubmit={this.handleSubmit}>\n          <p><input className=\"textInput\" name=\"username\" type=\"text\" placeholder=\"Username\"\n            value={this.state.username} onChange={this.handleChange} required={true}\n            autoFocus={autoFocus} /></p>\n          <p><input className=\"textInput\" name=\"password\" type=\"password\" placeholder=\"Password\"\n            value={this.state.password} onChange={this.handleChange} required={true} /></p>\n          <p><input className=\"button\" type=\"submit\" value=\"Login\" /></p>\n        </form>\n        <div className={styles.signUpMessage}>\n          Don't have an account? <Link to=\"../get-started\">Sign up</Link>\n        </div>\n        <div className={styles.status}>\n          {status}\n        </div>\n      </div >\n    );\n  }\n}\n\nexport default LoginForm;\n","import React from 'react';\nimport { navigate, RouteComponentProps } from '@reach/router';\nimport { v4 as uuidv4 } from 'uuid';\nimport parseISO from 'date-fns/parseISO'\n\nimport ChatApp from './ChatApp';\nimport { Conversation } from '../models/Conversation';\nimport { ConversationJson } from '../utils/json/ConversationJson';\nimport { User } from '../models/User';\nimport { UserJson } from '../utils/json/UserJson';\nimport NchatApi, { FetchError } from '../utils/NchatApi';\nimport NchatWebSocket, { WSRequest, WSSuccessResponse } from '../utils/NchatWebSocket';\n\nimport styles from \"./ChatAppLoader.module.css\";\nimport loadingIconStyles from \"../assets/LoadingIcon.module.css\";\n\ninterface GetAuthenticateResponse {\n  user: UserJson,\n}\n\ninterface GetConversationsResponse {\n  conversations: ConversationJson[];\n}\n\ninterface WSAuthRequestData {\n  authKey: string,\n}\n\ninterface WSAuthResponseData {\n}\n\ninterface ChatAppLoaderProps extends RouteComponentProps {\n  authKey: string | null,\n  user: User | null,\n  logoutHandler: () => void;\n}\n\ninterface ChatAppLoaderState {\n  user: User | null,\n  conversations: Conversation[] | null,\n  webSocket: NchatWebSocket | null,\n  errorMessage: string | null;\n}\n\nclass ChatAppLoader extends React.Component<ChatAppLoaderProps, ChatAppLoaderState> {\n  state: ChatAppLoaderState = {\n    user: this.props.user,\n    conversations: null,\n    webSocket: null,\n    errorMessage: null,\n  }\n\n  async componentDidMount() {\n    if (this.props.authKey === null) {\n      // There is an acknowledged bug where navigate does not work in componentDidMount. This\n      // hack is a workaround.\n      setTimeout(() => navigate('/accounts/get-started'), 1);\n      return;\n    }\n\n    const authKey = this.props.authKey;\n\n    try {\n      const userPromise = this.state.user === null\n        ? this.initUser(authKey)\n        : Promise.resolve(this.state.user);\n\n      const conversationsPromise = this.initConversations(authKey);\n\n      const webSocketPromise = NchatWebSocket.createWebSocket()\n        .then(webSocket => {\n          this.sendAuth(authKey, webSocket);\n          return webSocket;\n        });\n\n      const [user, conversations, webSocket] =\n        await Promise.all([userPromise, conversationsPromise, webSocketPromise]);\n\n      this.setState({\n        user: user,\n        conversations: conversations,\n        webSocket: webSocket,\n      });\n    } catch (error) {\n      if (error instanceof FetchError && error.response.status === 403) {\n        this.props.logoutHandler();\n      } else {\n        this.setState({\n          errorMessage: \"Could not load nchat. Please try again later.\",\n        });\n      }\n    }\n  }\n\n  async initUser(authKey: string): Promise<User> {\n    const response =\n      await NchatApi.get<GetAuthenticateResponse>(\"authenticate\", authKey);\n    const user: User = {\n      id: response.data.user.id,\n      name: response.data.user.name,\n      username: response.data.user.username,\n    }\n    return user;\n  }\n\n  async initConversations(authKey: string): Promise<Conversation[]> {\n    const response =\n      await NchatApi.get<GetConversationsResponse>(\"conversations\", authKey);\n\n    const conversations = response.data.conversations.map(conversation => {\n      return {\n        uuid: uuidv4(),\n        id: conversation.id,\n        conversationPartner: {\n          id: conversation.conversationPartner.id,\n          username: conversation.conversationPartner.username,\n          name: conversation.conversationPartner.name,\n        },\n        messages: conversation.messages.map(message => {\n          return {\n            uuid: uuidv4(),\n            id: message.id,\n            senderId: message.senderId,\n            body: message.body,\n            sent: parseISO(message.sent),\n          };\n        }),\n        isHistoryLoaded: false,\n        isLoading: false,\n      };\n    });\n    return conversations;\n  }\n\n  private sendAuth(authKey: string, webSocket: NchatWebSocket):\n    Promise<WSSuccessResponse<WSAuthResponseData>> {\n    const request: WSRequest<WSAuthRequestData> = {\n      type: \"request\",\n      method: \"authorize\",\n      data: {\n        authKey: authKey,\n      },\n    };\n\n    return webSocket.sendRequest(request);\n  }\n\n  componentWillUnmount() {\n  }\n\n  render() {\n    return (\n      <div className={styles.main}>\n        {\n          this.state.user && this.state.conversations && this.state.webSocket && this.props.authKey\n            ?\n            <ChatApp\n              authKey={this.props.authKey}\n              user={this.state.user}\n              webSocket={this.state.webSocket}\n              conversations={this.state.conversations}\n              logoutHandler={this.props.logoutHandler} />\n            :\n            <div className={styles.loading}>\n              {this.state.errorMessage === null\n                ? <div className={styles.loadingIcon + \" \" + loadingIconStyles.main}></div>\n                : <div className={styles.errorMessage}>{this.state.errorMessage}</div>\n              }\n            </div>\n        }\n      </div>\n    );\n  }\n}\n\nexport default ChatAppLoader","import React, { MouseEvent } from 'react';\nimport { navigate } from '@reach/router';\n\nimport NchatApi from '../utils/NchatApi';\nimport { User } from '../models/User';\nimport { UserJson } from '../utils/json/UserJson';\n\nimport styles from \"./TryNowForm.module.css\";\nimport loadingIconStyles from '../assets/LoadingIcon.module.css';\n\nenum TryNowFormStatus {\n  Empty,\n  Loading,\n  Error,\n}\n\ninterface PostDemoUsersResponse {\n  authKey: string,\n  user: UserJson,\n}\n\ninterface TryNowFormProps {\n  setAuthenticatedUser: (authKey: string, user: User) => void;\n}\n\ninterface TryNowFormState {\n  status: {\n    value: TryNowFormStatus,\n    message?: string,\n  },\n}\n\nclass TryNowForm extends React.Component<TryNowFormProps, TryNowFormState> {\n  state: TryNowFormState = {\n    status: {\n      value: TryNowFormStatus.Empty,\n    },\n  };\n\n  constructor(props: TryNowFormProps) {\n    super(props);\n\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  async handleClick(event: MouseEvent<HTMLButtonElement>) {\n    this.setState({\n      status: {\n        value: TryNowFormStatus.Loading,\n      },\n    });\n\n    try {\n      const response = await NchatApi.post<PostDemoUsersResponse>(\"demoUsers\", {});\n\n      const authKey = response.data.authKey;\n      const user: User = {\n        id: response.data.user.id,\n        username: response.data.user.username,\n        name: response.data.user.name,\n      }\n\n      this.props.setAuthenticatedUser(authKey, user);\n      navigate(\"/\")\n    } catch (error) {\n      this.setState({\n        status: {\n          value: TryNowFormStatus.Error,\n          message: \"Could not launch demo. Please try again later.\",\n        },\n      });\n    }\n  }\n\n  render() {\n    let status: JSX.Element | null;\n\n    switch (this.state.status.value) {\n      case TryNowFormStatus.Empty:\n        status = null;\n        break;\n      case TryNowFormStatus.Loading:\n        status = <div className={styles.loading + \" \" + loadingIconStyles.main}></ div>;\n        break;\n      case TryNowFormStatus.Error:\n        status =\n          <div className=\"errorMessage\">\n            {this.state.status.message}\n          </div>\n        break;\n    }\n\n    return (\n      <div className={styles.main}>\n        <h1 className={styles.header}>Try now!</h1>\n        <p>\n          Try a demo of nchat now.\n        </p>\n        <button className=\"button\" onClick={this.handleClick}>Try it now </button>\n        <div className={styles.status}>\n          <p>\n            {status}\n          </p>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default TryNowForm;","import React, { ChangeEvent, FormEvent } from 'react';\nimport { RouteComponentProps } from '@reach/router';\nimport { Link } from \"@reach/router\";\n\nimport NchatApi, { NchatApiError } from '../utils/NchatApi';\n\nimport styles from './SignUpForm.module.css';\nimport loadingIconStyles from '../assets/LoadingIcon.module.css';\n\nenum SignUpFormStatus {\n  Empty,\n  Loading,\n  Error,\n}\n\ninterface SignUpFormProps extends RouteComponentProps {\n  authenticateUser: (username: string, password: string) => Promise<void>,\n};\n\ninterface SignUpFormState {\n  name: string,\n  username: string,\n  password: string,\n  status: {\n    value: SignUpFormStatus,\n    message?: string,\n  },\n}\n\nclass SignUpForm extends React.Component<SignUpFormProps, SignUpFormState> {\n  state: SignUpFormState = {\n    \"name\": \"\",\n    \"username\": \"\",\n    \"password\": \"\",\n    status: {\n      value: SignUpFormStatus.Empty,\n    },\n  };\n\n  constructor(props: SignUpFormProps) {\n    super(props);\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleChange(event: ChangeEvent<HTMLInputElement>) {\n    switch (event.target.name) {\n      case \"username\":\n        this.setState({\n          username: event.target.value,\n        });\n        break;\n      case \"password\":\n        this.setState({\n          password: event.target.value,\n        });\n        break;\n      case \"name\":\n        this.setState({\n          name: event.target.value,\n        });\n        break;\n    }\n  }\n\n  async handleSubmit(event: FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n\n    this.setState({\n      status: {\n        value: SignUpFormStatus.Loading\n      },\n    });\n\n    const requestBody = {\n      \"name\": this.state.name,\n      \"username\": this.state.username,\n      \"password\": this.state.password,\n    }\n\n    try {\n      await NchatApi.post(\"users\", requestBody);\n    } catch (error) {\n      if (error instanceof NchatApiError && error.body.code === 6) {\n        this.setState({\n          status: {\n            value: SignUpFormStatus.Error,\n            message: \"That username is already taken. Please select another username.\",\n          },\n        });\n      } else {\n        this.setState({\n          status: {\n            value: SignUpFormStatus.Error,\n            message: \"Could not sign up. Please try again later.\",\n          },\n        });\n      }\n      return;\n    }\n\n    try {\n      await this.props.authenticateUser(this.state.username, this.state.password);\n    } catch (error) {\n      this.setState({\n        status: {\n          value: SignUpFormStatus.Error,\n          message: `Error logging in: account created but could not login.\n           Please try logging in again later.`,\n        },\n      });\n      return;\n    }\n  }\n\n  render() {\n    const autoFocus = window.matchMedia(\"(min-width: 700px)\").matches;\n\n    let status: JSX.Element | null;\n    switch (this.state.status.value) {\n      case SignUpFormStatus.Empty:\n        status = null;\n        break;\n      case SignUpFormStatus.Loading:\n        status = <div className={styles.loading + \" \" + loadingIconStyles.main}></div >;\n        break;\n      case SignUpFormStatus.Error:\n        status =\n          <div className=\"errorMessage\">\n            {this.state.status.message}\n          </div>\n        break;\n    }\n\n    return (\n      <div className={styles.main} >\n        <h1 className={styles.header}>Sign up</h1>\n        <form onSubmit={this.handleSubmit}>\n          <p><input className=\"textInput\" name=\"name\" type=\"text\" placeholder=\"Display name\"\n            value={this.state.name} onChange={this.handleChange} required={true}\n            autoFocus={autoFocus} /></p>\n          <p><input className=\"textInput\" name=\"username\" type=\"text\" placeholder=\"Username\"\n            value={this.state.username} onChange={this.handleChange} required={true} /></p>\n          <p><input className=\"textInput\" name=\"password\" type=\"password\" placeholder=\"Password\"\n            value={this.state.password} onChange={this.handleChange} required={true} /></p>\n          <p><input className=\"button\" type=\"submit\" value=\"Sign up\" /></p>\n        </form>\n        <div className={styles.loginMessage}>\n          Already have an account? <Link to=\"../login\">Login</Link>\n        </div>\n        <div className={styles.status}>\n          {status}\n        </div>\n      </div >\n    );\n  }\n}\n\nexport default SignUpForm;\n","import React from 'react';\nimport { RouteComponentProps } from '@reach/router';\nimport { Router, navigate } from \"@reach/router\";\n\nimport LoginForm from './LoginForm';\nimport NchatApi from '../utils/NchatApi';\nimport { User } from '../models/User';\nimport { UserJson } from '../utils/json/UserJson';\nimport TryNowForm from './TryNowForm';\nimport SignUpForm from './SignUpForm';\n\nimport { ReactComponent as NchatLogo } from '../assets/logo.svg';\n\nimport styles from './AccountsView.module.css'\n\ninterface PostAuthenticateResponse {\n  authKey: string,\n  user: UserJson,\n}\n\ninterface AccountsViewProps extends RouteComponentProps {\n  setAuthenticatedUser: (authKey: string, user: User) => void;\n}\n\ninterface AccountsViewState {\n}\n\nclass AccountsView extends React.Component<AccountsViewProps, AccountsViewState> {\n  constructor(props: AccountsViewProps) {\n    super(props);\n\n    this.authenticateUser = this.authenticateUser.bind(this);\n  }\n\n  async authenticateUser(username: string, password: string): Promise<void> {\n    const requestBody = {\n      \"username\": username,\n      \"password\": password,\n    }\n\n    const response = await NchatApi.post<PostAuthenticateResponse>(\"authenticate\", requestBody);\n\n    const authKey = response.data.authKey;\n    const user: User = {\n      id: response.data.user.id,\n      username: response.data.user.username,\n      name: response.data.user.name,\n    }\n    this.props.setAuthenticatedUser(authKey, user);\n    navigate(\"/\");\n  }\n\n  render() {\n    return (\n      <main className={styles.main}>\n        <div className={styles.logoContainer}>\n          <NchatLogo className={styles.logo} title=\"nchat logo\" />\n        </div>\n        <div className={styles.intro}>\n          nchat is an app for chatting with your friends.\n        </div>\n        <div className={styles.selector}>\n          <section className={styles.tryNow}>\n            <TryNowForm setAuthenticatedUser={this.props.setAuthenticatedUser} />\n          </section>\n          <div className={styles.divider}>\n            or\n            </div>\n          <section className={styles.authenticate}>\n            <Router>\n              <SignUpForm path=\"get-started\" authenticateUser={this.authenticateUser} />\n              <LoginForm path=\"login\" authenticateUser={this.authenticateUser} />\n            </Router>\n          </section>\n        </div>\n      </main>\n    );\n  }\n}\n\nexport default AccountsView;","import React from 'react';\nimport { Router } from \"@reach/router\";\nimport Cookies from 'universal-cookie';\n\nimport ChatAppLoader from './chatApp/ChatAppLoader';\nimport AccountsView from './accounts/AccountsView';\nimport { User } from './models/User'\n\ninterface AppState {\n  authKey: string | null,\n  user: User | null,\n}\n\nclass App extends React.Component<{}, AppState> {\n  state: AppState = {\n    authKey: null,\n    user: null,\n  };\n\n  constructor(props: {}) {\n    super(props);\n\n    this.setAuthenticatedUser = this.setAuthenticatedUser.bind(this);\n    this.logout = this.logout.bind(this);\n\n    const cookies = new Cookies();\n    const authKey = cookies.get(\"authKey\");\n    if (authKey) {\n      this.state.authKey = authKey;\n    }\n  }\n\n  setAuthenticatedUser(authKey: string, user: User) {\n    const cookies = new Cookies();\n    cookies.set(\"authKey\", authKey, { path: \"/\", sameSite: \"lax\", maxAge: 60 * 60 * 24 * 365 });\n\n    this.setState({\n      \"authKey\": authKey,\n      \"user\": user,\n    })\n  }\n\n  logout() {\n    const cookies = new Cookies();\n    cookies.remove(\"authKey\", { path: \"/\" });\n    this.setState({\n      authKey: null,\n      user: null,\n    });\n  }\n\n  render() {\n    return (\n      <Router className=\"Router\">\n        <ChatAppLoader path=\"/\"\n          authKey={this.state.authKey}\n          user={this.state.user}\n          key={this.state.authKey}\n          logoutHandler={this.logout} />\n        <AccountsView path=\"accounts/*\" setAuthenticatedUser={this.setAuthenticatedUser} />\n      </Router >\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n// import * as serviceWorker from './serviceWorker';\n\nimport './common.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n"],"sourceRoot":""}