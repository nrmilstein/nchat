(this["webpackJsonpnchat-web"]=this["webpackJsonpnchat-web"]||[]).push([[0],Array(27).concat([function(e,t,n){e.exports=n(61)},,,,,function(e,t,n){},function(e,t,n){},,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(21),i=n.n(r),o=(n(32),n(33),n(3)),c=n(4),u=n(2),l=n(6),d=n(7),h=n(9),v=n(1),m=n.n(v),p=n(24),f=n(5),b=n(62),g=n(18),y=n(8),C=n(14),w=n.n(C),k=n(25),O=n(10),j=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"fetch",value:function(e){function t(t,n,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=Object(f.a)(m.a.mark((function e(t,n,a){var s,r,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={Accept:"application/json"},n&&(s["X-API-KEY"]=n),a?a.headers?this.appendHeaders(a.headers,s):a.headers=s:a={headers:s},e.next=5,fetch(this.apiUrl+t,a);case 5:return r=e.sent,i=r.clone(),e.next=9,r.json();case 9:if(o=e.sent,r.ok&&(!("status"in o)||"success"===o.status)){e.next=20;break}if(!("status"in o)||!("message"in o)){e.next=15;break}throw new S(o.message,i,o);case 15:if(!("status"in o)){e.next=19;break}throw new S("Nchat API error.",i,o);case 19:throw new E("Nchat API error.",i);case 20:if("status"in o){e.next=22;break}throw new E("Missing 'status' field in nchat response.",i);case 22:return e.abrupt("return",o);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}())},{key:"get",value:function(){var e=Object(f.a)(m.a.mark((function e(t,n,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetch(t,n,a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=Object(f.a)(m.a.mark((function e(t,n,a,s){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(O.a)(Object(O.a)({},s),{},{method:"POST",body:JSON.stringify(n)}),e.abrupt("return",this.fetch(t,a,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,a,s){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=Object(f.a)(m.a.mark((function e(t,n,a,s){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(O.a)(Object(O.a)({},s),{},{method:"PUT",body:JSON.stringify(n)}),e.abrupt("return",this.fetch(t,a,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,a,s){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(f.a)(m.a.mark((function e(t,n,a){var s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Object(O.a)(Object(O.a)({},a),{},{method:"DELETE"}),e.abrupt("return",this.fetch(t,n,s));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"appendHeaders",value:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e instanceof Headers?e.append(n,t[n]):Array.isArray(e)?e.push([n,t[n]]):"object"===typeof e&&(e[n]=t[n]))}}]),e}();j.apiUrl="/api/v1/";var E=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e,a){var s;return Object(o.a)(this,n),(s=t.call(this,e)).response=void 0,Error.captureStackTrace&&Error.captureStackTrace(Object(u.a)(s),n),s.response=a,s}return n}(Object(k.a)(Error)),S=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e,a,s){var r;return Object(o.a)(this,n),(r=t.call(this,e,a)).body=void 0,Error.captureStackTrace&&Error.captureStackTrace(Object(u.a)(r),n),r.body=s,r}return n}(E),x=j,N=s.a.createContext({authKey:"",user:{id:-1,name:"",username:""}});n(42);var M=function(e){return s.a.createElement(N.Consumer,null,(function(t){var n;return s.a.createElement("header",{className:"SidebarBanner"},s.a.createElement("div",{className:"SidebarBanner__userName"},null!==(n=t.user.name)&&void 0!==n?n:t.user.username),s.a.createElement("button",{className:"SidebarBanner__plus",onClick:e.handleNewConversation},"\uff0b"))}))};n(43);var I=function(e){var t;return s.a.createElement("div",{className:"ConversationRow"+(e.selected?" ConversationRow--selected":""),onClick:function(){return e.handleConversationRowClick(e.conversation)}},s.a.createElement("div",{className:"ConversationRow__name"},null!==(t=e.conversation.conversationPartner.name)&&void 0!==t?t:e.conversation.conversationPartner.username),s.a.createElement("div",{className:"ConversationRow__preview"}))};n(44);var L=function(e){var t=e.conversations.map((function(t){var n;return s.a.createElement(I,{key:t.uuid,selected:t.uuid===(null===(n=e.selectedConversation)||void 0===n?void 0:n.uuid),conversation:t,handleConversationRowClick:e.handleConversationRowClick})}));return s.a.createElement("div",{className:"ConversationList"},t)};n(45);var U=function(e){return s.a.createElement("nav",{className:"Sidebar"},s.a.createElement(M,{handleNewConversation:e.handleNewConversation}),s.a.createElement(L,{conversations:e.conversations,selectedConversation:e.selectedConversation,handleConversationRowClick:e.handleConversationRowClick}))};n(46);var P=function(e){var t;return s.a.createElement("header",{className:"ConversationViewBanner"},null!==(t=e.selectedConversation.conversationPartner.name)&&void 0!==t?t:e.selectedConversation.conversationPartner.username)};n(47);var B=function(e){return s.a.createElement(N.Consumer,null,(function(t){var n;return s.a.createElement("div",{className:"MessageView"+((null===(n=t.user)||void 0===n?void 0:n.id)===e.message.senderId?null===e.message.id?" MessageView--us_unsynced":" MessageView--us_synced":" MessageView--them")},s.a.createElement("div",{className:"MessageView__messageBody"},e.message.body))}))};n(48),n(49);var _=function(e){var t,n,a={width:null!==(t=e.width)&&void 0!==t?t:40,height:null!==(n=e.height)&&void 0!==n?n:40};return s.a.createElement("div",{className:"LoadingIcon",style:a})},R=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).SCROLL_TOLERANCE=40,a.conversationViewDiv=s.a.createRef(),a.context=void 0,a.scrollToBottom=a.scrollToBottom.bind(Object(u.a)(a)),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"getSnapshotBeforeUpdate",value:function(e,t){return{isScrolledToBottom:this.isScrolledToBottom()}}},{key:"render",value:function(){var e=this.props.messages.map((function(e){return s.a.createElement(B,{key:e.uuid,message:e})}));return s.a.createElement("div",{className:"MessagesView",ref:this.conversationViewDiv},this.props.isLoading&&s.a.createElement("div",{className:"MessagesView__loadingIcon"},s.a.createElement(_,null)),e)}},{key:"componentDidUpdate",value:function(e,t,n){var a,s,r=e.messages,i=this.props.messages;(null===(a=r[r.length-1])||void 0===a?void 0:a.uuid)!==(null===(s=i[i.length-1])||void 0===s?void 0:s.uuid)&&(n.isScrolledToBottom||i[i.length-1].senderId===this.context.user.id)&&this.scrollToBottom()}},{key:"isScrolledToBottom",value:function(){var e=this.conversationViewDiv.current;return null===e||e.scrollTop>=e.scrollHeight-e.clientHeight-this.SCROLL_TOLERANCE}},{key:"scrollToBottom",value:function(){var e=this.conversationViewDiv.current;null!==e&&e.scrollTo(0,e.scrollHeight-e.clientHeight)}}]),n}(s.a.Component);R.contextType=N;var V=R,A=(n(50),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={messageBody:""},a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.handleClickSend=a.handleClickSend.bind(Object(u.a)(a)),a.handleKeyDown=a.handleKeyDown.bind(Object(u.a)(a)),a}return Object(c.a)(n,[{key:"handleChange",value:function(e){this.setState({messageBody:e.target.value})}},{key:"handleClickSend",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==this.state.messageBody.trim()){e.next=2;break}return e.abrupt("return");case 2:this.props.handleSendMessage(this.state.messageBody)&&this.setState({messageBody:""});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleKeyDown",value:function(e){"Enter"===e.key&&this.handleClickSend()}},{key:"render",value:function(){return s.a.createElement("div",{className:"MessageInput"},s.a.createElement("input",{name:"messageBody",className:"MessageInput__input",type:"text",value:this.state.messageBody,onKeyDown:this.handleKeyDown,onChange:this.handleChange,autoFocus:this.props.autoFocus,placeholder:"Type a message"}),s.a.createElement("button",{className:"MessageInput__button button",onClick:this.handleClickSend,disabled:this.props.disabled},"Send"))}}]),n}(s.a.Component));n(51);var K,T=function(e){return s.a.createElement("div",{className:"ConversationView"},s.a.createElement(P,{selectedConversation:e.selectedConversation}),s.a.createElement(V,{isLoading:e.selectedConversation.isLoading,messages:e.selectedConversation.messages}),s.a.createElement(A,{autoFocus:!0,handleSendMessage:function(t){return e.handleSendMessage(t),!0}}))};n(52);!function(e){e[e.Empty=0]="Empty",e[e.Loading=1]="Loading",e[e.Ok=2]="Ok",e[e.Error=3]="Error"}(K||(K={}));var D=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e;switch(this.props.status){case K.Empty:e=s.a.createElement("span",{className:"ConversationCreatorViewBanner__to"},"To:");break;case K.Error:e=s.a.createElement("div",{className:"ConversationCreatorViewBanner__error"});break;case K.Loading:e=s.a.createElement(_,{width:20,height:20});break;case K.Ok:e=s.a.createElement("div",{className:"ConversationCreatorViewBanner__success"})}return s.a.createElement("header",{className:"ConversationCreatorViewBanner"},s.a.createElement("div",{className:"ConversationCreatorViewBanner__status"},s.a.createElement("label",{htmlFor:"ConversationCreatorViewBannerInput",className:"ConversationCreatorViewBanner__label"},e)),s.a.createElement("input",{type:"text",className:"ConversationCreatorViewBanner__input",placeholder:"Username",value:this.props.conversationCreatorUsername,autoFocus:!0,onChange:this.props.handleChange,onBlur:this.props.handleBlur,id:"ConversationCreatorViewBannerInput"}))}}]),n}(s.a.Component),q=(n(53),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).context=void 0,a.state={username:"",conversationPartner:null,usernameInputStatus:K.Empty},a.handleUsernameChange=a.handleUsernameChange.bind(Object(u.a)(a)),a.handleSendMessage=a.handleSendMessage.bind(Object(u.a)(a)),a.handleUsernameInputBlur=a.handleUsernameInputBlur.bind(Object(u.a)(a)),a}return Object(c.a)(n,[{key:"handleUsernameChange",value:function(e){var t=e.target.value;this.setState({usernameInputStatus:K.Empty,username:t})}},{key:"handleSendMessage",value:function(e){return null!==this.state.conversationPartner&&(this.props.handleSendMessage(e,this.state.conversationPartner),!0)}},{key:"handleUsernameInputBlur",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({usernameInputStatus:K.Loading}),""!==(n=this.state.username).trim()){e.next=5;break}return this.setState({usernameInputStatus:K.Empty}),e.abrupt("return");case 5:return e.prev=5,e.next=8,this.getConversationPartner(n);case 8:a=e.sent,this.setState({conversationPartner:a,usernameInputStatus:K.Ok}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),this.setState({conversationPartner:null,usernameInputStatus:K.Error});case 15:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getConversationPartner",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get("users/"+t,this.context.authKey);case 2:return n=e.sent,a=n.data.user,e.abrupt("return",{id:a.id,username:a.username,name:a.name});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement("div",{className:"ConversationCreatorView"},s.a.createElement(D,{conversationCreatorUsername:this.state.username,status:this.state.usernameInputStatus,handleChange:this.handleUsernameChange,handleBlur:this.handleUsernameInputBlur}),s.a.createElement("div",{className:"ConversationCreatorView__spacer"}),s.a.createElement(A,{autoFocus:!1,handleSendMessage:this.handleSendMessage,disabled:this.state.usernameInputStatus!==K.Ok}))}}]),n}(s.a.Component));q.contextType=N;var F=q;n(54);var H=function(e){var t;return s.a.createElement("main",{className:"ContentView"},e.isConversationCreatorOpen?s.a.createElement(F,{handleSendMessage:e.handleSendMessage}):null!==e.selectedConversation&&s.a.createElement(T,{selectedConversation:e.selectedConversation,handleSendMessage:e.handleSendMessage,key:null===(t=e.selectedConversation)||void 0===t?void 0:t.uuid}))},$=(n(55),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={conversations:a.props.conversations,selectedConversation:null,isConversationCreatorOpen:!1},a.handleMessageReceived=a.handleMessageReceived.bind(Object(u.a)(a)),a.handleNewConversation=a.handleNewConversation.bind(Object(u.a)(a)),a.handleConversationRowClick=a.handleConversationRowClick.bind(Object(u.a)(a)),a.handleSendMessage=a.handleSendMessage.bind(Object(u.a)(a)),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.props.webSocket.addNotificationListener("newMessage",this.handleMessageReceived)}},{key:"handleNewConversation",value:function(){this.setState({selectedConversation:null,isConversationCreatorOpen:!0})}},{key:"handleConversationRowClick",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var n,a,s,r,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.uuid!==(null===(n=this.state.selectedConversation)||void 0===n?void 0:n.uuid)){e.next=2;break}return e.abrupt("return");case 2:if(this.setState({isConversationCreatorOpen:!1}),t.isHistoryLoaded||t.isLoading){e.next=16;break}return a=this.state.conversations.findIndex((function(e){return e.uuid===t.uuid})),s=w()(this.state.conversations,Object(y.a)({},a,{isLoading:{$set:!0}})),this.setState({conversations:s,selectedConversation:s[a]}),e.next=9,x.get("conversations/"+t.id,this.props.authKey);case 9:r=e.sent,i=r.data.conversation.messages.map((function(e){return{uuid:Object(b.a)(),id:e.id,senderId:e.senderId,body:e.body,sent:e.sent}})),a=this.state.conversations.findIndex((function(e){return e.uuid===t.uuid})),o=w()(this.state.conversations,Object(y.a)({},a,{messages:{$set:i},isLoading:{$set:!1},isHistoryLoaded:{$set:!0}})),this.setState({conversations:o,selectedConversation:o[a]}),e.next=17;break;case 16:this.setState({selectedConversation:t});case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleMessageReceived",value:function(e){var t=e.data.message,n=e.data.conversation,a={uuid:Object(b.a)(),id:t.id,body:t.body,senderId:t.senderId,sent:t.sent},s=this.state.conversations.findIndex((function(e){return e.id===n.id}));if(-1===s){var r=[{uuid:Object(b.a)(),id:n.id,conversationPartner:{id:n.conversationPartner.id,username:n.conversationPartner.username,name:n.conversationPartner.name},messages:[a],isHistoryLoaded:!0,isLoading:!1}].concat(Object(g.a)(this.state.conversations));this.setState({conversations:r})}else{var i,o=w()(this.state.conversations,Object(y.a)({},s,{messages:{$push:[a]}}));this.setState({conversations:o}),(null===(i=this.state.selectedConversation)||void 0===i?void 0:i.uuid)===o[s].uuid&&this.setState({selectedConversation:o[s]})}}},{key:"handleSendMessage",value:function(){var e=Object(f.a)(m.a.mark((function e(t,n){var a,s,r,i,o,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={uuid:Object(b.a)(),id:null,senderId:this.props.user.id,body:t,sent:null},!this.state.isConversationCreatorOpen||!n){e.next=7;break}r={uuid:Object(b.a)(),id:null,conversationPartner:n,isHistoryLoaded:!0,isLoading:!1,messages:[a]},this.setState((function(e,t){return{conversations:[r].concat(Object(g.a)(e.conversations)),selectedConversation:r,isConversationCreatorOpen:!1}})),s=r,e.next=13;break;case 7:if(null!==(s=this.state.selectedConversation)){e.next=10;break}return e.abrupt("return");case 10:i=this.state.conversations.findIndex((function(e){var t;return e.uuid===(null===(t=s)||void 0===t?void 0:t.uuid)})),o=w()(this.state.conversations,Object(y.a)({},i,{messages:{$push:[a]}})),this.setState({conversations:o,selectedConversation:o[i]});case 13:return e.next=15,this.sendMessage(s.conversationPartner.username,t);case 15:c=e.sent,this.setState((function(e,t){var n=e.conversations.findIndex((function(e){var t;return e.uuid===(null===(t=s)||void 0===t?void 0:t.uuid)})),r=e.conversations[n].messages.findIndex((function(e){return e.uuid===a.uuid})),i=w()(e.conversations,Object(y.a)({},n,{id:{$set:c.data.conversation.id},messages:Object(y.a)({},r,{id:{$set:c.data.message.id}})}));return{conversations:i,selectedConversation:i[n]}}));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(e,t){var n={type:"request",method:"sendMessage",data:{username:e,body:t}};return this.props.webSocket.sendRequest(n)}},{key:"render",value:function(){var e={authKey:this.props.authKey,user:this.props.user};return s.a.createElement("div",{className:"ChatApp"},s.a.createElement(N.Provider,{value:e},s.a.createElement(U,{conversations:this.state.conversations,selectedConversation:this.state.selectedConversation,handleConversationRowClick:this.handleConversationRowClick,handleNewConversation:this.handleNewConversation}),s.a.createElement(H,{isConversationCreatorOpen:this.state.isConversationCreatorOpen,handleSendMessage:this.handleSendMessage,selectedConversation:this.state.selectedConversation})))}},{key:"componentWillUnmount",value:function(){this.props.webSocket.close()}}]),n}(s.a.Component)),W=n(23),J=function(){function e(t){Object(o.a)(this,e),this.webSocket=void 0,this.isAuthMessageSent=!1,this.requestId=0,this.requestPromises=[],this.notificationListeners={},this.handleMessageReceived=this.handleMessageReceived.bind(this),this.webSocket=t,this.webSocket.addEventListener("message",this.handleMessageReceived)}return Object(c.a)(e,null,[{key:"getWebsocketUrl",value:function(){var e=window.location,t="https:"===e.protocol?"wss:":"ws:";return t+="//"+e.host+"/api/v1/chat"}},{key:"createWebSocket",value:function(){var t=new WebSocket(this.websocketUrl,"nchat");return new Promise((function(n,a){t.addEventListener("open",(function(a){var s=new e(t);n(s)})),t.addEventListener("error",(function(e){a(e)}))}))}}]),Object(c.a)(e,[{key:"handleMessageReceived",value:function(e){var t=JSON.parse(e.data);if("response"===t.type)"success"===t.status?this.requestPromises[t.id].resolve(t):this.requestPromises[t.id].reject(t);else if("notification"===t.type){var n=this.notificationListeners[t.method];if("undefined"!==typeof n){var a,s=Object(W.a)(n);try{for(s.s();!(a=s.n()).done;){(0,a.value)(t)}}catch(r){s.e(r)}finally{s.f()}}}}},{key:"addNotificationListener",value:function(e,t){var n;this.notificationListeners.hasOwnProperty(e)?null===(n=this.notificationListeners[e])||void 0===n||n.push(t):this.notificationListeners[e]=[t]}},{key:"sendRequest",value:function(e){var t=this,n=this.getNextId();return e.id=n,this.webSocket.send(JSON.stringify(e)),new Promise((function(e,a){t.registerPromise(n,e,a)}))}},{key:"close",value:function(){this.webSocket.close()}},{key:"registerPromise",value:function(e,t,n){this.requestPromises[e]={resolve:t,reject:n}}},{key:"getNextId",value:function(){return this.requestId++}}]),e}();J.websocketUrl=J.getWebsocketUrl();var z=J,X=(n(56),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).state={user:e.props.user,conversations:null,webSocket:null},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,n,a,s,r,i,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null===this.state.user?Promise.resolve(this.state.user):this.initUser(),n=this.initConversations(),e.next=4,z.createWebSocket();case 4:return a=e.sent,e.next=7,this.sendAuth(a);case 7:if("success"===e.sent.status){e.next=10;break}throw new Error("Could not connect to webSocket.");case 10:return e.next=12,Promise.all([t,n]);case 12:s=e.sent,r=Object(p.a)(s,2),i=r[0],o=r[1],this.setState({user:i,conversations:o,webSocket:a});case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initUser",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get("authenticate",this.props.authKey);case 2:return t=e.sent,n={id:t.data.user.id,name:t.data.user.name,username:t.data.user.username},e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initConversations",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.get("conversations",this.props.authKey);case 2:return t=e.sent,n=t.data.conversations.map((function(e){return{uuid:Object(b.a)(),id:e.id,conversationPartner:{id:e.conversationPartner.id,username:e.conversationPartner.username,name:e.conversationPartner.name},messages:[],isHistoryLoaded:!1,isLoading:!1}})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendAuth",value:function(e){var t={type:"request",method:"authorize",data:{authKey:this.props.authKey}};return e.sendRequest(t)}},{key:"render",value:function(){return s.a.createElement("div",{className:"ChatAppLoader"},this.state.user&&this.state.conversations&&this.state.webSocket?s.a.createElement($,{authKey:this.props.authKey,user:this.state.user,webSocket:this.state.webSocket,conversations:this.state.conversations}):s.a.createElement("div",{className:"ChatAppLoader__loading"},s.a.createElement(_,null)))}}]),n}(s.a.Component)),Y=(n(57),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={username:"",password:""},a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(u.a)(a)),a}return Object(c.a)(n,[{key:"handleChange",value:function(e){this.setState(Object(y.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),this.props.authenticateUser(this.state.username,this.state.password);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement("div",{className:"LoginForm"},s.a.createElement("h1",null,"Login"),s.a.createElement("form",{onSubmit:this.handleSubmit},s.a.createElement("p",null,s.a.createElement("input",{className:"textInput",name:"username",type:"text",placeholder:"Username",value:this.state.username,onChange:this.handleChange,required:!0,autoFocus:!0})),s.a.createElement("p",null,s.a.createElement("input",{className:"textInput",name:"password",type:"password",placeholder:"Password",value:this.state.password,onChange:this.handleChange,required:!0})),s.a.createElement("p",null,s.a.createElement("input",{className:"button",type:"submit",value:"Login"}))),s.a.createElement("div",{className:"LoginForm__signUpMessage"},"Don't have an account? ",s.a.createElement(h.a,{to:"../signup"},"Sign up")))}}]),n}(s.a.Component)),G=(n(58),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={name:"",username:"",password:""},a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(u.a)(a)),a}return Object(c.a)(n,[{key:"handleChange",value:function(e){this.setState(Object(y.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n={name:this.state.name,username:this.state.username,password:this.state.password},e.next=4,x.post("users",n);case 4:e.sent,this.props.authenticateUser(this.state.username,this.state.password);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement("div",{className:"SignUpForm"},s.a.createElement("h1",null,"Sign up"),s.a.createElement("form",{onSubmit:this.handleSubmit},s.a.createElement("p",null,s.a.createElement("input",{className:"textInput",name:"name",type:"text",placeholder:"Display name",value:this.state.name,onChange:this.handleChange,required:!0,autoFocus:!0})),s.a.createElement("p",null,s.a.createElement("input",{className:"textInput",name:"username",type:"text",placeholder:"Username",value:this.state.username,onChange:this.handleChange,required:!0})),s.a.createElement("p",null,s.a.createElement("input",{className:"textInput",name:"password",type:"password",placeholder:"Password",value:this.state.password,onChange:this.handleChange,required:!0})),s.a.createElement("p",null,s.a.createElement("input",{className:"button",type:"submit",value:"Sign up"}))),s.a.createElement("div",{className:"SignUpForm__loginMessage"},"Already have an account? ",s.a.createElement(h.a,{to:"../login"},"Login")))}}]),n}(s.a.Component)),Q=(n(59),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).authenticateUser=a.authenticateUser.bind(Object(u.a)(a)),a}return Object(c.a)(n,[{key:"authenticateUser",value:function(){var e=Object(f.a)(m.a.mark((function e(t,n){var a,s,r,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={username:t,password:n},e.next=3,x.post("authenticate",a);case 3:s=e.sent,r=s.data.authKey,i={id:s.data.user.id,username:s.data.user.username,name:s.data.user.name},this.props.setAuthenticatedUser(r,i),Object(h.c)("/");case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement("main",{className:"AccountsView"},s.a.createElement(h.b,null,s.a.createElement(Y,{path:"login",authenticateUser:this.authenticateUser}),s.a.createElement(G,{path:"signup",authenticateUser:this.authenticateUser})))}}]),n}(s.a.Component)),Z=(n(60),function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={authKey:null,user:null},a.setAuthenticatedUser=a.setAuthenticatedUser.bind(Object(u.a)(a)),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){null===this.state.authKey&&Object(h.c)("/accounts/login")}},{key:"setAuthenticatedUser",value:function(e,t){this.setState({authKey:e,user:t})}},{key:"render",value:function(){var e;return s.a.createElement(h.b,{className:"Router"},null!==this.state.authKey&&s.a.createElement(X,{path:"/",authKey:this.state.authKey,user:this.state.user,key:null===(e=this.state.user)||void 0===e?void 0:e.id}),s.a.createElement(Q,{path:"accounts/*",setAuthenticatedUser:this.setAuthenticatedUser}))}}]),n}(s.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(Z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}]),[[27,1,2]]]);
//# sourceMappingURL=main.e81c2ec9.chunk.js.map